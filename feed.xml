<?xml version="1.0" encoding="UTF-8"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Robin's Personal Website</title>
    <description></description>
    <link>/</link>
    <atom:link href="/feed.xml" rel="self" type="application/rss+xml"/>
    <pubDate>Wed, 13 Sep 2017 16:52:14 +0800</pubDate>
    <lastBuildDate>Wed, 13 Sep 2017 16:52:14 +0800</lastBuildDate>
    <generator>Jekyll v3.3.0</generator>
    
      <item>
        <title>Logstash</title>
        <description>&lt;h2 id=&quot;install-java-env&quot;&gt;Install JAVA ENV&lt;/h2&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;wget -c --header &quot;Cookie: oraclelicense=accept-securebackup-cookie&quot; http://download.oracle.com/otn-pub/java/jdk/8u131-b11/d54c1d3a095b4ff2b6607d096fa80163/jdk-8u131-linux-x64.tar.gz
tar xf jdk-8u131-linux-x64.tar.gz -C /usr/local/
cat &amp;gt;&amp;gt; /etc/profile &amp;lt;&amp;lt;EOF
export JAVA_HOME=/usr/local/jdk1.8.0_131
export CLASSPATH=.:\$JAVA_HOME/lib/dt.jar:\$JAVA_HOME/lib/tools.jar
export PATH=\$JAVA_HOME/bin:\$PATH
EOF
source /etc/profile
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;hr /&gt;

&lt;h2 id=&quot;install-logstash&quot;&gt;Install Logstash&lt;/h2&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;wget https://download.elastic.co/logstash/logstash/logstash-2.4.0.tar.gz
tar xf logstash-2.4.0.tar.gz &amp;amp;&amp;amp; cd logstash-2.4.0
sed -i 's#source.*#source &quot;https://ruby.taobao.org/&quot;#g' Gemfile
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;hr /&gt;

&lt;h2 id=&quot;install-plugin&quot;&gt;Install Plugin&lt;/h2&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;./bin/logstash-plugin install logstash-input-elasticsearch
./bin/logstash-plugin install logstash-output-elasticsearch
./bin/logstash-plugin install logstash-input-kafka
./bin/logstash-plugin install logstash-output-kafka
./bin/logstash-plugin install logstash-output-webhdfs
./bin/logstash-plugin list|egrep &quot;kafka|webhdfs|elasticsearch&quot;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;hr /&gt;

&lt;h2 id=&quot;configure-logstash&quot;&gt;Configure Logstash&lt;/h2&gt;

&lt;ul&gt;
  &lt;li&gt;File –&amp;gt; Kafka/File&lt;/li&gt;
&lt;/ul&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;#
input {
    file {
        path =&amp;gt; [&quot;/$PATH/**/*access.log&quot;]
        sincedb_path =&amp;gt; &quot;/$PATH/logstash/sincedb&quot;
        start_position =&amp;gt; &quot;beginning&quot;
		codec =&amp;gt; &quot;plain&quot;
        discover_interval =&amp;gt; 10
        close_older =&amp;gt; 3600
        ignore_older =&amp;gt; 86400
        sincedb_write_interval =&amp;gt; 5
        stat_interval =&amp;gt; 1
    }
}

output {
    kafka {
        bootstrap_servers =&amp;gt; &quot;test-kafka00:9092,test-kafka01:9092,test-kafka02:9092&quot;
        topic_id =&amp;gt; &quot;test_topic&quot;
        codec =&amp;gt; plain {
                        format =&amp;gt; &quot;%{message}&quot;
                }
    }
    file {
        path =&amp;gt; &quot;/home/mtime/logs/accesslog/vip.mtime.com/from_kafka.log&quot;
        message_format =&amp;gt; &quot;%{message}&quot;
    }
}
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;blockquote&gt;
  &lt;p&gt;sincedb_path: sincedb存放位置；用于记录文件读取的偏移量&lt;/p&gt;
&lt;/blockquote&gt;

&lt;blockquote&gt;
  &lt;p&gt;start_position: 在没有sincedb记录的前提下；默认从文件尾部开始读取（tail -f）；beginning 从头读取&lt;/p&gt;
&lt;/blockquote&gt;

&lt;blockquote&gt;
  &lt;p&gt;codec: plain表示文本模式；json表示按照json格式处理&lt;/p&gt;
&lt;/blockquote&gt;

&lt;blockquote&gt;
  &lt;p&gt;discover_interval: 没隔多久检测一次被监听目录下是否有新文件生成&lt;/p&gt;
&lt;/blockquote&gt;

&lt;blockquote&gt;
  &lt;p&gt;close_older: 默认3600s文件没有变化时；释放文件监听句柄&lt;/p&gt;
&lt;/blockquote&gt;

&lt;blockquote&gt;
  &lt;p&gt;ignore_older: 如果一个文件的最后修改时间超过这个值就忽略这个文件；默认是86400s（1day）&lt;/p&gt;
&lt;/blockquote&gt;

&lt;blockquote&gt;
  &lt;p&gt;sincedb_write_interval: 每隔多久写一次sincedb记录；关系到丢失数据的容忍度；不推荐太大&lt;/p&gt;
&lt;/blockquote&gt;

&lt;blockquote&gt;
  &lt;p&gt;stat_interval: 每隔多久检查一次被监听文件状态是否有更新；默认1s&lt;/p&gt;
&lt;/blockquote&gt;

&lt;blockquote&gt;
  &lt;p&gt;message_format: logstash-output-file插件无法使用codec插件；所以用此参数；&lt;/p&gt;
&lt;/blockquote&gt;

&lt;blockquote&gt;
  &lt;p&gt;%{message}: 获取原始的日志内容；不添加任何多余字段；&lt;/p&gt;
&lt;/blockquote&gt;

&lt;ul&gt;
  &lt;li&gt;Kafka –&amp;gt; ES&lt;/li&gt;
&lt;/ul&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;#
input {
    kafka {
        zk_connect =&amp;gt; &quot;zookeeper01:2181,zookeeper03:2181,zookeeper03:2181&quot;
        group_id =&amp;gt; &quot;logstash-kafka-es&quot;
        topic_id =&amp;gt; &quot;test_kafka&quot;
        codec =&amp;gt; plain
        reset_beginning =&amp;gt; false
        consumer_threads =&amp;gt; 4
        decorate_events =&amp;gt; false
    }
}

filter {
        grok {
                match =&amp;gt; {
                        &quot;message&quot; =&amp;gt; &quot;^(?&amp;lt;hostname&amp;gt;.+?)\s(?&amp;lt;modulname&amp;gt;.+?)\s(?&amp;lt;remote_addr&amp;gt;.+?)\s\-\s(?&amp;lt;remote_user&amp;gt;.+?)\s\[(?&amp;lt;localtime&amp;gt;.+?)\]\s\&quot;(?&amp;lt;request&amp;gt;.+?)\&quot;\s(?&amp;lt;status&amp;gt;.+?)\s(?&amp;lt;body_bytes_sent&amp;gt;.+?)\s\&quot;(?&amp;lt;http_referer&amp;gt;.+?)\&quot;\s\&quot;(?&amp;lt;http_user_agent&amp;gt;.+?)\&quot;\s\&quot;(?&amp;lt;http_x_forwarded_for&amp;gt;.+?)\&quot;\s\&quot;(?&amp;lt;upstream_addr&amp;gt;.+?)\&quot;\s\&quot;(?&amp;lt;upstream_response_time&amp;gt;.+?)\&quot;\s\&quot;(?&amp;lt;request_time&amp;gt;.+?)\&quot;\s\&quot;(?&amp;lt;http_cookie&amp;gt;.+?)\&quot;&quot;
                }
        }
        mutate {
                convert =&amp;gt; [
                &quot;status&quot;, &quot;integer&quot;,
                &quot;body_bytes_sent&quot; , &quot;integer&quot;,
                &quot;upstream_response_time&quot;, &quot;float&quot;,
                &quot;request_time&quot;, &quot;float&quot;
                ]
        }
}

output {
        if [modulname] {
           elasticsearch {
                workers =&amp;gt; 2
                hosts =&amp;gt; [&quot;elasticsearch01:9210&quot;,&quot;1elasticsearch02:9210&quot;,&quot;elasticsearch03:9210&quot;]
                index =&amp;gt; &quot;logstash-%{modulname}-%{+YYYY.MM.dd}&quot;
                flush_size =&amp;gt; 10000
                idle_flush_time =&amp;gt; 60
                template_overwrite =&amp;gt; true
            }
        } else {
           file {
                path =&amp;gt; &quot;/$PATH/logstash/logstash_kafka_es_error.log&quot;
                message_format =&amp;gt; &quot;%{message}&quot;
           }
        }
        stdout{codec =&amp;gt; rubydebug}
}
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;blockquote&gt;
  &lt;p&gt;group_id: 消费者分组 可以通过组ID去指定,不同的组之间消费是相互不受影响的,相互隔离&lt;/p&gt;
&lt;/blockquote&gt;

&lt;blockquote&gt;
  &lt;p&gt;topic_id: 指定消费某个topic&lt;/p&gt;
&lt;/blockquote&gt;

&lt;blockquote&gt;
  &lt;p&gt;reset_beginning: logstash启动后从什么位置开始读取数据；默认是结束位置；如果要导入原有数据；将此值设置为true&lt;/p&gt;
&lt;/blockquote&gt;

&lt;blockquote&gt;
  &lt;p&gt;decorate_events: 输出自身一些消息；类似消费消息大小；topic来源等信息；你默认false&lt;/p&gt;
&lt;/blockquote&gt;

&lt;blockquote&gt;
  &lt;p&gt;rebalance_max_retries: 注册节点的重试次数；多个logstash消费同一个topic；需要向zk注册partitons归属于哪个logstash消费；&lt;/p&gt;
&lt;/blockquote&gt;

&lt;blockquote&gt;
  &lt;p&gt;grok: 用正则表达式将纯文本内容变成json格式&lt;/p&gt;
&lt;/blockquote&gt;

&lt;blockquote&gt;
  &lt;p&gt;mutate: 更改json格式中指定key的value的字符类型；integer整数 string字符串 float浮点数&lt;/p&gt;
&lt;/blockquote&gt;

&lt;ul&gt;
  &lt;li&gt;Kafka –&amp;gt; HDFS&lt;/li&gt;
&lt;/ul&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;#
input {
    kafka {
        zk_connect =&amp;gt; &quot;zookeeper01:2181,zookeeper03:2181,zookeeper03:2181&quot;
        group_id =&amp;gt; &quot;test_kafka&quot;
        topic_id =&amp;gt; &quot;test_kafka_id&quot;
        codec =&amp;gt; plain
        reset_beginning =&amp;gt; false
        consumer_threads =&amp;gt; 4
        decorate_events =&amp;gt; false
    }
}

filter {
        grok {
                match =&amp;gt; {
                        &quot;message&quot; =&amp;gt;&quot;^(?&amp;lt;hostname&amp;gt;.+?)\s(?&amp;lt;modulname&amp;gt;.+?)\s(?&amp;lt;remote_addr&amp;gt;.+?)\s\-\s(?&amp;lt;remote_user&amp;gt;.+?)\s\[(?&amp;lt;Day&amp;gt;.+?)/(?&amp;lt;Month&amp;gt;.+?)/(?&amp;lt;Year&amp;gt;.+?):(?&amp;lt;Hour&amp;gt;.+?):&quot;
                }
        }
        mutate {
                gsub =&amp;gt; [&quot;modulname&quot;, &quot;\.&quot;, &quot;&quot;]
        }
        if [Month] == &quot;Jan&quot; {
                        mutate {
                                update =&amp;gt; [&quot;Month&quot;,&quot;01&quot;]
                        } 
        } else if [Month] == &quot;Feb&quot; {
                        mutate {
                                update =&amp;gt; [&quot;Month&quot;,&quot;02&quot;]
                        }
        } else if [Month] == &quot;Mar&quot; {
                        mutate {
                                update =&amp;gt; [&quot;Month&quot;,&quot;03&quot;]
                        }
        } else if [Month] == &quot;Api&quot; {
                        mutate {
                                update =&amp;gt; [&quot;Month&quot;,&quot;04&quot;]
                        }
        } else if [Month] == &quot;May&quot; {
                        mutate {
                                update =&amp;gt; [&quot;Month&quot;,&quot;05&quot;]
                        }
        } else if [Month] == &quot;Jun&quot; {
                        mutate {
                                update =&amp;gt; [&quot;Month&quot;,&quot;06&quot;]
                        }
        } else if [Month] == &quot;Jul&quot; {
                        mutate {
                                update =&amp;gt; [&quot;Month&quot;,&quot;07&quot;]
                        }
        } else if [Month] == &quot;Aug&quot; {
                        mutate {
                                update =&amp;gt; [&quot;Month&quot;,&quot;08&quot;]
                        }
        } else if [Month] == &quot;Sep&quot; {
                        mutate {
                                update =&amp;gt; [&quot;Month&quot;,&quot;09&quot;]
                        }
        } else if [Month] == &quot;Oct&quot; {
                        mutate {
                                update =&amp;gt; [&quot;Month&quot;,&quot;10&quot;]
                        }
        } else if [Month] == &quot;Nov&quot; {
                        mutate {
                                update =&amp;gt; [&quot;Month&quot;,&quot;11&quot;]
                        }
        } else if [Month] == &quot;Dec&quot; {
                        mutate {
                                update =&amp;gt; [&quot;Month&quot;,&quot;12&quot;]
                        }
        } 
}

output {
        if [modulname] {
           webhdfs {
                workers =&amp;gt; 2
                host =&amp;gt; &quot;hdfs-host.host.com&quot;
                port =&amp;gt; 50070
                user =&amp;gt; &quot;loguser&quot;
                path =&amp;gt; &quot;/Service-Data/Logs/%{modulname}/dt=%{Year}%{Month}%{Day}/hour=%{Hour}/%{hostname}_%{Year}%{Month}%{Day}%{Hour}.log&quot;
                flush_size =&amp;gt; 5000
                compression =&amp;gt; &quot;gzip&quot;
                idle_flush_time =&amp;gt; 6
                retry_interval =&amp;gt; 3
                retry_times =&amp;gt; 3
                codec =&amp;gt; line {
                        format =&amp;gt; &quot;%{message}&quot;
                }
           }
        } else {
           file {
                path =&amp;gt; &quot;/$PATH/logstash/logstash_kafka_hdfs_error.log&quot;
                message_format =&amp;gt; &quot;%{message}&quot;
           }
        }
        stdout{codec =&amp;gt; rubydebug}
}
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;blockquote&gt;
  &lt;p&gt;update: 更新value值&lt;/p&gt;
&lt;/blockquote&gt;

&lt;hr /&gt;

&lt;h2 id=&quot;start-logstash&quot;&gt;Start Logstash&lt;/h2&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;nohup ./bin/logstash -f conf/logstash.conf &amp;gt;&amp;gt;/var/log/logstash.debug.log &amp;amp;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;hr /&gt;

&lt;p&gt;PS: 推荐用supervisor守护logstash进程&lt;/p&gt;

&lt;p&gt;end&lt;/p&gt;

</description>
        <pubDate>Tue, 12 Sep 2017 00:00:00 +0800</pubDate>
        <link>/bigdata/Logstash.html</link>
        <guid isPermaLink="true">/bigdata/Logstash.html</guid>
        
        
        <category>BigData</category>
        
      </item>
    
      <item>
        <title>Centos6 &amp; Centos 7 初始化脚本</title>
        <description>&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;#!/bin/bash&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;#Author: xxxxxxx&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;#Email: xxxxxxx@gmail.com&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;#Description: This script is for optimizing system performance; For Centos6 and Centos7&lt;/span&gt;

cat /etc/redhat-release|awk &lt;span class=&quot;s1&quot;&gt;'{print &quot;OPERATING SYSTEM:&quot;,$0}'&lt;/span&gt;
grep &lt;span class=&quot;s2&quot;&gt;&quot;IPADDR&quot;&lt;/span&gt; /etc/sysconfig/network-scripts/ifcfg-eth0|awk -F &lt;span class=&quot;s2&quot;&gt;&quot;=&quot;&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'{print &quot;HOST IPADDR:&quot;,$2}'&lt;/span&gt;
uname -a|awk &lt;span class=&quot;s1&quot;&gt;'{print &quot;HOSTNAME:&quot;,$2&quot;\nKERNEL VERSION:&quot;,$3}'&lt;/span&gt;        

sed -i &lt;span class=&quot;s1&quot;&gt;'s/DNS1=.*/DNS1=114.114.114.114/g'&lt;/span&gt; /etc/sysconfig/network-scripts/ifcfg-eth0
sed -i &lt;span class=&quot;s1&quot;&gt;'s/DNS2=.*/DNS2=180.76.76.76/g'&lt;/span&gt; /etc/sysconfig/network-scripts/ifcfg-eth0
cat &amp;gt;/etc/resolv.conf&lt;span class=&quot;sh&quot;&gt;&amp;lt;&amp;lt;EOF
nameserver 114.114.114.114
nameserver 180.76.76.76
EOF

&lt;/span&gt;sed -i &lt;span class=&quot;s1&quot;&gt;'s/SELINUX=.*/SELINUX=disabled/g'&lt;/span&gt; /etc/selinux/config
setenforce 0 &amp;amp;&amp;gt; /dev/null

&lt;span class=&quot;nv&quot;&gt;TEST&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;$(&lt;/span&gt;grep &lt;span class=&quot;s2&quot;&gt;&quot;soft nproc 65535&quot;&lt;/span&gt; /etc/security/limits.conf|wc -l&lt;span class=&quot;k&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$TEST&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;0&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;; &lt;span class=&quot;k&quot;&gt;then
&lt;/span&gt;cat  &amp;gt;&amp;gt; /etc/security/limits.conf &lt;span class=&quot;sh&quot;&gt;&amp;lt;&amp;lt; EOF
* soft nproc 65535
* hard nproc 65535
* soft nofile 65535
* hard nofile 65535
EOF
&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;fi

&lt;/span&gt;sed -i &lt;span class=&quot;s2&quot;&gt;&quot;s/&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\#&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;UseDNS.*/UseDNS no/g&quot;&lt;/span&gt; /etc/ssh/sshd_config
sed -i &lt;span class=&quot;s2&quot;&gt;&quot;s/GSSAPIAuthentication.*/GSSAPIAuthentication no/g&quot;&lt;/span&gt; /etc/ssh/sshd_config

&lt;span class=&quot;nv&quot;&gt;TEST&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;$(&lt;/span&gt;egrep &lt;span class=&quot;s2&quot;&gt;&quot;color|auto&quot;&lt;/span&gt; /etc/profile|wc -l&lt;span class=&quot;k&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$TEST&lt;/span&gt; -eq 0 &lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;;&lt;span class=&quot;k&quot;&gt;then
&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;alias egrep='egrep --color=auto'&quot;&lt;/span&gt; &amp;gt;&amp;gt;/etc/profile
&lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;alias grep='grep --color=auto'&quot;&lt;/span&gt; &amp;gt;&amp;gt;/etc/profile
&lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;alias vi='vim'&quot;&lt;/span&gt; &amp;gt;&amp;gt;/etc/profile
&lt;span class=&quot;k&quot;&gt;fi

&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;TEST&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;$(&lt;/span&gt;grep &lt;span class=&quot;s2&quot;&gt;&quot;ntp1.aliyun.com&quot;&lt;/span&gt; /var/spool/cron/root|wc -l&lt;span class=&quot;k&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$TEST&lt;/span&gt; -eq 0 &lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;;&lt;span class=&quot;k&quot;&gt;then
&lt;/span&gt;touch /var/spool/cron/root
&lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;*/5 * * * * /usr/sbin/ntpdate ntp1.aliyun.com &amp;gt;/dev/null 2&amp;gt;&amp;amp;1&quot;&lt;/span&gt; &amp;gt;&amp;gt;/var/spool/cron/root
&lt;span class=&quot;k&quot;&gt;fi

&lt;/span&gt;yum install wget -y &amp;amp;&amp;gt; /dev/null

&lt;span class=&quot;nv&quot;&gt;SYSTEM_VERSION&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;$(&lt;/span&gt;cat /etc/redhat-release|grep -o &lt;span class=&quot;s2&quot;&gt;&quot;6.&quot;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$SYSTEM_VERSION&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;;&lt;span class=&quot;k&quot;&gt;then
    &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;VERSION&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'centos7'&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;else
    &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;VERSION&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'centos6'&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;fi

if&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$VERSION&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'centos6'&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;;&lt;span class=&quot;k&quot;&gt;then
&lt;/span&gt;chkconfig --list|grep 3:on|egrep -v &lt;span class=&quot;s2&quot;&gt;&quot;crond|network|rsyslog|sshd|sysstat&quot;&lt;/span&gt;|awk &lt;span class=&quot;s1&quot;&gt;'{print $1}'&lt;/span&gt;|sed -r &lt;span class=&quot;s1&quot;&gt;'s#(.*)#chkconfig \1 off#g'&lt;/span&gt;|bash &amp;amp;&amp;gt;/dev/null
/etc/init.d/iptables stop &amp;amp;&amp;gt; /dev/null
wget -qO /etc/yum.repos.d/CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-6.repo
wget -qO /etc/yum.repos.d/epel.repo http://mirrors.aliyun.com/repo/epel-6.repo
&lt;span class=&quot;k&quot;&gt;elif&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$VERSION&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'centos7'&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;;&lt;span class=&quot;k&quot;&gt;then
&lt;/span&gt;wget -qO /etc/yum.repos.d/CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-7.repo
wget -qO /etc/yum.repos.d/epel.repo http://mirrors.aliyun.com/repo/epel-7.repo
yum clean all &amp;amp;&amp;gt; /dev/null
systemctl stop firewalld.service &amp;amp;&amp;gt; /dev/null
systemctl disable firewalld.service &amp;amp;&amp;gt; /dev/null
systemctl stop NetworkManager.service &amp;amp;&amp;gt; /dev/null
systemctl disable NetworkManager.service &amp;amp;&amp;gt; /dev/null
systemclt stop postfix.service &amp;amp;&amp;gt; /dev/null
systemclt disable postfix.service &amp;amp;&amp;gt; /dev/null
yum install iptables-services -y &amp;amp;&amp;gt; /dev/null
&lt;span class=&quot;k&quot;&gt;else 
&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;Pls Check The System Version&quot;&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;fi
&lt;/span&gt;yum clean all &amp;amp;&amp;gt; /dev/null
yum makecache &amp;amp;&amp;gt; /dev/null
yum -y groupinstall Development tools
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;blockquote&gt;
  &lt;p&gt;wget -qO ./optimizing-system.sh http://wangrubin.com/scripts/optimizing-system.sh &amp;amp;&amp;amp; sh optimizing-system.sh&lt;/p&gt;
&lt;/blockquote&gt;

&lt;hr /&gt;

&lt;p&gt;end&lt;/p&gt;
</description>
        <pubDate>Thu, 07 Sep 2017 00:00:00 +0800</pubDate>
        <link>/shell/optimizing-system.html</link>
        <guid isPermaLink="true">/shell/optimizing-system.html</guid>
        
        
        <category>Shell</category>
        
      </item>
    
      <item>
        <title>nginx部署脚本</title>
        <description>&lt;h2 id=&quot;install&quot;&gt;Install&lt;/h2&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;yum install -y openssl openssl-devel
yum install -y zlib zlib-devel
yum install -y pcre pcre-devel
useradd nginx -M -s /sbin/nologin
wget https://nginx.org/download/nginx-1.12.1.tar.gz
tar xf nginx-1.12.1.tar.gz  &amp;amp;&amp;amp; cd nginx-1.12.1
./configure --prefix=/usr/local/nginx-1.12.1 --user=nginx --group=nginx --with-http_ssl_module --with-http_stub_status_module
make &amp;amp;&amp;amp; make install
ln -s /usr/local/nginx-1.12.1 /usr/local/nginx
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;hr /&gt;

&lt;h2 id=&quot;start-script&quot;&gt;Start script&lt;/h2&gt;

&lt;p&gt;vim /etc/init.d/nginx&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;#!/bin/bash   &lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;set&lt;/span&gt; -e   
&lt;span class=&quot;nv&quot;&gt;TOOLS_SERVER_NAME&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Nginx Server&quot;&lt;/span&gt; 
&lt;span class=&quot;nv&quot;&gt;TOOLS_CMD&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;/usr/local/nginx/sbin/nginx&quot;&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;DESCRIPTION&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Pls use /etc/init.d/nginx start|stop|restart|reload&quot;&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;LOCK_FILE&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;/usr/local/nginx/logs/nginx.lock&quot;&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;case&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$1&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;in 
  &lt;/span&gt;start&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;   
        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt; -f &lt;span class=&quot;nv&quot;&gt;$LOCK_FILE&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;;&lt;span class=&quot;k&quot;&gt;then
           &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; -e &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\0&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;33[32m&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;TOOLS_SERVER_NAME&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt; was Started.&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\0&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;33[0m&quot;&lt;/span&gt;
           &lt;span class=&quot;nb&quot;&gt;exit &lt;/span&gt;0
        &lt;span class=&quot;k&quot;&gt;fi
        &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; -e &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\0&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;33[32mSTARTTING &lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;TOOLS_SERVER_NAME&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;......&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\0&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;33[0m&quot;&lt;/span&gt;
        &lt;span class=&quot;nv&quot;&gt;$TOOLS_CMD&lt;/span&gt; &amp;amp;&amp;gt;/dev/null &amp;amp;  
        touch &lt;span class=&quot;nv&quot;&gt;$LOCK_FILE&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;;;&lt;/span&gt;   
   stop&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; 
        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt; ! -f &lt;span class=&quot;nv&quot;&gt;$LOCK_FILE&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;;&lt;span class=&quot;k&quot;&gt;then
           &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; -e &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\0&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;33[32m&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;TOOLS_SERVER_NAME&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt; was Stopped.&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\0&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;33[0m&quot;&lt;/span&gt;
           &lt;span class=&quot;nb&quot;&gt;exit &lt;/span&gt;0
        &lt;span class=&quot;k&quot;&gt;fi
        &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; -e &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\0&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;33[32mSTOPPING &lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;TOOLS_SERVER_NAME&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;......&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\0&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;33[0m&quot;&lt;/span&gt;
        &lt;span class=&quot;nv&quot;&gt;$TOOLS_CMD&lt;/span&gt; -s stop &amp;amp;&amp;gt; /dev/null   
        rm -f &lt;span class=&quot;nv&quot;&gt;$LOCK_FILE&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;;;&lt;/span&gt;   
   restart&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;   
        &lt;span class=&quot;nv&quot;&gt;$0&lt;/span&gt; stop &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; sleep 1 &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$0&lt;/span&gt; start   
        &lt;span class=&quot;p&quot;&gt;;;&lt;/span&gt;  
   reload&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;nv&quot;&gt;$TOOLS_CMD&lt;/span&gt; -s reload &amp;amp;&amp;gt; /dev/null 
        &lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; -e &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\0&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;33[32m&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;TOOLS_SERVER_NAME&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt; was Reload......&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\0&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;33[0m&quot;&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;;;&lt;/span&gt;
   &lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;   
        &lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; -e &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\0&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;33[31mUsage: &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$DESCRIPTION&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\0&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;33[0m&quot;&lt;/span&gt;
        &lt;span class=&quot;nb&quot;&gt;exit &lt;/span&gt;1   
&lt;span class=&quot;k&quot;&gt;esac&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;hr /&gt;

&lt;h2 id=&quot;on-boot-start&quot;&gt;On boot start&lt;/h2&gt;

&lt;blockquote&gt;
  &lt;p&gt;chmod +x /etc/init.d/nginx&lt;/p&gt;
&lt;/blockquote&gt;

&lt;blockquote&gt;
  &lt;p&gt;/etc/init.d/nginx start&lt;/p&gt;
&lt;/blockquote&gt;

&lt;blockquote&gt;
  &lt;p&gt;echo “/etc/init.d/nginx start” » /etc/rc.local&lt;/p&gt;
&lt;/blockquote&gt;

&lt;hr /&gt;

&lt;p&gt;end&lt;/p&gt;
</description>
        <pubDate>Thu, 07 Sep 2017 00:00:00 +0800</pubDate>
        <link>/shell/nginx.html</link>
        <guid isPermaLink="true">/shell/nginx.html</guid>
        
        
        <category>Shell</category>
        
      </item>
    
      <item>
        <title>lvs_tun_vip.sh</title>
        <description>&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;#!/bin/bash     &lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;VIP&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;210.14.134.8
&lt;span class=&quot;k&quot;&gt;case&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$1&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;in  
&lt;/span&gt;start&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;  
&lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; -e &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\0&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;33[32mStart vip......&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\0&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;33[0m&quot;&lt;/span&gt;
modprobe ipip  
/sbin/ifconfig tunl0 &lt;span class=&quot;nv&quot;&gt;$VIP&lt;/span&gt; netmask 255.255.255.255 broadcast &lt;span class=&quot;nv&quot;&gt;$VIP&lt;/span&gt;  
&lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;1&quot;&lt;/span&gt; &amp;gt; /proc/sys/net/ipv4/conf/tunl0/arp_ignore  
&lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;2&quot;&lt;/span&gt; &amp;gt; /proc/sys/net/ipv4/conf/tunl0/arp_announce  
&lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;1&quot;&lt;/span&gt; &amp;gt; /proc/sys/net/ipv4/conf/all/arp_ignore  
&lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;2&quot;&lt;/span&gt; &amp;gt; /proc/sys/net/ipv4/conf/all/arp_announce  
&lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;0&quot;&lt;/span&gt; &amp;gt; /proc/sys/net/ipv4/conf/tunl0/rp_filter  
&lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;0&quot;&lt;/span&gt; &amp;gt; /proc/sys/net/ipv4/conf/all/rp_filter  
&lt;span class=&quot;p&quot;&gt;;;&lt;/span&gt;  
stop&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;  
/sbin/ifconfig tunl0 down  
&lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; -e &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\0&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;33[32mStop vip......&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\0&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;33[0m&quot;&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;0&quot;&lt;/span&gt; &amp;gt; /proc/sys/net/ipv4/conf/tunl0/arp_ignore  
&lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;0&quot;&lt;/span&gt; &amp;gt; /proc/sys/net/ipv4/conf/tunl0/arp_announce  
&lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;0&quot;&lt;/span&gt; &amp;gt; /proc/sys/net/ipv4/conf/all/arp_ignore  
&lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;0&quot;&lt;/span&gt; &amp;gt; /proc/sys/net/ipv4/conf/all/arp_announce  
&lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;1&quot;&lt;/span&gt; &amp;gt; /proc/sys/net/ipv4/conf/tunl0/rp_filter  
&lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;1&quot;&lt;/span&gt; &amp;gt; /proc/sys/net/ipv4/conf/all/rp_filter  
&lt;span class=&quot;p&quot;&gt;;;&lt;/span&gt;  
&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;  
&lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; -e &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\0&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;33[32mUsage: Pls use &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$0&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt; {start|stop}&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\0&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;33[0m&quot;&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;exit &lt;/span&gt;1  
&lt;span class=&quot;k&quot;&gt;esac&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
</description>
        <pubDate>Thu, 07 Sep 2017 00:00:00 +0800</pubDate>
        <link>/shell/lvs-tun.html</link>
        <guid isPermaLink="true">/shell/lvs-tun.html</guid>
        
        
        <category>Shell</category>
        
      </item>
    
      <item>
        <title>lvs部署脚本</title>
        <description>&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;#!/bin/bash&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;#Author: xxxxxxx&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;#Email: xxxxxxx@gmail.com&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;#Description: This script is for start stop reload lvs &lt;/span&gt;

&lt;span class=&quot;nv&quot;&gt;WORK_DIR&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;/root/lvs/&quot;&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;CMD&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;/usr/sbin/ipvsadm&quot;&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;LOCK_FILE&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;/root/lvs/lvs.lock&quot;&lt;/span&gt;

&lt;span class=&quot;nb&quot;&gt;cd&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$WORK_DIR&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;case&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$1&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;in
        &lt;/span&gt;start&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt; -f &lt;span class=&quot;nv&quot;&gt;$LOCK_FILE&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;;&lt;span class=&quot;k&quot;&gt;then
                &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; -e &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\0&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;33[32mLVS was Started.&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\0&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;33[0m&quot;&lt;/span&gt;
                &lt;span class=&quot;nb&quot;&gt;exit &lt;/span&gt;0
        &lt;span class=&quot;k&quot;&gt;fi
        &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; -e &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\0&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;33[32mSTARTTING LVS......&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\0&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;33[0m&quot;&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;while &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;read &lt;/span&gt;line
        &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt;
                &lt;span class=&quot;nv&quot;&gt;$CMD&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$line&lt;/span&gt;
                &lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; -e &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\0&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;33[32m&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$CMD&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$line&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\0&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;33[0m&quot;&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;done&lt;/span&gt; &amp;lt; ./lvs_list.txt
        touch &lt;span class=&quot;nv&quot;&gt;$LOCK_FILE&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;;;&lt;/span&gt;
        stop&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt; -f &lt;span class=&quot;nv&quot;&gt;$LOCK_FILE&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;;&lt;span class=&quot;k&quot;&gt;then
                &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; -e &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\0&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;33[32mSTOPPING LVS......&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\0&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;33[0m&quot;&lt;/span&gt;
                &lt;span class=&quot;nv&quot;&gt;$CMD&lt;/span&gt; -C
                rm -f &lt;span class=&quot;nv&quot;&gt;$LOCK_FILE&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;else
                &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; -e &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\0&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;33[32mLVS was Stopped.&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\0&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;33[0m&quot;&lt;/span&gt;
                &lt;span class=&quot;nb&quot;&gt;exit &lt;/span&gt;0
        &lt;span class=&quot;k&quot;&gt;fi&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;;;&lt;/span&gt;
        restart&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; -e &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\0&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;33[32mRESTARTTING LVS......&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\0&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;33[0m&quot;&lt;/span&gt;
        &lt;span class=&quot;nv&quot;&gt;$0&lt;/span&gt; stop &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; sleep 1 &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$0&lt;/span&gt; start
        &lt;span class=&quot;p&quot;&gt;;;&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; -e &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\0&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;33[31mUsage: Pls use sh lvs.sh start|stop|restart|reload&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\0&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;33[0m&quot;&lt;/span&gt;
        &lt;span class=&quot;nb&quot;&gt;exit &lt;/span&gt;1
&lt;span class=&quot;k&quot;&gt;esac&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;hr /&gt;

&lt;p&gt;end&lt;/p&gt;
</description>
        <pubDate>Thu, 07 Sep 2017 00:00:00 +0800</pubDate>
        <link>/shell/lvs-ipvsadm.html</link>
        <guid isPermaLink="true">/shell/lvs-ipvsadm.html</guid>
        
        
        <category>Shell</category>
        
      </item>
    
      <item>
        <title>Prometheus-容器监控</title>
        <description>&lt;ul id=&quot;markdown-toc&quot;&gt;
  &lt;li&gt;&lt;a href=&quot;#prometheus&quot; id=&quot;markdown-toc-prometheus&quot;&gt;什么是Prometheus&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#section&quot; id=&quot;markdown-toc-section&quot;&gt;主要特点&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#section-1&quot; id=&quot;markdown-toc-section-1&quot;&gt;相关组件&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#prometheus-1&quot; id=&quot;markdown-toc-prometheus-1&quot;&gt;prometheus架构&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#prometheus-2&quot; id=&quot;markdown-toc-prometheus-2&quot;&gt;prometheus部署&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;blockquote&gt;
  &lt;p&gt;首先-什么是 TSDB (Time Series Database):&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;我们可以简单的理解为.一个优化后用来处理时间序列数据的软件,并且数据中的数组是由时间进行索引的.&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;时间序列数据库的特点:&lt;/p&gt;
&lt;/blockquote&gt;

&lt;ul&gt;
  &lt;li&gt;大部分时间都是写入操作&lt;/li&gt;
  &lt;li&gt;写入操作几乎是顺序添加;大多数时候数据到达后都以时间排序.&lt;/li&gt;
  &lt;li&gt;写操作很少写入很久之前的数据,也很少更新数据.大多数情况在数据被采集到数秒或者数分钟后就会被写入数据库.&lt;/li&gt;
  &lt;li&gt;删除操作一般为区块删除,选定开始的历史时间并指定后续的区块.很少单独删除某个时间或者分开的随机时间的数据.&lt;/li&gt;
  &lt;li&gt;数据一般远远超过内存大小,所以缓存基本无用.系统一般是 IO 密集型&lt;/li&gt;
  &lt;li&gt;读操作是十分典型的升序或者降序的顺序读,&lt;/li&gt;
  &lt;li&gt;高并发的读操作十分常见.&lt;/li&gt;
&lt;/ul&gt;

&lt;blockquote&gt;
  &lt;p&gt;常见的时间序列数据库:&lt;/p&gt;
&lt;/blockquote&gt;

&lt;ul&gt;
  &lt;li&gt;influxDB	https://influxdata.com/&lt;/li&gt;
  &lt;li&gt;RRDtool	http://oss.oetiker.ch/rrdtool/&lt;/li&gt;
  &lt;li&gt;Graphite	http://graphite.readthedocs.org/en/latest/&lt;/li&gt;
  &lt;li&gt;OpenTSDB	http://opentsdb.net/&lt;/li&gt;
  &lt;li&gt;Kdb+	http://kx.com/&lt;/li&gt;
  &lt;li&gt;Druid	http://druid.io/&lt;/li&gt;
  &lt;li&gt;KairosDB	http://kairosdb.github.io/&lt;/li&gt;
  &lt;li&gt;Prometheus	https://prometheus.io/&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;prometheus&quot;&gt;什么是Prometheus&lt;/h2&gt;

&lt;p&gt;Prometheus是由 SoundCloud 开发的开源监控报警系统和时序列数据库(TSDB)，可以看作是Google内部监控系统Borgmon的一个（非官方）实现。&lt;/p&gt;

&lt;p&gt;并且保持独立于任何公司,Prometheus 在2016加入 CNCF ( Cloud Native Computing Foundation ), 作为在 kubernetes 之后的第二个由基金会主持的项目.&lt;/p&gt;

&lt;p&gt;为什么选择Prometheus而不是其它TSDB实现（如InfluxDB）?&lt;/p&gt;

&lt;p&gt;主要是因为Prometheus的核心功能，查询语言PromQL，它更像一种可编程计算器，而不是其那么像SQL，也意味着PromQL可以近乎无限之组合出各种查询结果&lt;/p&gt;

&lt;h2 id=&quot;section&quot;&gt;主要特点&lt;/h2&gt;

&lt;ol&gt;
  &lt;li&gt;多维数据模型（时序列数据由metric名和一组key/value组成）&lt;/li&gt;
  &lt;li&gt;在多维度上灵活的查询语言(PromQl)&lt;/li&gt;
  &lt;li&gt;不依赖分布式存储，单主节点工作.&lt;/li&gt;
  &lt;li&gt;通过基于HTTP的pull方式采集时序数据&lt;/li&gt;
  &lt;li&gt;可以通过中间网关进行时序列数据推送(pushing)&lt;/li&gt;
  &lt;li&gt;目标服务器可以通过发现服务或者静态配置实现&lt;/li&gt;
  &lt;li&gt;多种可视化和仪表盘支持&lt;/li&gt;
&lt;/ol&gt;

&lt;h2 id=&quot;section-1&quot;&gt;相关组件&lt;/h2&gt;

&lt;p&gt;Prometheus生态系统由多个组件组成，其中许多是可选的：&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Prometheus server&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;主要负责数据采集和存储，提供PromQL查询语言的支持&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;客户端sdk&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;官方提供的客户端类库有go、java、scala、python、ruby，其他还有很多第三方开发的类库，支持nodejs、php、erlang等&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Push Gateway&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;支持临时性Job主动推送指标的中间网关&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;PromDash&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;使用rails开发的dashboard，用于可视化指标数据；目前普遍用Grafana代替&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;exporters&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;支持其他数据源的指标导入到Prometheus，支持数据库、硬件、消息中间件、存储系统、http服务器、jmx等&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;alertmanager&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;实验性的报警管理端(alartmanager,单独进行报警汇总,分发,屏蔽等 )&lt;/p&gt;

&lt;p&gt;promethues 的各个组件基本都是用 golang 编写,对编译和部署十分友好.并且没有特殊依赖.基本都是独立工作.&lt;/p&gt;

&lt;h2 id=&quot;prometheus-1&quot;&gt;prometheus架构&lt;/h2&gt;

&lt;hr /&gt;

&lt;p&gt;&lt;img src=&quot;/pic/prometheus/1.svg&quot; alt=&quot;1&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Prometheus的基本原理是通过HTTP协议周期性抓取被监控组件的状态，任意组件只要提供对应的HTTP接口就可以接入监控。不需要任何SDK或者其他的集成过程。这样做非常适合做虚拟化环境监控系统，&lt;/p&gt;

&lt;p&gt;比如VM、Docker、Kubernetes等。输出被监控组件信息的HTTP接口被叫做exporter 。目前互联网公司常用的组件大部分都有exporter可以直接使用，比如Varnish、Haproxy、Nginx、MySQL、Linux系统信息(包括磁盘、内存、CPU、网络等等)。&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;Prometheus服务过程大概是这样：&lt;/p&gt;
&lt;/blockquote&gt;

&lt;ol&gt;
  &lt;li&gt;
    &lt;p&gt;Prometheus Daemon负责定时去目标上抓取metrics(指标)数据，每个抓取目标需要暴露一个http服务的接口给它定时抓取。Prometheus支持通过配置文件、文本文件、Zookeeper、Consul、DNS SRV Lookup等方式指定抓取目标。Prometheus采用PULL的方式进行监控，即服务器可以直接通过目标PULL数据或者间接地通过中间网关来Push数据。&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Prometheus在本地存储抓取的所有数据，并通过一定规则进行清理和整理数据，并把得到的结果存储到新的时间序列中。&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Prometheus通过PromQL和其他API可视化地展示收集的数据。Prometheus支持很多方式的图表可视化，例如Grafana、自带的Promdash以及自身提供的模版引擎等等。Prometheus还提供HTTP API的查询方式，自定义所需要的输出。&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;PushGateway支持Client主动推送metrics到PushGateway，而Prometheus只是定时去Gateway上抓取数据。&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Alertmanager是独立于Prometheus的一个组件，可以支持Prometheus的查询语句，提供十分灵活的报警方式。&lt;/p&gt;
  &lt;/li&gt;
&lt;/ol&gt;

&lt;h2 id=&quot;prometheus-2&quot;&gt;prometheus部署&lt;/h2&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-shell&quot; data-lang=&quot;shell&quot;&gt;docker run &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
	-p 9090:9090 &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
	-v /tmp/prometheus.yml:/etc/prometheus/prometheus.yml &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
	-v /home/mtime/prometheus-docker/data：/prometheus/data &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
	prom/prometheus&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

</description>
        <pubDate>Thu, 27 Jul 2017 00:00:00 +0800</pubDate>
        <link>/docker/Prometheus.html</link>
        <guid isPermaLink="true">/docker/Prometheus.html</guid>
        
        
        <category>Docker</category>
        
      </item>
    
      <item>
        <title>CAdvisor-容器信息采集</title>
        <description>&lt;ul&gt;
  &lt;li&gt;所有主机节点运行CAdvisor&lt;/li&gt;
&lt;/ul&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-shell&quot; data-lang=&quot;shell&quot;&gt;docker run &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
  --volume&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;/:/rootfs:ro &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
  --volume&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;/var/run:/var/run:rw &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
  --volume&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;/sys:/sys:ro &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
  --volume&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;/var/lib/docker/:/var/lib/docker:ro &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
  --publish&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;8080:8080 &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
  --detach&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;true&lt;/span&gt; &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
  --name&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;cadvisor &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
  google/cadvisor:latest&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;ul&gt;
  &lt;li&gt;浏览器访问&lt;/li&gt;
&lt;/ul&gt;

&lt;blockquote&gt;
  &lt;p&gt;http://host-ip:8080&lt;/p&gt;
&lt;/blockquote&gt;

&lt;blockquote&gt;
  &lt;p&gt;http://host-ip:8080/metrics&lt;/p&gt;
&lt;/blockquote&gt;

</description>
        <pubDate>Tue, 25 Jul 2017 00:00:00 +0800</pubDate>
        <link>/docker/CAdvisor.html</link>
        <guid isPermaLink="true">/docker/CAdvisor.html</guid>
        
        
        <category>Docker</category>
        
      </item>
    
      <item>
        <title>Harbor-docker企业级仓库</title>
        <description>&lt;ul id=&quot;markdown-toc&quot;&gt;
  &lt;li&gt;&lt;a href=&quot;#harbor&quot; id=&quot;markdown-toc-harbor&quot;&gt;Harbor简介&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#section&quot; id=&quot;markdown-toc-section&quot;&gt;下载安装&lt;/a&gt;    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#section-1&quot; id=&quot;markdown-toc-section-1&quot;&gt;部署要求&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;harbor&quot;&gt;Harbor简介&lt;/h2&gt;

&lt;p&gt;Harbor是一个用于存储和分发Docker镜像的企业级Registry服务器，通过添加一些企业必需的功能特性，例如安全、标识和管理等，扩展了开源Docker Distribution。&lt;/p&gt;

&lt;p&gt;作为一个企业级私有Registry服务器，Harbor提供了更好的性能和安全。提升用户使用Registry构建和运行环境传输镜像的效率。&lt;/p&gt;

&lt;p&gt;Harbor支持安装在多个Registry节点的镜像资源复制，镜像全部保存在私有Registry中， 确保数据和知识产权在公司内部网络中管控。&lt;/p&gt;

&lt;p&gt;另外，Harbor也提供了高级的安全特性，诸如用户管理，访问控制和活动审计等。&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;基于角色的访问控制 - 用户与Docker镜像仓库通过“项目”进行组织管理，一个用户可以对多个镜像仓库在同一命名空间（project）里有不同的权限。&lt;/li&gt;
  &lt;li&gt;镜像复制 - 镜像可以在多个Registry实例中复制（同步）。尤其适合于负载均衡，高可用，混合云和多云的场景。&lt;/li&gt;
  &lt;li&gt;图形化用户界面 - 用户可以通过浏览器来浏览，检索当前Docker镜像仓库，管理项目和命名空间。&lt;/li&gt;
  &lt;li&gt;AD/LDAP 支持 - Harbor可以集成企业内部已有的AD/LDAP，用于鉴权认证管理。&lt;/li&gt;
  &lt;li&gt;审计管理 - 所有针对镜像仓库的操作都可以被记录追溯，用于审计管理。&lt;/li&gt;
  &lt;li&gt;国际化 - 已拥有英文、中文、德文、日文和俄文的本地化版本。更多的语言将会添加进来。&lt;/li&gt;
  &lt;li&gt;RESTful API - RESTful API 提供给管理员对于Harbor更多的操控, 使得与其它管理软件集成变得更容易。&lt;/li&gt;
  &lt;li&gt;部署简单 - 提供在线和离线两种安装工具， 也可以安装到vSphere平台(OVA方式)虚拟设备。&lt;/li&gt;
&lt;/ul&gt;

&lt;hr /&gt;

&lt;ul&gt;
  &lt;li&gt;项目地址&lt;/li&gt;
&lt;/ul&gt;

&lt;blockquote&gt;
  &lt;p&gt;https://github.com/vmware/harbor/tree/master/docs&lt;/p&gt;
&lt;/blockquote&gt;

&lt;hr /&gt;

&lt;h2 id=&quot;section&quot;&gt;下载安装&lt;/h2&gt;

&lt;blockquote&gt;
  &lt;p&gt;https://github.com/vmware/harbor/releases&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h3 id=&quot;section-1&quot;&gt;部署要求&lt;/h3&gt;

&lt;ol&gt;
  &lt;li&gt;python2.7或更高版本&lt;/li&gt;
  &lt;li&gt;安装docker1.12或更高版本&lt;/li&gt;
  &lt;li&gt;安装docker-compose&lt;/li&gt;
&lt;/ol&gt;

&lt;ul&gt;
  &lt;li&gt;安装docker-compose&lt;/li&gt;
&lt;/ul&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-shell&quot; data-lang=&quot;shell&quot;&gt;curl -L https://get.daocloud.io/docker/compose/releases/download/1.12.0/docker-compose-&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;uname -s&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;-&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;uname -m&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt; &amp;gt; /usr/local/bin/docker-compose
chmod +x /usr/local/bin/docker-compose&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;ul&gt;
  &lt;li&gt;下载安装包&lt;/li&gt;
&lt;/ul&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-shell&quot; data-lang=&quot;shell&quot;&gt;wget https://github.com/vmware/harbor/releases/download/v1.1.2/harbor-online-installer-v1.1.2.tgz
tar xf harbor-online-installer-v1.1.2.tgz&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;ul&gt;
  &lt;li&gt;配置harbor.cfg&lt;/li&gt;
&lt;/ul&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-shell&quot; data-lang=&quot;shell&quot;&gt;&lt;span class=&quot;c&quot;&gt;#必选配置&lt;/span&gt;

hostname：用来访问web的地址IP或域名可加端口号；
ui_url_protocol：仓库被访问的时候使用的协议；
db_password：设置一个DB的强类型密码
max_job_workers：最大job数量，默认是3，主要用来跑从库同步任务的。
customize_crt：默认是on
ssl_cert: ssl证书的位置；前提是设置了https的协议
ssl_cert_key: sslkey的位置；前提设置了https的协议
secretkey_path：用于密文同步镜像的key

&lt;span class=&quot;c&quot;&gt;#可选配置：仅在第一次启动时生效；后续的启动会自动忽略这些配置；推荐后期直接在web页面上配置即可。&lt;/span&gt;

Email settings:用于用户重置密码时发送邮件。
harbor_admin_password：默认的web登录密码。
auth_mode：认证模式：本地数据库认证或LDAP认证。
ldap_url：ldap的配置
project_creation_restriction：是否允许普通用户创建项目；默认任何人都可以创建，可设置adminonly，只有admin可以创建。
verify_remote_cert： harbor同步时是否验证对端的证书。&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;ul&gt;
  &lt;li&gt;启动Harbor&lt;/li&gt;
&lt;/ul&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-shell&quot; data-lang=&quot;shell&quot;&gt;./install.sh&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;hr /&gt;

&lt;p&gt;&lt;img src=&quot;/pic/harbor/1.png&quot; alt=&quot;1&quot; /&gt;&lt;/p&gt;

&lt;hr /&gt;

&lt;p&gt;end&lt;/p&gt;
</description>
        <pubDate>Mon, 24 Jul 2017 00:00:00 +0800</pubDate>
        <link>/docker/harbor.html</link>
        <guid isPermaLink="true">/docker/harbor.html</guid>
        
        
        <category>Docker</category>
        
      </item>
    
      <item>
        <title>shadow代理</title>
        <description>&lt;ul&gt;
  &lt;li&gt;
    &lt;p&gt;下载shadow二进制文件&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;编写配置文件&lt;/p&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-shell&quot; data-lang=&quot;shell&quot;&gt;cat shadow.json 
&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;s2&quot;&gt;&quot;addr&quot;&lt;/span&gt;: &lt;span class=&quot;s2&quot;&gt;&quot;:8080&quot;&lt;/span&gt;,
  &lt;span class=&quot;s2&quot;&gt;&quot;dial_timeout&quot;&lt;/span&gt;: 30000,
  &lt;span class=&quot;s2&quot;&gt;&quot;read_timeout&quot;&lt;/span&gt;: 120000,
  &lt;span class=&quot;s2&quot;&gt;&quot;proxy&quot;&lt;/span&gt;: &lt;span class=&quot;s2&quot;&gt;&quot;192.168.1.2:8080&quot;&lt;/span&gt;,
  &lt;span class=&quot;s2&quot;&gt;&quot;verbose&quot;&lt;/span&gt;: &lt;span class=&quot;nb&quot;&gt;true&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;ul&gt;
  &lt;li&gt;addr：监听的IP地址和端口号&lt;/li&gt;
  &lt;li&gt;dial_timeout：连接超时时间&lt;/li&gt;
  &lt;li&gt;read_timeout：传送数据超时时间&lt;/li&gt;
  &lt;li&gt;proxy：二级代理ip和端口号&lt;/li&gt;
  &lt;li&gt;verbose：打印日志&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;supervisorshadow&quot;&gt;利用supervisor管理shadow&lt;/h3&gt;

&lt;p&gt;cat shadow.ini&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-shell&quot; data-lang=&quot;shell&quot;&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;program:shadow]
&lt;span class=&quot;nb&quot;&gt;command&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; /home/mtime/shadow -c /home/mtime/shadow.json
autostart &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;true
&lt;/span&gt;autorestart &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;true
&lt;/span&gt;startsecs &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; 3
startretries &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; 3
stopwaitsecs &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; 5
user &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; root
redirect_stderr &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;true
&lt;/span&gt;stdout_logfile &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; /home/mtime/logs/supervisor/shadow.log
stdout_logfile_maxbytes &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; 500MB
stdout_logfile_backups &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; 0&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;blockquote&gt;
  &lt;p&gt;supervisorctl reload&lt;/p&gt;
&lt;/blockquote&gt;

&lt;blockquote&gt;
  &lt;p&gt;supervisorctl status&lt;/p&gt;
&lt;/blockquote&gt;

&lt;hr /&gt;

&lt;p&gt;end&lt;/p&gt;

</description>
        <pubDate>Mon, 24 Jul 2017 00:00:00 +0800</pubDate>
        <link>/network/shadow.html</link>
        <guid isPermaLink="true">/network/shadow.html</guid>
        
        
        <category>Network</category>
        
      </item>
    
      <item>
        <title>dns代理-overture</title>
        <description>&lt;ul id=&quot;markdown-toc&quot;&gt;
  &lt;li&gt;&lt;a href=&quot;#section&quot; id=&quot;markdown-toc-section&quot;&gt;为什么需要这个代理工具？&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#section-1&quot; id=&quot;markdown-toc-section-1&quot;&gt;解决方案&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#section-2&quot; id=&quot;markdown-toc-section-2&quot;&gt;安装配置&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#overture&quot; id=&quot;markdown-toc-overture&quot;&gt;启动overture&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#section-3&quot; id=&quot;markdown-toc-section-3&quot;&gt;编写启动脚本&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;section&quot;&gt;为什么需要这个代理工具？&lt;/h2&gt;

&lt;ol&gt;
  &lt;li&gt;假设我们有一个域名是www.abc.com;这个一名在公网DNS上有A记录，但是在内网DNS上没有；&lt;/li&gt;
  &lt;li&gt;我们的笔记本指向了内网DNS，此时，当我们解析www.abc.com时，内网DNS将无法解析；&lt;/li&gt;
  &lt;li&gt;根据DNS解析原理；此时无法解析是正常的；因为内网dns上配置了abc.com权威综；当权威dns没有此A记录；是不会发生递归或迭代查询的。&lt;/li&gt;
  &lt;li&gt;最终需要实现：优先返回内网dns记录；内网dns没有A记录；则去公网DNS查询一遍。&lt;/li&gt;
&lt;/ol&gt;

&lt;h2 id=&quot;section-1&quot;&gt;解决方案&lt;/h2&gt;

&lt;ul&gt;
  &lt;li&gt;
    &lt;p&gt;使用overture代理所有的dns请求；优先找主DNS解析；主DNS无法解析；找备DNS解析；&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;项目源码&lt;/p&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;blockquote&gt;
  &lt;p&gt;https://github.com/shawn1m/overture&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h2 id=&quot;section-2&quot;&gt;安装配置&lt;/h2&gt;

&lt;ul&gt;
  &lt;li&gt;下载overture&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;https://github.com/shawn1m/overture/releases&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-shell&quot; data-lang=&quot;shell&quot;&gt;mkdir overture &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;cd &lt;/span&gt;overture
wget https://github.com/shawn1m/overture/releases/download/1.3.5.2/overture-linux-amd64.zip
unzip overture-linux-amd64.zip
cp ip_network_sample ip_network_sample.bak
&lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;0.0.0.0/0&quot;&lt;/span&gt; &amp;gt; ip_network_sample&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;ul&gt;
  &lt;li&gt;overture返回主DNS的结果给客户端需要满足两个两件：主DNS给overture返回了一条A记录；此A记录匹配ip_network_sample这个文件中的网段。&lt;/li&gt;
&lt;/ul&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-shell&quot; data-lang=&quot;shell&quot;&gt;cat config.json
&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;s2&quot;&gt;&quot;BindAddress&quot;&lt;/span&gt;: &lt;span class=&quot;s2&quot;&gt;&quot;:53&quot;&lt;/span&gt;,
  &lt;span class=&quot;s2&quot;&gt;&quot;PrimaryDNS&quot;&lt;/span&gt;: &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;s2&quot;&gt;&quot;Name&quot;&lt;/span&gt;: &lt;span class=&quot;s2&quot;&gt;&quot;dns-master&quot;&lt;/span&gt;,
      &lt;span class=&quot;s2&quot;&gt;&quot;Address&quot;&lt;/span&gt;: &lt;span class=&quot;s2&quot;&gt;&quot;192.168.1.1:53&quot;&lt;/span&gt;,
      &lt;span class=&quot;s2&quot;&gt;&quot;Protocol&quot;&lt;/span&gt;: &lt;span class=&quot;s2&quot;&gt;&quot;udp&quot;&lt;/span&gt;,
      &lt;span class=&quot;s2&quot;&gt;&quot;SOCKS5Address&quot;&lt;/span&gt;: &lt;span class=&quot;s2&quot;&gt;&quot;&quot;&lt;/span&gt;,
      &lt;span class=&quot;s2&quot;&gt;&quot;Timeout&quot;&lt;/span&gt;: 5,
      &lt;span class=&quot;s2&quot;&gt;&quot;EDNSClientSubnet&quot;&lt;/span&gt;: &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;s2&quot;&gt;&quot;Policy&quot;&lt;/span&gt;: &lt;span class=&quot;s2&quot;&gt;&quot;disable&quot;&lt;/span&gt;,
        &lt;span class=&quot;s2&quot;&gt;&quot;ExternalIP&quot;&lt;/span&gt;: &lt;span class=&quot;s2&quot;&gt;&quot;&quot;&lt;/span&gt;
      &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;,
  &lt;span class=&quot;s2&quot;&gt;&quot;AlternativeDNS&quot;&lt;/span&gt;: &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;s2&quot;&gt;&quot;Name&quot;&lt;/span&gt;: &lt;span class=&quot;s2&quot;&gt;&quot;dns-salve&quot;&lt;/span&gt;,
      &lt;span class=&quot;s2&quot;&gt;&quot;Address&quot;&lt;/span&gt;: &lt;span class=&quot;s2&quot;&gt;&quot;114.114.114.114:53&quot;&lt;/span&gt;,
      &lt;span class=&quot;s2&quot;&gt;&quot;Protocol&quot;&lt;/span&gt;: &lt;span class=&quot;s2&quot;&gt;&quot;udp&quot;&lt;/span&gt;,
      &lt;span class=&quot;s2&quot;&gt;&quot;SOCKS5Address&quot;&lt;/span&gt;: &lt;span class=&quot;s2&quot;&gt;&quot;&quot;&lt;/span&gt;,
      &lt;span class=&quot;s2&quot;&gt;&quot;Timeout&quot;&lt;/span&gt;: 5,
      &lt;span class=&quot;s2&quot;&gt;&quot;EDNSClientSubnet&quot;&lt;/span&gt;: &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;s2&quot;&gt;&quot;Policy&quot;&lt;/span&gt;: &lt;span class=&quot;s2&quot;&gt;&quot;disable&quot;&lt;/span&gt;,
        &lt;span class=&quot;s2&quot;&gt;&quot;ExternalIP&quot;&lt;/span&gt;: &lt;span class=&quot;s2&quot;&gt;&quot;&quot;&lt;/span&gt;
      &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;,
  &lt;span class=&quot;s2&quot;&gt;&quot;OnlyPrimaryDNS&quot;&lt;/span&gt;: &lt;span class=&quot;nb&quot;&gt;false&lt;/span&gt;,
  &lt;span class=&quot;s2&quot;&gt;&quot;RedirectIPv6Record&quot;&lt;/span&gt;: &lt;span class=&quot;nb&quot;&gt;true&lt;/span&gt;,
  &lt;span class=&quot;s2&quot;&gt;&quot;IPNetworkFile&quot;&lt;/span&gt;: &lt;span class=&quot;s2&quot;&gt;&quot;./ip_network_sample&quot;&lt;/span&gt;,
  &lt;span class=&quot;s2&quot;&gt;&quot;DomainFile&quot;&lt;/span&gt;: &lt;span class=&quot;s2&quot;&gt;&quot;./domain_sample&quot;&lt;/span&gt;,
  &lt;span class=&quot;s2&quot;&gt;&quot;DomainBase64Decode&quot;&lt;/span&gt;: &lt;span class=&quot;nb&quot;&gt;true&lt;/span&gt;,
  &lt;span class=&quot;s2&quot;&gt;&quot;HostsFile&quot;&lt;/span&gt;: &lt;span class=&quot;s2&quot;&gt;&quot;./hosts_sample&quot;&lt;/span&gt;,
  &lt;span class=&quot;s2&quot;&gt;&quot;MinimumTTL&quot;&lt;/span&gt;: 3600,
  &lt;span class=&quot;s2&quot;&gt;&quot;CacheSize&quot;&lt;/span&gt; : 500,
  &lt;span class=&quot;s2&quot;&gt;&quot;RejectQtype&quot;&lt;/span&gt;: &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;255]
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;ul&gt;
  &lt;li&gt;BindAddress：监听的ip地址和端口号，默认同时监听TCP和UDP端口。&lt;/li&gt;
  &lt;li&gt;PrimaryDNS：主dns&lt;/li&gt;
  &lt;li&gt;Name：dns标志&lt;/li&gt;
  &lt;li&gt;Address：dns的ip和端口号&lt;/li&gt;
  &lt;li&gt;Protocol：使用的协议&lt;/li&gt;
  &lt;li&gt;SOCKS5Address：转发dns请求到socket5代理&lt;/li&gt;
  &lt;li&gt;Timeout：代理到后端的超时时间&lt;/li&gt;
  &lt;li&gt;EDNSClientSubnet：智能dns解析，根据客户端的IP地址做判断而不是客户端指定的dns的ip地址；可参考 https://tools.ietf.org/html/rfc7871&lt;/li&gt;
  &lt;li&gt;MinimumTTL：overture缓存解析记录的时长&lt;/li&gt;
  &lt;li&gt;CacheSize：overture缓存大小&lt;/li&gt;
  &lt;li&gt;RejectQtype：拒绝指定类型的DNS请求：可参考 https://en.wikipedia.org/wiki/List_of_DNS_record_types&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;overture&quot;&gt;启动overture&lt;/h2&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-shell&quot; data-lang=&quot;shell&quot;&gt;./overture-linux-amd64 --help
Usage of ./overture-linux-amd64:
  -c string
        config file path &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;default &lt;span class=&quot;s2&quot;&gt;&quot;./config.json&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
  -l string
        log file path &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;default &lt;span class=&quot;s2&quot;&gt;&quot;./overture.log&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
  -p int
        number of processor to use &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;default 24&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
  -v    verbose mode&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;ul&gt;
  &lt;li&gt;-c：指定配置文件路径；默认当前启动路径的下的config.json文件&lt;/li&gt;
  &lt;li&gt;-l：指定日志路径和日志文件；默认当前启动路径下的overture.log&lt;/li&gt;
  &lt;li&gt;-p：指定进程数；默认当前cpu的核心数&lt;/li&gt;
  &lt;li&gt;-v：debug日志模式&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;section-3&quot;&gt;编写启动脚本&lt;/h2&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-shell&quot; data-lang=&quot;shell&quot;&gt;&lt;span class=&quot;c&quot;&gt;#!/bin/bash   &lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;set&lt;/span&gt; -e   
&lt;span class=&quot;nv&quot;&gt;TOOLS_NAME&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;overture-linux-amd64&quot;&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;TOOLS_PATH&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;/home/mtime/overture&quot;&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;TOOLS_SERVER_NAME&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Overture Server&quot;&lt;/span&gt; 
&lt;span class=&quot;nv&quot;&gt;DESCRIPTION&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Pls use /etc/init.d/overture start|stop|restart&quot;&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;PIDFILE&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;/home/mtime/overture/overture.pid&quot;&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt; ! -x &lt;span class=&quot;nv&quot;&gt;$DAEMON&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;;&lt;span class=&quot;k&quot;&gt;then
    &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; -e &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\0&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;33[32mNOT Find &lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;TOOLS_PATH&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;TOOLS_NAME&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\0&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;33[0m&quot;&lt;/span&gt;
    &lt;span class=&quot;nb&quot;&gt;exit &lt;/span&gt;1
&lt;span class=&quot;k&quot;&gt;fi   

case&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$1&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;in 
  &lt;/span&gt;start&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;   
         &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt; -f &lt;span class=&quot;nv&quot;&gt;$PIDFILE&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;;&lt;span class=&quot;k&quot;&gt;then
            &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; -e &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\0&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;33[32m&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;TOOLS_SERVER_NAME&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt; was Started.&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\0&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;33[0m&quot;&lt;/span&gt;
            &lt;span class=&quot;nb&quot;&gt;exit &lt;/span&gt;0
         &lt;span class=&quot;k&quot;&gt;fi
         &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; -e &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\0&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;33[32mSTARTTING &lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;TOOLS_SERVER_NAME&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;......&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\0&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;33[0m&quot;&lt;/span&gt;
         nohup &lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;TOOLS_PATH&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;/&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;TOOLS_NAME&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt; -c &lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;TOOLS_PATH&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;/config.json -l &lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;TOOLS_PATH&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;/overture.log &amp;amp;&amp;gt;/dev/null &amp;amp;  
         touch &lt;span class=&quot;nv&quot;&gt;$PIDFILE&lt;/span&gt;
         &lt;span class=&quot;p&quot;&gt;;;&lt;/span&gt;   
   stop&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; 
         &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt; ! -f &lt;span class=&quot;nv&quot;&gt;$PIDFILE&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;;&lt;span class=&quot;k&quot;&gt;then
            &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; -e &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\0&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;33[32m&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;TOOLS_SERVER_NAME&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt; was Stopped.&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\0&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;33[0m&quot;&lt;/span&gt;
            &lt;span class=&quot;nb&quot;&gt;exit &lt;/span&gt;0
         &lt;span class=&quot;k&quot;&gt;fi
         &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; -e &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\0&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;33[32mSTOPPING &lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;TOOLS_SERVER_NAME&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;......&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\0&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;33[0m&quot;&lt;/span&gt;
         &lt;span class=&quot;nb&quot;&gt;kill&lt;/span&gt; -9 &lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;pidof &lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;TOOLS_NAME&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt; &amp;amp;&amp;gt; /dev/null   
         rm -f &lt;span class=&quot;nv&quot;&gt;$PIDFILE&lt;/span&gt;
         &lt;span class=&quot;p&quot;&gt;;;&lt;/span&gt;   
   restart&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;   
         &lt;span class=&quot;nv&quot;&gt;$0&lt;/span&gt; stop &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; sleep 1 &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$0&lt;/span&gt; start   
         &lt;span class=&quot;p&quot;&gt;;;&lt;/span&gt;   
   &lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;   
         &lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; -e &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\0&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;33[31mUsage: &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$DESCRIPTION&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\0&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;33[0m&quot;&lt;/span&gt;
         &lt;span class=&quot;nb&quot;&gt;exit &lt;/span&gt;1   
&lt;span class=&quot;k&quot;&gt;esac&lt;/span&gt;   &lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;hr /&gt;

&lt;p&gt;end&lt;/p&gt;

</description>
        <pubDate>Mon, 24 Jul 2017 00:00:00 +0800</pubDate>
        <link>/network/overture.html</link>
        <guid isPermaLink="true">/network/overture.html</guid>
        
        
        <category>Network</category>
        
      </item>
    
  </channel>
</rss>
