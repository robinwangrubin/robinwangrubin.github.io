<?xml version="1.0" encoding="UTF-8"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Robin's Personal Website</title>
    <description></description>
    <link>/</link>
    <atom:link href="/feed.xml" rel="self" type="application/rss+xml"/>
    <pubDate>Thu, 23 Mar 2017 12:05:12 +0800</pubDate>
    <lastBuildDate>Thu, 23 Mar 2017 12:05:12 +0800</lastBuildDate>
    <generator>Jekyll v3.3.0</generator>
    
      <item>
        <title>递归算法--HanoiTower</title>
        <description>&lt;ul id=&quot;markdown-toc&quot;&gt;
  &lt;li&gt;&lt;a href=&quot;#section&quot; id=&quot;markdown-toc-section&quot;&gt;起源&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#section-1&quot; id=&quot;markdown-toc-section-1&quot;&gt;抽象成数学问题&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#section-2&quot; id=&quot;markdown-toc-section-2&quot;&gt;归纳法求解&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#section-3&quot; id=&quot;markdown-toc-section-3&quot;&gt;归纳总结&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#section-4&quot; id=&quot;markdown-toc-section-4&quot;&gt;递归算法分析&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#section-5&quot; id=&quot;markdown-toc-section-5&quot;&gt;调用方法的栈机制&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#pythond&quot; id=&quot;markdown-toc-pythond&quot;&gt;Pythond代码&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;section&quot;&gt;起源&lt;/h2&gt;

&lt;p&gt;汉诺塔（又称河内塔）问题是源于印度一个古老传说的益智玩具。&lt;/p&gt;

&lt;p&gt;大梵天创造世界的时候做了三根金刚石柱子，在一根柱子上从下往上按照大小顺序摞着64片黄金圆盘。&lt;/p&gt;

&lt;p&gt;大梵天命令婆罗门把圆盘从下面开始按大小顺序重新摆放在另一根柱子上。&lt;/p&gt;

&lt;p&gt;并且规定，在小圆盘上不能放大圆盘，在三根柱子之间一次只能移动一个圆盘。&lt;/p&gt;

&lt;h2 id=&quot;section-1&quot;&gt;抽象成数学问题&lt;/h2&gt;

&lt;p&gt;如下图所示，从左到右有A、B、C三根柱子，其中A柱子上面有从小叠到大的n个圆盘，现要求将A柱子上的圆盘移到C柱子上去.&lt;/p&gt;

&lt;p&gt;期间只有一个原则：一次只能移到一个盘子且大盘子不能在小盘子上面，求移动的步骤和移动的次数.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/pic/python/HanoiTower/1026866-20161016022859889-2055402664.jpg&quot; alt=&quot;1&quot; /&gt;&lt;/p&gt;

&lt;h2 id=&quot;section-2&quot;&gt;归纳法求解&lt;/h2&gt;

&lt;p&gt;n = 1&lt;/p&gt;

&lt;p&gt;第1次  1号盘  A —-&amp;gt;C&lt;/p&gt;

&lt;p&gt;n = 2&lt;/p&gt;

&lt;p&gt;第1次  1号盘  A—-&amp;gt;B&lt;/p&gt;

&lt;p&gt;第2次  2号盘  A—-&amp;gt;C&lt;/p&gt;

&lt;p&gt;第3次  1号盘  B—-&amp;gt;C&lt;/p&gt;

&lt;p&gt;n = 3&lt;/p&gt;

&lt;p&gt;第1次  1号盘  A—-&amp;gt;C&lt;/p&gt;

&lt;p&gt;第2次  2号盘  A—-&amp;gt;B&lt;/p&gt;

&lt;p&gt;第3次  1号盘  C—-&amp;gt;B&lt;/p&gt;

&lt;p&gt;第4次  3号盘  A—-&amp;gt;C&lt;/p&gt;

&lt;p&gt;第5次  1号盘  B—-&amp;gt;A&lt;/p&gt;

&lt;p&gt;第6次  2号盘  B—-&amp;gt;C&lt;/p&gt;

&lt;p&gt;第7次  1号盘  A—-&amp;gt;C&lt;/p&gt;

&lt;h2 id=&quot;section-3&quot;&gt;归纳总结&lt;/h2&gt;

&lt;p&gt;1个圆盘的次数 2的1次方减1&lt;/p&gt;

&lt;p&gt;2个圆盘的次数 2的2次方减1&lt;/p&gt;

&lt;p&gt;3个圆盘的次数 2的3次方减1&lt;/p&gt;

&lt;p&gt;n个圆盘的次数 2的n次方减1&lt;/p&gt;

&lt;h2 id=&quot;section-4&quot;&gt;递归算法分析&lt;/h2&gt;

&lt;p&gt;我们在利用计算机求汉诺塔问题时，必不可少的一步是对整个实现求解进行算法分析。到目前为止，求解汉诺塔问题最简单的算法还是同过递归来求，至于是什么是递归，递归实现的机制是什么，我们说的简单点就是自己是一个方法或者说是函数，但是在自己这个函数里有调用自己这个函数的语句，而这个调用怎么才能调用结束呢？这里还必须有一个结束点，或者具体的说是在调用到某一次后函数能返回一个确定的值，接着倒数第二个就能返回一个确定的值，一直到第一次调用的这个函数能返回一个确定的值。&lt;/p&gt;

&lt;p&gt;实现这个算法可以简单分为三个步骤：&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;
    &lt;p&gt;把n-1个盘子由 A 移到 B；&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;把第n个盘子由 A 移到 C；&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;把n-1个盘子由 B 移到 C；&lt;/p&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;从这里入手，在加上上面数学问题解法的分析，我们不难发现，移到的步数必定为奇数步：&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;
    &lt;p&gt;中间的一步是把最大的一个盘子由A移到C上去；&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;中间一步之上可以看成把A上n-1个盘子通过借助辅助塔（C塔）移到了B上，&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;中间一步之下可以看成把B上n-1个盘子通过借助辅助塔（A塔）移到了C上；&lt;/p&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;section-5&quot;&gt;调用方法的栈机制&lt;/h2&gt;

&lt;p&gt;特点：先进后出&lt;/p&gt;

&lt;p&gt;从主线程开始调用方法（函数）进行不停的压栈和出栈操作，函数的调用就是将函数压如栈中，函数的结束就是函数出栈的过程，这样就保证了方法调用的顺序流，即当函数出现多层嵌套时，需要从外到内一层层把函数压入栈中，最后栈顶的函数先执行结束（最内层的函数先执行结束）后出栈，再倒数第二层的函数执行结束出栈，到最后，第一个进栈的函数调用结束后从栈中弹出回到主线程，并且结束。&lt;/p&gt;

&lt;h2 id=&quot;pythond&quot;&gt;Pythond代码&lt;/h2&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-shell&quot; data-lang=&quot;shell&quot;&gt;def HanoiTower&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;n,source,Buffer,destination&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;:
    &lt;span class=&quot;k&quot;&gt;if &lt;/span&gt;n &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; 1:
        print&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;source&lt;/span&gt;,&lt;span class=&quot;s1&quot;&gt;'------&amp;gt;'&lt;/span&gt;,destination&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;return
    &lt;/span&gt;HanoiTower&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;n-1,source,destination,Buffer&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
    HanoiTower&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;1,source,Buffer,destination&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
    HanoiTower&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;n-1,Buffer,source,destination&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
HanoiTower&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;4,&lt;span class=&quot;s1&quot;&gt;'A'&lt;/span&gt;,&lt;span class=&quot;s1&quot;&gt;'B'&lt;/span&gt;,&lt;span class=&quot;s1&quot;&gt;'C'&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-shell&quot; data-lang=&quot;shell&quot;&gt;A ------&amp;gt; B
A ------&amp;gt; C
B ------&amp;gt; C
A ------&amp;gt; B
C ------&amp;gt; A
C ------&amp;gt; B
A ------&amp;gt; B
A ------&amp;gt; C
B ------&amp;gt; C
B ------&amp;gt; A
C ------&amp;gt; A
B ------&amp;gt; C
A ------&amp;gt; B
A ------&amp;gt; C
B ------&amp;gt; C&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;hr /&gt;

&lt;p&gt;end&lt;/p&gt;

</description>
        <pubDate>Fri, 10 Mar 2017 00:00:00 +0800</pubDate>
        <link>/python/HanoiTower.html</link>
        <guid isPermaLink="true">/python/HanoiTower.html</guid>
        
        
        <category>Python</category>
        
      </item>
    
      <item>
        <title>Tcpdump</title>
        <description>&lt;ul id=&quot;markdown-toc&quot;&gt;
  &lt;li&gt;&lt;a href=&quot;#section&quot; id=&quot;markdown-toc-section&quot;&gt;二层抓包&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#section-1&quot; id=&quot;markdown-toc-section-1&quot;&gt;三层抓包&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#section-2&quot; id=&quot;markdown-toc-section-2&quot;&gt;四层抓包&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#section-3&quot; id=&quot;markdown-toc-section-3&quot;&gt;常用抓包示例&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;section&quot;&gt;二层抓包&lt;/h2&gt;

&lt;p&gt;抓源MAC地址为 00:0C:29:37:77:1D 的数据帧&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;tcpdump -i eth0 -nn ether src 00:0C:29:37:77:1D&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;抓目的MAC地址为 00:0C:29:37:77:1D 的数据帧&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;tcpdump -i eth0 -nn ether dst 00:0C:29:37:77:1D&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;抓源MAC地址或者目的MAC为 00:0C:29:37:77:1D 的数据帧&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;tcpdump -i eth0 -nn ether host 00:0C:29:37:77:1D&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;抓取以太网广播流量&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;tcpdump -i eth0 -nn ether broadcast&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;抓取以太网多播流量&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;tcpdump -i eth0 -nn multicast&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;抓取与定义的protocol协议相同的数据帧&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;tcpdump -i eth0 -nn ether proto 0800&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;根据vlan-id抓包&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;tcpdump -i eth0 -nn vlan vlan 10 and vlan 20 and vlan 30&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;抓与定义的MAC的地址不相同的数据帧&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;tcpdump -i eth0 -nn ! ether host 00:0C:29:37:77:1D&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;三层Pv4广播流量，目的ip为192.168.1.255（C类广播地址）对应的二层以太网帧MAC地址为ff:ff:ff:ff:ff:ff&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;ARP目的MAC为ff:ff:ff:ff:ff:ff&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;但凡IPv4多播流量，以太网帧目的MAC以01:00:5e开头，以01:00:5e开头的目的MAC地址都被视为以太网多播帧&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;但凡IPv6多播流量，以太网帧目的MAC以33:33开头，以33:33打头的目的MAC地址都被视为以太网多播帧&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;以太网类型是指以太网帧帧头的ETHER-TYPE字段，用来表示以太网帧帧头所封装的高层协议流量的协议类型。0x0800 0x86dd 0x0806 分别表示IPv4 IPv6 以及ARP流量&lt;/code&gt;&lt;/p&gt;

&lt;hr /&gt;

&lt;h2 id=&quot;section-1&quot;&gt;三层抓包&lt;/h2&gt;

&lt;p&gt;根据目的IP地址抓包&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;tcpdump -i eth0 -nn dst host 114.114.114.114&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;根据源IP地址抓包&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;tcpdump -i eth0 -nn src host 114.114.114.114&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;根据指定IP地址抓包&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;tcpdump -i eth0 -nn host 114.114.114.114&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;根据源网段抓包&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;tcpdump -i eth0 -nn src net 192.168.1.0/24&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;根据目的网段抓包&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;tcpdump -i eth0 -nn dst net 192.168.1.0/24&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;根据网段抓包&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;tcpdump -i eth0 -nn net 192.168.1.0/24&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;抓取ICMP流量&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;tcpdump -i eth0 -nn ip proto 1&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;抓取ICMP request的报文&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;tcpdump -i eth0 -nn icmp [icmptype]==icmp-echo&lt;/p&gt;
&lt;/blockquote&gt;

&lt;blockquote&gt;
  &lt;p&gt;tcpdump -i eth0 -nn icmp[icmptype]==8&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;抓取ICMP reply的报文&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;tcpdump -i eth0 -nn icmp [icmptype]==icmp-echoreply&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;抓取ICMP流量但PING包除外&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;tcpdump -i eth0 -nn icmp [icmptype] != icmp-echo and icmp [icmptype] !=icmp-echoreply&lt;/p&gt;
&lt;/blockquote&gt;

&lt;hr /&gt;

&lt;h2 id=&quot;section-2&quot;&gt;四层抓包&lt;/h2&gt;

&lt;p&gt;根据源端口抓包&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;tcpdump -i eth0 -nn src port 22&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;根据目的端口抓包&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;tcpdump -i eth0 -nn dst port 22&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;根据端口号抓包&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;tcpdump -i eth0 -nn port 22&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;根据源端口范围抓包&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;tcpdump -i eth0 -nn tcp src portrange 1-1024&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;根据目的端口范围抓包&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;tcpdump -i eth0 -nn tcp dst portrange 1-1024&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;根据端口范围抓包&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;tcpdump -i eth0 -nn tcp portrange 1-1024&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;抓取tcp连接中SYN为1或FIN为1的数据包&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;tcpdump -i eth0 -nn “tcp [tcpflags] &amp;amp; (tcp-syn | tcp-fin) !=0”&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;抓取所有RST为1的tcp包&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;tcpdump -i eth0 -nn  “tcp [tcpflags] &amp;amp; (tcp-rst) !=0”&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;SYN //建立连接&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;FIN //拆除连接&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;ACK //确认连接&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;RST //立刻拆除连接&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;PSH //将数据提交给后端应用程序处理&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;tcp[13] &amp;amp; 0x00 =0 //抓取所有标记位都置为1的tcp流量&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;tcp[13] &amp;amp; 0x01 =1 //抓取FIN位为1，ACK为0的TCP流量&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;tcp[13] &amp;amp; 0x03 =3 //抓取FIN和FIN位同时置为1的TCP流量&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;tcp[13] &amp;amp; 0x05 =5 //抓取RST和FIN位同时置为1的TCP流量&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;tcp[13] &amp;amp; 0x06 =6 //抓取SYN和RST位同时置为1的TCP流量&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;tcp[13] &amp;amp; 0x08 =8 //抓取PSH位置为1，但ACK为0的TCP流量&lt;/code&gt;&lt;/p&gt;

&lt;hr /&gt;

&lt;h2 id=&quot;section-3&quot;&gt;常用抓包示例&lt;/h2&gt;

&lt;blockquote&gt;
  &lt;p&gt;tcpdump -i eth0 -nnv host www.baidu.com -c 1000 -w /home/baidu.cap&lt;/p&gt;
&lt;/blockquote&gt;

&lt;hr /&gt;

&lt;p&gt;end&lt;/p&gt;

</description>
        <pubDate>Sat, 04 Feb 2017 00:00:00 +0800</pubDate>
        <link>/command/Tcpdump.html</link>
        <guid isPermaLink="true">/command/Tcpdump.html</guid>
        
        
        <category>Command</category>
        
      </item>
    
      <item>
        <title>shell循环语句</title>
        <description>&lt;ul id=&quot;markdown-toc&quot;&gt;
  &lt;li&gt;&lt;a href=&quot;#if&quot; id=&quot;markdown-toc-if&quot;&gt;IF循环&lt;/a&gt;    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#section&quot; id=&quot;markdown-toc-section&quot;&gt;生产脚本示例&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#for&quot; id=&quot;markdown-toc-for&quot;&gt;FOR循环&lt;/a&gt;    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#section-1&quot; id=&quot;markdown-toc-section-1&quot;&gt;生产脚本示例&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#while&quot; id=&quot;markdown-toc-while&quot;&gt;WHILE循环&lt;/a&gt;    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#section-2&quot; id=&quot;markdown-toc-section-2&quot;&gt;生产脚本示例&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#case&quot; id=&quot;markdown-toc-case&quot;&gt;CASE语句&lt;/a&gt;    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#section-3&quot; id=&quot;markdown-toc-section-3&quot;&gt;生产脚本示例&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#section-4&quot; id=&quot;markdown-toc-section-4&quot;&gt;函数&lt;/a&gt;    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#section-5&quot; id=&quot;markdown-toc-section-5&quot;&gt;生产脚本示例&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#section-6&quot; id=&quot;markdown-toc-section-6&quot;&gt;数组&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;if&quot;&gt;IF循环&lt;/h2&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-shell&quot; data-lang=&quot;shell&quot;&gt;&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt; -f /etc/hosts &lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;then
    &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;ture&quot;&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;else
    &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;fail&quot;&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;fi&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-shell&quot; data-lang=&quot;shell&quot;&gt;&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt; -f /etc/hosts &lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;;&lt;span class=&quot;k&quot;&gt;then
    &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;/etc/hosts is ture&quot;&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;elif&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt; -f /etc/sysconfig/network-scripts/ifcfg-eth0 &lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;;&lt;span class=&quot;k&quot;&gt;then
    &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;ifcfg-eth0 is ture&quot;&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;else
    &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;all fail&quot;&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;fi&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;h3 id=&quot;section&quot;&gt;生产脚本示例&lt;/h3&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-shell&quot; data-lang=&quot;shell&quot;&gt;&lt;span class=&quot;c&quot;&gt;#!/bin/bash&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;STATUS_CODE&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;$(&lt;/span&gt;curl -I --connect-timeout 10 -o /dev/null -s -w %&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;http_code&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\n&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt; wangrubin.com&lt;span class=&quot;k&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$STATUS_CODE&lt;/span&gt; -eq 200 &lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;;&lt;span class=&quot;k&quot;&gt;then
    &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;Nginx is Ok&quot;&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;else
    &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;Nginx is Fail&quot;&lt;/span&gt;
    &lt;span class=&quot;nb&quot;&gt;exit &lt;/span&gt;1
&lt;span class=&quot;k&quot;&gt;fi&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;h2 id=&quot;for&quot;&gt;FOR循环&lt;/h2&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-shell&quot; data-lang=&quot;shell&quot;&gt;&lt;span class=&quot;k&quot;&gt;for &lt;/span&gt;n &lt;span class=&quot;k&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;seq 10&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;do
   &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$n&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;done&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-shell&quot; data-lang=&quot;shell&quot;&gt;&lt;span class=&quot;nv&quot;&gt;num&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;100
&lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;0;&lt;span class=&quot;nv&quot;&gt;$i&lt;/span&gt;&amp;lt;&lt;span class=&quot;nv&quot;&gt;$num&lt;/span&gt;;i+&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;2&lt;span class=&quot;o&quot;&gt;))&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;do
    &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$i&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;done&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;h3 id=&quot;section-1&quot;&gt;生产脚本示例&lt;/h3&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-shell&quot; data-lang=&quot;shell&quot;&gt;&lt;span class=&quot;c&quot;&gt;#!/bin/bash&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;#Author: wangrubin&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;#Email: robinwangrubin@gmail.com&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;#Description: This script is for test&lt;/span&gt;

&lt;span class=&quot;nv&quot;&gt;ERROR&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;test.ShowSeatCacheException&quot;&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;FILEPATHS&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;/var/test_20*/logs/catalina.out&quot;&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;TATAL_NUM&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;0
&lt;span class=&quot;nv&quot;&gt;DATE_TIME&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;$(&lt;/span&gt;date &lt;span class=&quot;s2&quot;&gt;&quot;+%F %H:%M&quot;&lt;/span&gt; -d &lt;span class=&quot;s2&quot;&gt;&quot;1 minute ago&quot;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;for &lt;/span&gt;FILE &lt;span class=&quot;k&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;FILEPATHS&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;;
&lt;span class=&quot;k&quot;&gt;do
          &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;NUM&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;$(&lt;/span&gt;grep &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$DATE_TIME&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;FILE&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt; |grep &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$ERROR&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt; |wc -l&lt;span class=&quot;k&quot;&gt;)&lt;/span&gt;
          &lt;span class=&quot;nv&quot;&gt;TATAL_NUM&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;$((&lt;/span&gt;TATAL_NUM+NUM&lt;span class=&quot;k&quot;&gt;))&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;done
&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$TATAL_NUM&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-shell&quot; data-lang=&quot;shell&quot;&gt;&lt;span class=&quot;c&quot;&gt;#!/bin/bash&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;for &lt;/span&gt;n &lt;span class=&quot;k&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;1..255&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;do
 &lt;/span&gt;ping -c 2 -W 2 10.0.0.&lt;span class=&quot;nv&quot;&gt;$n&lt;/span&gt; &amp;amp;&amp;gt;/dev/null
 &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$?&lt;/span&gt; -eq 0 &lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;;&lt;span class=&quot;k&quot;&gt;then
    &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;10.0.0.&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$n&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt; is active&quot;&lt;/span&gt;
 &lt;span class=&quot;k&quot;&gt;else
    &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;10.0.0.&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$n&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt; is shutdown&quot;&lt;/span&gt;
 &lt;span class=&quot;k&quot;&gt;fi
done&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;h2 id=&quot;while&quot;&gt;WHILE循环&lt;/h2&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-shell&quot; data-lang=&quot;shell&quot;&gt;&lt;span class=&quot;c&quot;&gt;#!/bin/bash&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;1
&lt;span class=&quot;k&quot;&gt;while&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;((&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$int&lt;/span&gt;&amp;lt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;20 &lt;span class=&quot;o&quot;&gt;))&lt;/span&gt; 
&lt;span class=&quot;k&quot;&gt;do
  &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;echo &lt;/span&gt;123
  &lt;span class=&quot;nb&quot;&gt;let &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;int+1
&lt;span class=&quot;k&quot;&gt;done&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-shell&quot; data-lang=&quot;shell&quot;&gt;&lt;span class=&quot;k&quot;&gt;while &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;true
&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;do
  &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;echo &lt;/span&gt;123
&lt;span class=&quot;k&quot;&gt;done&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-shell&quot; data-lang=&quot;shell&quot;&gt;&lt;span class=&quot;k&quot;&gt;while&lt;/span&gt; :
&lt;span class=&quot;k&quot;&gt;do
  &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;echo &lt;/span&gt;123
&lt;span class=&quot;k&quot;&gt;done&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;h3 id=&quot;section-2&quot;&gt;生产脚本示例&lt;/h3&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-shell&quot; data-lang=&quot;shell&quot;&gt;&lt;span class=&quot;k&quot;&gt;while &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;read &lt;/span&gt;line
&lt;span class=&quot;k&quot;&gt;do
  &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$line&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;done&lt;/span&gt; &amp;lt; /etc/passwd&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;h2 id=&quot;case&quot;&gt;CASE语句&lt;/h2&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-shell&quot; data-lang=&quot;shell&quot;&gt;&lt;span class=&quot;c&quot;&gt;#!/bin/bash&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;read&lt;/span&gt; -t 5 -p &lt;span class=&quot;s2&quot;&gt;&quot;Pls input a number less 10: &quot;&lt;/span&gt; n
&lt;span class=&quot;k&quot;&gt;case&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$n&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;in
&lt;/span&gt;1&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;The num you put is 1&quot;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;;;&lt;/span&gt;
2&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;The num you put is 2&quot;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;;;&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;3-9]&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;The num you put is &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$n&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;;;&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;The num you put must be a number and the volue must be less 9&quot;&lt;/span&gt;
    &lt;span class=&quot;nb&quot;&gt;exit&lt;/span&gt;;
&lt;span class=&quot;k&quot;&gt;esac&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;h3 id=&quot;section-3&quot;&gt;生产脚本示例&lt;/h3&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-shell&quot; data-lang=&quot;shell&quot;&gt;&lt;span class=&quot;c&quot;&gt;#!/bin/bash&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;#chkconfig:2345 54 65&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;#description: Stop/Start/Reload Nginx scripts&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;ACTION&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$1&lt;/span&gt;
. /etc/init.d/functions
&lt;span class=&quot;nv&quot;&gt;nginx&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;/application/nginx/sbin/nginx&quot;&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;prog&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;nginx&quot;&lt;/span&gt;
start&lt;span class=&quot;o&quot;&gt;(){&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt; -f /var/lock/subsys/&lt;span class=&quot;nv&quot;&gt;$prog&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;;&lt;span class=&quot;k&quot;&gt;then
      &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;Nginx is runing&quot;&lt;/span&gt;
      &lt;span class=&quot;k&quot;&gt;return &lt;/span&gt;0
    &lt;span class=&quot;k&quot;&gt;fi&lt;/span&gt;    
    &lt;span class=&quot;nv&quot;&gt;$nginx&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;RETVAL&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$?&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$RETVAL&lt;/span&gt; -eq 0 &lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;;&lt;span class=&quot;k&quot;&gt;then
       &lt;/span&gt;touch /var/lock/subsys/&lt;span class=&quot;nv&quot;&gt;$prog&lt;/span&gt;
       action &lt;span class=&quot;s2&quot;&gt;&quot;Starting nginx&quot;&lt;/span&gt; /bin/true
    &lt;span class=&quot;k&quot;&gt;else
       &lt;/span&gt;action &lt;span class=&quot;s2&quot;&gt;&quot;Starting nginx&quot;&lt;/span&gt; /bin/false
    &lt;span class=&quot;k&quot;&gt;fi
    return&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$RETVAL&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
stop&lt;span class=&quot;o&quot;&gt;(){&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt; ! -f /var/lock/subsys/&lt;span class=&quot;nv&quot;&gt;$prog&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;;&lt;span class=&quot;k&quot;&gt;then
       &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;Nginx is stopped&quot;&lt;/span&gt;      
       &lt;span class=&quot;k&quot;&gt;return &lt;/span&gt;0 
    &lt;span class=&quot;k&quot;&gt;fi&lt;/span&gt;
    &lt;span class=&quot;nv&quot;&gt;$nginx&lt;/span&gt; -s stop &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;RETVAL&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$?&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$RETVAL&lt;/span&gt; -eq 0 &lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;;&lt;span class=&quot;k&quot;&gt;then
       &lt;/span&gt;rm -f /var/lock/subsys/&lt;span class=&quot;nv&quot;&gt;$prog&lt;/span&gt;
       action &lt;span class=&quot;s2&quot;&gt;&quot;Stopping nginx&quot;&lt;/span&gt; /bin/true
    &lt;span class=&quot;k&quot;&gt;else
       &lt;/span&gt;action &lt;span class=&quot;s2&quot;&gt;&quot;Stopping nginx&quot;&lt;/span&gt; /bin/false
    &lt;span class=&quot;k&quot;&gt;fi
    return&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$RETVAL&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
reload&lt;span class=&quot;o&quot;&gt;(){&lt;/span&gt;
    &lt;span class=&quot;nv&quot;&gt;$nginx&lt;/span&gt; -s reload &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;RETVAL&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$?&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$RETVAL&lt;/span&gt; -eq 0 &lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;;&lt;span class=&quot;k&quot;&gt;then
       &lt;/span&gt;action &lt;span class=&quot;s2&quot;&gt;&quot;Reloading nginx&quot;&lt;/span&gt; /bin/true
    &lt;span class=&quot;k&quot;&gt;else
       &lt;/span&gt;action &lt;span class=&quot;s2&quot;&gt;&quot;Reloading nginx&quot;&lt;/span&gt; /bin/false
    &lt;span class=&quot;k&quot;&gt;fi
    return&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$RETVAL&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;case&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$ACTION&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;in
    &lt;/span&gt;start&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        start
        &lt;span class=&quot;p&quot;&gt;;;&lt;/span&gt;
    stop&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        stop
        &lt;span class=&quot;p&quot;&gt;;;&lt;/span&gt;
    restart&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        stop
        start
        &lt;span class=&quot;p&quot;&gt;;;&lt;/span&gt;
    reload&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        reload
        &lt;span class=&quot;p&quot;&gt;;;&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;Pls choose start|stop|restart|reload&quot;&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;esac&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-shell&quot; data-lang=&quot;shell&quot;&gt;cp nginx.sh /etc/init.d/nginx
chmod +x /etc/init.d/nginx
chkconfig --add /etc/init.d/nginx
chkconfig nginx on
chkconfig --list nginx&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;hr /&gt;

&lt;h2 id=&quot;section-4&quot;&gt;函数&lt;/h2&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-shell&quot; data-lang=&quot;shell&quot;&gt;&lt;span class=&quot;c&quot;&gt;#!/bin/bash&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;function &lt;/span&gt;Fist_Function&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;This is my first function&quot;&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return &lt;/span&gt;0
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;

Fist_Function&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;h3 id=&quot;section-5&quot;&gt;生产脚本示例&lt;/h3&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-shell&quot; data-lang=&quot;shell&quot;&gt;&lt;span class=&quot;c&quot;&gt;#!/bin/bash&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;#Author: wangrubin&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;#Email: robinwangrubin@gmail.com&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;#Description: This script is for test&lt;/span&gt;

&lt;span class=&quot;nv&quot;&gt;URL&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$1&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;function &lt;/span&gt;CHECK_URL&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;STATUS_CODE&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;$(&lt;/span&gt;curl -I --connect-timeout 10 -o /dev/null -s -w %&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;http_code&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\n&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$URL&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$STATUS_CODE&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt; -eq 200 &lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;;&lt;span class=&quot;k&quot;&gt;then
   &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$1&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt; is Ok&quot;&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;else
   &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$1&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt; is False&quot;&lt;/span&gt;
   &lt;span class=&quot;k&quot;&gt;return &lt;/span&gt;0
&lt;span class=&quot;k&quot;&gt;fi&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$# &lt;/span&gt;-ne 1 &lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;;&lt;span class=&quot;k&quot;&gt;then
   &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot; Pls input a URL;For example http://www.baidu.com &quot;&lt;/span&gt;
   &lt;span class=&quot;nb&quot;&gt;exit &lt;/span&gt;1
&lt;span class=&quot;k&quot;&gt;fi

&lt;/span&gt;CHECK_URL &lt;span class=&quot;nv&quot;&gt;$URL&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;hr /&gt;

&lt;blockquote&gt;
  &lt;p&gt;break n：n表示跳出循环的层数，省略则跳出整个循环&lt;/p&gt;
&lt;/blockquote&gt;

&lt;blockquote&gt;
  &lt;p&gt;continue n ：n表示退到第n层循环，省略则跳过本次循环，进入下一个循环&lt;/p&gt;
&lt;/blockquote&gt;

&lt;blockquote&gt;
  &lt;p&gt;exit n：退出整个shell脚本，n为退出脚本后的状态返回值&lt;/p&gt;
&lt;/blockquote&gt;

&lt;blockquote&gt;
  &lt;p&gt;return n：退出当前函数，n为函数的返回值&lt;/p&gt;
&lt;/blockquote&gt;

&lt;ul&gt;
  &lt;li&gt;测试脚本&lt;/li&gt;
&lt;/ul&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-shell&quot; data-lang=&quot;shell&quot;&gt;&lt;span class=&quot;c&quot;&gt;#!/bin/bash&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;for&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;0;i&amp;lt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;5;i++&lt;span class=&quot;o&quot;&gt;))&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;do
 if&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$i&lt;/span&gt; -eq 3 &lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;;&lt;span class=&quot;k&quot;&gt;then
    continue&lt;/span&gt;
    &lt;span class=&quot;c&quot;&gt;#break&lt;/span&gt;
    &lt;span class=&quot;c&quot;&gt;#exit&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;fi
  &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$i&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;done
&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;OK&quot;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;hr /&gt;

&lt;h2 id=&quot;section-6&quot;&gt;数组&lt;/h2&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-shell&quot; data-lang=&quot;shell&quot;&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@CentOS_6 scripts]# &lt;span class=&quot;nv&quot;&gt;shuzu&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=(&lt;/span&gt;1 2 3&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@CentOS_6 scripts]# &lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;${#&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;shuzu&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[@]&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;
3
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@CentOS_6 scripts]# &lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;${#&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;shuzu&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[*]&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;
3
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@CentOS_6 scripts]# &lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;shuzu&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[0]&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt; 
1
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@CentOS_6 scripts]# &lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;shuzu&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[1]&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;
2
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@CentOS_6 scripts]# &lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;shuzu&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[2]&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;
3
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@CentOS_6 scripts]# &lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;shuzu&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[*]&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;
1 2 3&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-shell&quot; data-lang=&quot;shell&quot;&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@CentOS_6 scripts]# shuzu[3]&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;4   &lt;span class=&quot;c&quot;&gt;#添加数组中的成员&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@CentOS_6 scripts]# shuzu[4]&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;5
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@CentOS_6 scripts]# &lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;shuzu&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[*]&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;
1 2 3 4 5
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@CentOS_6 scripts]# &lt;span class=&quot;nb&quot;&gt;unset &lt;/span&gt;shuzu[4]    &lt;span class=&quot;c&quot;&gt;#删除数组中成员&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-shell&quot; data-lang=&quot;shell&quot;&gt;&lt;span class=&quot;c&quot;&gt;#!/bin/bash&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;function &lt;/span&gt;YN&lt;span class=&quot;o&quot;&gt;(){&lt;/span&gt;
curl -I &lt;span class=&quot;nv&quot;&gt;$1&lt;/span&gt; &amp;amp;&amp;gt;/dev/null
&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$?&lt;/span&gt; -ne 0 &lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;;&lt;span class=&quot;k&quot;&gt;then
        &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$1&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt; is bad&quot;&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;fi&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;shuzu&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=(&lt;/span&gt;http://www.baidu.com http://www.zhaiiker.com http://10.0.0.16&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;while &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;true
&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;do
  for&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;0;i&amp;lt;&lt;span class=&quot;k&quot;&gt;${#&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;shuzu&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[*]&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;;i++&lt;span class=&quot;o&quot;&gt;))&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;do
     &lt;/span&gt;YN &lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;shuzu&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[i]&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;done
&lt;/span&gt;sleep 10
&lt;span class=&quot;k&quot;&gt;done&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;hr /&gt;

&lt;p&gt;end&lt;/p&gt;
</description>
        <pubDate>Fri, 20 Jan 2017 00:00:00 +0800</pubDate>
        <link>/shell/shell-2.html</link>
        <guid isPermaLink="true">/shell/shell-2.html</guid>
        
        
        <category>Shell</category>
        
      </item>
    
      <item>
        <title>shell基础</title>
        <description>&lt;ul id=&quot;markdown-toc&quot;&gt;
  &lt;li&gt;&lt;a href=&quot;#shell&quot; id=&quot;markdown-toc-shell&quot;&gt;执行shell脚本的方式&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#shell-1&quot; id=&quot;markdown-toc-shell-1&quot;&gt;shell脚本开发基本规范&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#section&quot; id=&quot;markdown-toc-section&quot;&gt;变量的命名规范&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#section-1&quot; id=&quot;markdown-toc-section-1&quot;&gt;引号&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#section-2&quot; id=&quot;markdown-toc-section-2&quot;&gt;系统特殊变量&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#section-3&quot; id=&quot;markdown-toc-section-3&quot;&gt;变量的数学运算&lt;/a&gt;    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#section-4&quot; id=&quot;markdown-toc-section-4&quot;&gt;计算实例&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#section-5&quot; id=&quot;markdown-toc-section-5&quot;&gt;文件表达式&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#section-6&quot; id=&quot;markdown-toc-section-6&quot;&gt;整数变量表达式&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#section-7&quot; id=&quot;markdown-toc-section-7&quot;&gt;字符串变量表达式&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#section-8&quot; id=&quot;markdown-toc-section-8&quot;&gt;条件判断&lt;/a&gt;    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#test&quot; id=&quot;markdown-toc-test&quot;&gt;test&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#xxx-&quot; id=&quot;markdown-toc-xxx-&quot;&gt;[ xxx ]&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#xxx--xxx-&quot; id=&quot;markdown-toc-xxx--xxx-&quot;&gt;[[ xxx &amp;amp;&amp;amp; xxx ]]&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#section-9&quot; id=&quot;markdown-toc-section-9&quot;&gt;交互式脚本&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;shell&quot;&gt;执行shell脚本的方式&lt;/h2&gt;

&lt;blockquote&gt;
  &lt;p&gt;sh /service/scripts/test.sh&lt;/p&gt;
&lt;/blockquote&gt;

&lt;blockquote&gt;
  &lt;p&gt;. /service/scripts/test.sh //需要x权限&lt;/p&gt;
&lt;/blockquote&gt;

&lt;blockquote&gt;
  &lt;p&gt;source /service/scripts/test.sh  //需要x权限&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;Note: sourse或.的方式会导出脚本中的环境变量&lt;/p&gt;

&lt;hr /&gt;

&lt;h2 id=&quot;shell-1&quot;&gt;shell脚本开发基本规范&lt;/h2&gt;

&lt;ul&gt;
  &lt;li&gt;脚本第一行指定解释器&lt;/li&gt;
  &lt;li&gt;脚本开头添加版权信息email等&lt;/li&gt;
  &lt;li&gt;避免中文&lt;/li&gt;
  &lt;li&gt;成对的符号一起敲打&lt;/li&gt;
  &lt;li&gt;中括号格式[ xxx ]&lt;/li&gt;
  &lt;li&gt;流程语句先写完整语法，再加内容&lt;/li&gt;
  &lt;li&gt;代码要缩进&lt;/li&gt;
  &lt;li&gt;脚本添加正确的扩展名&lt;/li&gt;
  &lt;li&gt;添加注释！！！&lt;/li&gt;
&lt;/ul&gt;

&lt;hr /&gt;

&lt;h2 id=&quot;section&quot;&gt;变量的命名规范&lt;/h2&gt;

&lt;ul&gt;
  &lt;li&gt;禁止数字开头&lt;/li&gt;
  &lt;li&gt;可使用特殊字符 下划线 _&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;section-1&quot;&gt;引号&lt;/h2&gt;

&lt;ul&gt;
  &lt;li&gt;单引号：不解释变量&lt;/li&gt;
  &lt;li&gt;双引号：解释变量，变量赋值时可以是不连续的字符串&lt;/li&gt;
  &lt;li&gt;无引号：解释变量，变量赋值时必须是连续的字符串&lt;/li&gt;
  &lt;li&gt;反引号：变量赋值时需要引用命令 等价于$()&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;section-2&quot;&gt;系统特殊变量&lt;/h2&gt;

&lt;ul&gt;
  &lt;li&gt;$0：表示脚本本身的名字&lt;/li&gt;
  &lt;li&gt;$1：脚本后面的第一个参数&lt;/li&gt;
  &lt;li&gt;$2：脚本后面的第二个参数&lt;/li&gt;
  &lt;li&gt;$3：脚本后面的第三个参数&lt;/li&gt;
  &lt;li&gt;$9：脚本后面的第九个参数&lt;/li&gt;
  &lt;li&gt;$(10)：脚本后面第十个参数&lt;/li&gt;
  &lt;li&gt;$(11)：脚本后面第十一个参数&lt;/li&gt;
  &lt;li&gt;$#：取传参的个数&lt;/li&gt;
  &lt;li&gt;$?：上一个命令是否执行成功&lt;/li&gt;
  &lt;li&gt;$*：将所有传入参数当做一个参数（一行显示）&lt;/li&gt;
  &lt;li&gt;$@：将所有传入参数当多个参数处理（多行显示）&lt;/li&gt;
  &lt;li&gt;$$：当前脚本的进程号&lt;/li&gt;
&lt;/ul&gt;

&lt;hr /&gt;

&lt;h2 id=&quot;section-3&quot;&gt;变量的数学运算&lt;/h2&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-shell&quot; data-lang=&quot;shell&quot;&gt;&lt;span class=&quot;nv&quot;&gt;a&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;10
&lt;span class=&quot;nb&quot;&gt;let &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;b&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;a+5
&lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$b&lt;/span&gt;
15&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-shell&quot; data-lang=&quot;shell&quot;&gt;&lt;span class=&quot;nv&quot;&gt;a&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;100
&lt;span class=&quot;o&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;b&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;a+200&lt;span class=&quot;o&quot;&gt;))&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$b&lt;/span&gt;
300&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-shell&quot; data-lang=&quot;shell&quot;&gt;&lt;span class=&quot;nv&quot;&gt;a&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;100
&lt;span class=&quot;nv&quot;&gt;b&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;200
&lt;span class=&quot;nv&quot;&gt;c&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;$((&lt;/span&gt;a+b&lt;span class=&quot;k&quot;&gt;))&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$c&lt;/span&gt;
300&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;h3 id=&quot;section-4&quot;&gt;计算实例&lt;/h3&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-shell&quot; data-lang=&quot;shell&quot;&gt;&lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;seq -s &lt;span class=&quot;s2&quot;&gt;&quot;+&quot;&lt;/span&gt; 10&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;=&quot;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;$((&lt;/span&gt;&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;seq -s &lt;span class=&quot;s2&quot;&gt;&quot;+&quot;&lt;/span&gt; 10&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;))&lt;/span&gt;
1+2+3+4+5+6+7+8+9+10&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;55&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-shell&quot; data-lang=&quot;shell&quot;&gt;&lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;seq -s &lt;span class=&quot;s2&quot;&gt;&quot;+&quot;&lt;/span&gt; 10&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;=&quot;&lt;/span&gt;&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;seq -s &lt;span class=&quot;s2&quot;&gt;&quot;+&quot;&lt;/span&gt; 10|bc&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;
1+2+3+4+5+6+7+8+9+10&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;55&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;h2 id=&quot;section-5&quot;&gt;文件表达式&lt;/h2&gt;

&lt;ul&gt;
  &lt;li&gt;-f file 文件存在 则为真&lt;/li&gt;
  &lt;li&gt;-d directory 目录存在 则为真&lt;/li&gt;
  &lt;li&gt;-s size 文仔存在且大小不为0 则为真&lt;/li&gt;
  &lt;li&gt;-x executable 文件存在且具有可执行权限 则为真&lt;/li&gt;
  &lt;li&gt;-w write 文件存在且可写 则为真&lt;/li&gt;
  &lt;li&gt;-r read 文件存在且可读 则为真&lt;/li&gt;
  &lt;li&gt;-nt newer than 文件1比文件2新 则为真&lt;/li&gt;
  &lt;li&gt;-ot older than 文件1比文件2旧 则为真&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;section-6&quot;&gt;整数变量表达式&lt;/h2&gt;

&lt;ul&gt;
  &lt;li&gt;-eq 等于&lt;/li&gt;
  &lt;li&gt;-ne 不等于&lt;/li&gt;
  &lt;li&gt;-ge 大于等于&lt;/li&gt;
  &lt;li&gt;-gt 大于&lt;/li&gt;
  &lt;li&gt;-le 小于等于&lt;/li&gt;
  &lt;li&gt;-lt 小于&lt;/li&gt;
&lt;/ul&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-shell&quot; data-lang=&quot;shell&quot;&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt; 2 -gt 3 &lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;echo &lt;/span&gt;1 &lt;span class=&quot;o&quot;&gt;||&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;echo &lt;/span&gt;0
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt; 2 -lt 3 &lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;echo &lt;/span&gt;1 &lt;span class=&quot;o&quot;&gt;||&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;echo &lt;/span&gt;0
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt; 2 -eq 3 &lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;echo &lt;/span&gt;1 &lt;span class=&quot;o&quot;&gt;||&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;echo &lt;/span&gt;0
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt; 2 -eq 2 &lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;echo &lt;/span&gt;1 &lt;span class=&quot;o&quot;&gt;||&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;echo &lt;/span&gt;0
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt; 2 -ge 2 &lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;echo &lt;/span&gt;1 &lt;span class=&quot;o&quot;&gt;||&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;echo &lt;/span&gt;0
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt; 2 -le 2 &lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;echo &lt;/span&gt;1 &lt;span class=&quot;o&quot;&gt;||&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;echo &lt;/span&gt;0&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;h2 id=&quot;section-7&quot;&gt;字符串变量表达式&lt;/h2&gt;

&lt;ul&gt;
  &lt;li&gt;=	等于 ==&lt;/li&gt;
  &lt;li&gt;!= 不等于&lt;/li&gt;
  &lt;li&gt;-n 字符串不为空&lt;/li&gt;
  &lt;li&gt;-z 字符串为空&lt;/li&gt;
&lt;/ul&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-shell&quot; data-lang=&quot;shell&quot;&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;abc&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;abc&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;echo &lt;/span&gt;1 &lt;span class=&quot;o&quot;&gt;||&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;echo &lt;/span&gt;0
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;abc&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;abcd&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;echo &lt;/span&gt;1 &lt;span class=&quot;o&quot;&gt;||&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;echo &lt;/span&gt;0
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;abc&quot;&lt;/span&gt; !&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;abcd&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;echo &lt;/span&gt;1 &lt;span class=&quot;o&quot;&gt;||&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;echo &lt;/span&gt;0&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;h2 id=&quot;section-8&quot;&gt;条件判断&lt;/h2&gt;

&lt;h3 id=&quot;test&quot;&gt;test&lt;/h3&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-shell&quot; data-lang=&quot;shell&quot;&gt;&lt;span class=&quot;nb&quot;&gt;test&lt;/span&gt; -f /etc/hosts &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;echo &lt;/span&gt;0 &lt;span class=&quot;o&quot;&gt;||&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;echo &lt;/span&gt;1
&lt;span class=&quot;nb&quot;&gt;test&lt;/span&gt; -d /etc/hosts &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;echo &lt;/span&gt;0 &lt;span class=&quot;o&quot;&gt;||&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;echo &lt;/span&gt;1
&lt;span class=&quot;nb&quot;&gt;test&lt;/span&gt; ! -d /etc/hosts &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;echo &lt;/span&gt;0 &lt;span class=&quot;o&quot;&gt;||&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;echo &lt;/span&gt;1
&lt;span class=&quot;nb&quot;&gt;test&lt;/span&gt; -d /etc/ &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;echo &lt;/span&gt;0 &lt;span class=&quot;o&quot;&gt;||&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;echo &lt;/span&gt;1 &lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;h3 id=&quot;xxx-&quot;&gt;[ xxx ]&lt;/h3&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-shell&quot; data-lang=&quot;shell&quot;&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt; -f /etc/hosts &lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;echo &lt;/span&gt;0 &lt;span class=&quot;o&quot;&gt;||&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;echo &lt;/span&gt;1
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt; ! -f /etc/hosts &lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;echo &lt;/span&gt;0 &lt;span class=&quot;o&quot;&gt;||&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;echo &lt;/span&gt;1
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt; -f /etc/ &lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;echo &lt;/span&gt;0 &lt;span class=&quot;o&quot;&gt;||&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;echo &lt;/span&gt;1 
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt; -d /etc/ &lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;echo &lt;/span&gt;0 &lt;span class=&quot;o&quot;&gt;||&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;echo &lt;/span&gt;1
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt; -f &lt;span class=&quot;s2&quot;&gt;&quot;/etc/&quot;&lt;/span&gt; -o -f &lt;span class=&quot;s2&quot;&gt;&quot;/etc/hosts&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;echo &lt;/span&gt;0 &lt;span class=&quot;o&quot;&gt;||&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;echo &lt;/span&gt;1
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt; -d &lt;span class=&quot;s2&quot;&gt;&quot;/etc/&quot;&lt;/span&gt; -a -f &lt;span class=&quot;s2&quot;&gt;&quot;/etc/hosts&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;echo &lt;/span&gt;0 &lt;span class=&quot;o&quot;&gt;||&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;echo &lt;/span&gt;1
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt; -d &lt;span class=&quot;s2&quot;&gt;&quot;/etc/hosts&quot;&lt;/span&gt; -a -f &lt;span class=&quot;s2&quot;&gt;&quot;/etc/hosts&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;echo &lt;/span&gt;0 &lt;span class=&quot;o&quot;&gt;||&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;echo &lt;/span&gt;1&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-shell&quot; data-lang=&quot;shell&quot;&gt;&lt;span class=&quot;c&quot;&gt;#!/bin/bash&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt; -f /etc/hosts &lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
cat /etc/hosts
&lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;ok&quot;&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;exit &lt;/span&gt;0
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;||&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;fail&quot;&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;h3 id=&quot;xxx--xxx-&quot;&gt;[[ xxx &amp;amp;&amp;amp; xxx ]]&lt;/h3&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-shell&quot; data-lang=&quot;shell&quot;&gt;&lt;span class=&quot;o&quot;&gt;[[&lt;/span&gt; -d &lt;span class=&quot;s2&quot;&gt;&quot;/etc/&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; -f &lt;span class=&quot;s2&quot;&gt;&quot;/etc/hosts&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;]]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;echo &lt;/span&gt;0 &lt;span class=&quot;o&quot;&gt;||&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;echo &lt;/span&gt;1
&lt;span class=&quot;o&quot;&gt;[[&lt;/span&gt; -f &lt;span class=&quot;s2&quot;&gt;&quot;/etc/&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; -f &lt;span class=&quot;s2&quot;&gt;&quot;/etc/hosts&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;]]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;echo &lt;/span&gt;0 &lt;span class=&quot;o&quot;&gt;||&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;echo &lt;/span&gt;1
&lt;span class=&quot;o&quot;&gt;[[&lt;/span&gt; -f &lt;span class=&quot;s2&quot;&gt;&quot;/etc/&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;||&lt;/span&gt; -f &lt;span class=&quot;s2&quot;&gt;&quot;/etc/hosts&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;]]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;echo &lt;/span&gt;0 &lt;span class=&quot;o&quot;&gt;||&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;echo &lt;/span&gt;1&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;h2 id=&quot;section-9&quot;&gt;交互式脚本&lt;/h2&gt;

&lt;blockquote&gt;
  &lt;p&gt;read -t 5 -p “Pls input a number:” a&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;等待用户输入内容 并将内容复制给变量a 等待超时时间5s&lt;/p&gt;

&lt;hr /&gt;

&lt;p&gt;end&lt;/p&gt;
</description>
        <pubDate>Fri, 20 Jan 2017 00:00:00 +0800</pubDate>
        <link>/shell/shell-1.html</link>
        <guid isPermaLink="true">/shell/shell-1.html</guid>
        
        
        <category>Shell</category>
        
      </item>
    
      <item>
        <title>date</title>
        <description>&lt;h2 id=&quot;section&quot;&gt;显示当前时间&lt;/h2&gt;

&lt;h3 id=&quot;section-1&quot;&gt;2017-01-20&lt;/h3&gt;

&lt;blockquote&gt;
  &lt;p&gt;date +%F&lt;/p&gt;
&lt;/blockquote&gt;

&lt;blockquote&gt;
  &lt;p&gt;date +%Y-%m-%d&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h3 id=&quot;section-2&quot;&gt;2017-01-20 11:08:03&lt;/h3&gt;

&lt;blockquote&gt;
  &lt;p&gt;date +%F\ %H:%M:%S&lt;/p&gt;
&lt;/blockquote&gt;

&lt;blockquote&gt;
  &lt;p&gt;date +%F\ %T&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h3 id=&quot;section-3&quot;&gt;01/20/17&lt;/h3&gt;

&lt;blockquote&gt;
  &lt;p&gt;date +%D&lt;/p&gt;
&lt;/blockquote&gt;

&lt;blockquote&gt;
  &lt;p&gt;date +%m/%d/%y&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h3 id=&quot;jan2017-1118&quot;&gt;20/Jan/2017 11:18&lt;/h3&gt;

&lt;blockquote&gt;
  &lt;p&gt;date +%d/%b/%Y\ %H:%M&lt;/p&gt;
&lt;/blockquote&gt;

&lt;hr /&gt;

&lt;h2 id=&quot;section-4&quot;&gt;显示一分钟之前的时间&lt;/h2&gt;

&lt;blockquote&gt;
  &lt;p&gt;date +%F\ %H:%M:%S -d “-1 min”&lt;/p&gt;
&lt;/blockquote&gt;

&lt;blockquote&gt;
  &lt;p&gt;date +%F\ %T -d “-1 min”&lt;/p&gt;
&lt;/blockquote&gt;

&lt;blockquote&gt;
  &lt;p&gt;date +%F\ %T -d “1 minutes ago”&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h2 id=&quot;section-5&quot;&gt;显示一天之前的时间&lt;/h2&gt;

&lt;blockquote&gt;
  &lt;p&gt;date +%F -d “1 day ago”&lt;/p&gt;
&lt;/blockquote&gt;

&lt;blockquote&gt;
  &lt;p&gt;date +%F\ %H:%M:%S -d “1 day ago”&lt;/p&gt;
&lt;/blockquote&gt;

&lt;blockquote&gt;
  &lt;p&gt;date +%F\ %T -d “-1 day”&lt;/p&gt;
&lt;/blockquote&gt;

&lt;hr /&gt;

&lt;p&gt;end&lt;/p&gt;
</description>
        <pubDate>Fri, 20 Jan 2017 00:00:00 +0800</pubDate>
        <link>/command/data.html</link>
        <guid isPermaLink="true">/command/data.html</guid>
        
        
        <category>Command</category>
        
      </item>
    
      <item>
        <title>awk</title>
        <description>&lt;p&gt;测试数据&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-shell&quot; data-lang=&quot;shell&quot;&gt;cat passwd.txt 
root x 0 0 root /root /bin/bash
bin x 1 1 bin /bin /sbin/nologin
daemon x 2 2 daemon /sbin /sbin/nologin
adm x 3 4 adm /var/adm /sbin/nologin
lp x 4 7 lp /var/spool/lpd /sbin/nologin
sync x 5 0 sync /sbin /bin/sync
shutdown x 6 0 shutdown /sbin /sbin/shutdown
halt x 7 0 halt /sbin /sbin/halt
mail x 8 12 mail /var/spool/mail /sbin/nologin
uucp x 10 14 uucp /var/spool/uucp /sbin/nologin
operator x 11 0 operator /root /sbin/nologin
games x 12 100 games /usr/games /sbin/nologin
gopher x 13 30 gopher /var/gopher /sbin/nologin
ftp x 14 50 FTP User /var/ftp /sbin/nologin
nobody x 99 99 Nobody / /sbin/nologin
dbus x 81 81 System message bus / /sbin/nologin
vcsa x 69 69 virtual console memory owner /dev /sbin/nologin
abrt x 173 173  /etc/abrt /sbin/nologin
haldaemon x 68 68 HAL daemon / /sbin/nologin
ntp x 38 38  /etc/ntp /sbin/nologin
saslauth x 499 76 Saslauthd user /var/empty/saslauth /sbin/nologin
postfix x 89 89  /var/spool/postfix /sbin/nologin
sshd x 74 74 Privilege-separated SSH /var/empty/sshd /sbin/nologin
tcpdump x 72 72  / /sbin/nologin
nginx x 500 501  /home/nginx /sbin/nologin&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;h2 id=&quot;section&quot;&gt;取指定列&lt;/h2&gt;

&lt;ul&gt;
  &lt;li&gt;取第二列&lt;/li&gt;
&lt;/ul&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-shell&quot; data-lang=&quot;shell&quot;&gt;awk &lt;span class=&quot;s1&quot;&gt;'{print $2}'&lt;/span&gt; passwd.txt&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;ul&gt;
  &lt;li&gt;取第三列&lt;/li&gt;
&lt;/ul&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-shell&quot; data-lang=&quot;shell&quot;&gt;awk &lt;span class=&quot;s1&quot;&gt;'{print $3}'&lt;/span&gt; passwd.txt&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;ul&gt;
  &lt;li&gt;取最后一列&lt;/li&gt;
&lt;/ul&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-shell&quot; data-lang=&quot;shell&quot;&gt;awk &lt;span class=&quot;s1&quot;&gt;'{print $NF}'&lt;/span&gt; passwd.txt&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;ul&gt;
  &lt;li&gt;取倒数第二列&lt;/li&gt;
&lt;/ul&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-shell&quot; data-lang=&quot;shell&quot;&gt;awk &lt;span class=&quot;s1&quot;&gt;'{print $(NF-1)}'&lt;/span&gt; passwd.txt&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;h2 id=&quot;section-1&quot;&gt;取指定范围的行的内容&lt;/h2&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-shell&quot; data-lang=&quot;shell&quot;&gt;awk &lt;span class=&quot;s1&quot;&gt;'{if(NR&amp;gt;4&amp;amp;&amp;amp;NR&amp;lt;11) print $0}'&lt;/span&gt; passwd.txt&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;h2 id=&quot;section-2&quot;&gt;自定义分隔符&lt;/h2&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-shell&quot; data-lang=&quot;shell&quot;&gt;awk -F &lt;span class=&quot;s2&quot;&gt;&quot;[/]&quot;&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'{print $NF}'&lt;/span&gt; passwd.txt &lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;h2 id=&quot;section-3&quot;&gt;显示行号&lt;/h2&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-shell&quot; data-lang=&quot;shell&quot;&gt;awk &lt;span class=&quot;s1&quot;&gt;'{print NR,$NF}'&lt;/span&gt; passwd.txt&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;h2 id=&quot;section-4&quot;&gt;典型应用&lt;/h2&gt;

&lt;ul&gt;
  &lt;li&gt;获取主机IP地址&lt;/li&gt;
&lt;/ul&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-shell&quot; data-lang=&quot;shell&quot;&gt;ifconfig |awk -F &lt;span class=&quot;s1&quot;&gt;'[ :]+'&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'NR==2 {print $4}'&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;ul&gt;
  &lt;li&gt;批量设置开启启动项&lt;/li&gt;
&lt;/ul&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-shell&quot; data-lang=&quot;shell&quot;&gt;chkconfig --list|grep 3:on|egrep -v &lt;span class=&quot;s2&quot;&gt;&quot;crond|network|rsyslog|sshd|sysstat&quot;&lt;/span&gt;|awk &lt;span class=&quot;s1&quot;&gt;'{print &quot;chkconfig&quot;,$1,&quot;off&quot;}'&lt;/span&gt;|bash&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;ul&gt;
  &lt;li&gt;查看网络连接数&lt;/li&gt;
&lt;/ul&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-shell&quot; data-lang=&quot;shell&quot;&gt;netstat -nut|grep &lt;span class=&quot;s2&quot;&gt;&quot;ESTABLISHED&quot;&lt;/span&gt;|awk -F &lt;span class=&quot;s1&quot;&gt;'[ :]+'&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'{print $(NF-3)}'&lt;/span&gt; |sort|uniq -c&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;ul&gt;
  &lt;li&gt;删除Exited的docker容器&lt;/li&gt;
&lt;/ul&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-shell&quot; data-lang=&quot;shell&quot;&gt;/usr/bin/docker ps -a |grep &lt;span class=&quot;s2&quot;&gt;&quot;Exited&quot;&lt;/span&gt;|awk &lt;span class=&quot;s1&quot;&gt;'{print $1}'&lt;/span&gt;|xargs --no-run-if-empty docker rm&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;h2 id=&quot;awk&quot;&gt;awk数组&lt;/h2&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-shell&quot; data-lang=&quot;shell&quot;&gt;awk &lt;span class=&quot;s1&quot;&gt;'BEGIN{array[1]=&quot;oldboy&quot;;array[2]=&quot;oldgirl&quot;;for(key in array) print key,array[key]}'&lt;/span&gt;
awk &lt;span class=&quot;s1&quot;&gt;'{array[$1]=$2}END{for(key in array) print key,array[key]}'&lt;/span&gt; /etc/hosts
netstat -ant|awk &lt;span class=&quot;s1&quot;&gt;'/^tcp/ {S[$NF]++}END{for (k in S) print k,S[k]}'&lt;/span&gt;|sort -nrk2&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;h2 id=&quot;section-5&quot;&gt;指定列的数值相加&lt;/h2&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-shell&quot; data-lang=&quot;shell&quot;&gt;awk &lt;span class=&quot;s1&quot;&gt;'{a+=$3}END{print a}'&lt;/span&gt; passwd.txt&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;h2 id=&quot;awk-1&quot;&gt;awk过滤关键字&lt;/h2&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-shell&quot; data-lang=&quot;shell&quot;&gt;awk &lt;span class=&quot;s1&quot;&gt;'/192.168.*/'&lt;/span&gt; test.txt&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;h2 id=&quot;awk-2&quot;&gt;awk条件判断&lt;/h2&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-shell&quot; data-lang=&quot;shell&quot;&gt;awk &lt;span class=&quot;s1&quot;&gt;'{if($1==&quot;192.168.20.238&quot;) print $2}'&lt;/span&gt; test.txt |sort |uniq -c|sort -k1 -nr
awk &lt;span class=&quot;s1&quot;&gt;'{if($1==&quot;192.168.20.238&quot;) print $2,$3}'&lt;/span&gt; test.txt|awk &lt;span class=&quot;s1&quot;&gt;'{S[$1]+=$2}END{for (k in S) print k,S[k]}'&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;hr /&gt;

&lt;p&gt;end&lt;/p&gt;
</description>
        <pubDate>Fri, 20 Jan 2017 00:00:00 +0800</pubDate>
        <link>/command/awk.html</link>
        <guid isPermaLink="true">/command/awk.html</guid>
        
        
        <category>Command</category>
        
      </item>
    
      <item>
        <title>Docker Mesos集群架构</title>
        <description>&lt;ul id=&quot;markdown-toc&quot;&gt;
  &lt;li&gt;&lt;a href=&quot;#section&quot; id=&quot;markdown-toc-section&quot;&gt;实验环境准备&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#section-1&quot; id=&quot;markdown-toc-section-1&quot;&gt;系统环境准备&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#zookeeper&quot; id=&quot;markdown-toc-zookeeper&quot;&gt;部署zookeeper&lt;/a&gt;    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#zk&quot; id=&quot;markdown-toc-zk&quot;&gt;安装zk&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#zk-1&quot; id=&quot;markdown-toc-zk-1&quot;&gt;配置zk&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#zk-2&quot; id=&quot;markdown-toc-zk-2&quot;&gt;启动zk&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#zk-3&quot; id=&quot;markdown-toc-zk-3&quot;&gt;验证zk&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#mesos&quot; id=&quot;markdown-toc-mesos&quot;&gt;部署mesos&lt;/a&gt;    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#mesos-1&quot; id=&quot;markdown-toc-mesos-1&quot;&gt;安装mesos&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#mesos-2&quot; id=&quot;markdown-toc-mesos-2&quot;&gt;配置mesos&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#mesos-master&quot; id=&quot;markdown-toc-mesos-master&quot;&gt;启动mesos-master&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#mesos-slave&quot; id=&quot;markdown-toc-mesos-slave&quot;&gt;启动mesos-slave&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#mesos-3&quot; id=&quot;markdown-toc-mesos-3&quot;&gt;验证mesos&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#section-2&quot; id=&quot;markdown-toc-section-2&quot;&gt;常见异常&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#marathon&quot; id=&quot;markdown-toc-marathon&quot;&gt;部署marathon&lt;/a&gt;    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#marathon-1&quot; id=&quot;markdown-toc-marathon-1&quot;&gt;安装marathon&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#marathon-2&quot; id=&quot;markdown-toc-marathon-2&quot;&gt;验证marathon&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#marathonmesosdocker&quot; id=&quot;markdown-toc-marathonmesosdocker&quot;&gt;marathon调用mesos部署docker容器&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;section&quot;&gt;实验环境准备&lt;/h2&gt;

&lt;p&gt;使用VMware创建5台虚拟机搭建mesos集群：&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;系统要求：CentOS-7.2&lt;/li&gt;
  &lt;li&gt;内核要求：3.10.0-327.el7.x86_64&lt;/li&gt;
  &lt;li&gt;Docker版本：Docker version 1.12.3, build 6b644ec&lt;/li&gt;
  &lt;li&gt;JAVA环境：JDK_1.8&lt;/li&gt;
  &lt;li&gt;Mesos版本：mesos-1.1.0&lt;/li&gt;
  &lt;li&gt;Zookeeper版本：zookeeper-3.4.6&lt;/li&gt;
  &lt;li&gt;Marathon版本：marathon-1.3.6&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;主机名和IP地址规划如下：&lt;/p&gt;

&lt;p&gt;mesos-master01 ==== 192.168.1.101	mesos-master zookeeper marathon&lt;/p&gt;

&lt;p&gt;mesos-master02 ==== 192.168.1.102   mesos-master zookeeper&lt;/p&gt;

&lt;p&gt;mesos-master03 ==== 192.168.1.103   mesos-master zookeeper&lt;/p&gt;

&lt;p&gt;mesos-slave01 ==== 192.168.1.104	mesos-slave&lt;/p&gt;

&lt;p&gt;mesos-slave02 ==== 192.168.1.105	mesos-slave&lt;/p&gt;

&lt;hr /&gt;

&lt;h2 id=&quot;section-1&quot;&gt;系统环境准备&lt;/h2&gt;

&lt;ul&gt;
  &lt;li&gt;主机名解析&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;所有节点：&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-shell&quot; data-lang=&quot;shell&quot;&gt;cat /etc/hosts
127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4
::1         localhost localhost.localdomain localhost6 localhost6.localdomain6
192.168.1.101  mesos-master01
192.168.1.102  mesos-master02
192.168.1.103  mesos-master03
192.168.1.104  mesos-slave01
192.168.1.105  mesos-slave02&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;ul&gt;
  &lt;li&gt;JAVA_1.8环境部署&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;master节点：&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-shell&quot; data-lang=&quot;shell&quot;&gt;tar xf jdk-8u11-linux-x64.tar.gz -C /usr/local/
cat &amp;gt;&amp;gt; /etc/profile &lt;span class=&quot;sh&quot;&gt;&amp;lt;&amp;lt;EOF
export JAVA_HOME=/usr/local/jdk1.8.0_11
export CLASSPATH=.:\$JAVA_HOME/lib/dt.jar:\$JAVA_HOME/lib/tools.jar
export PATH=\$JAVA_HOME/bin:\$PATH
EOF
&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;source&lt;/span&gt; /etc/profile&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;hr /&gt;

&lt;h2 id=&quot;zookeeper&quot;&gt;部署zookeeper&lt;/h2&gt;

&lt;h3 id=&quot;zk&quot;&gt;安装zk&lt;/h3&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;三台master节点部署zookeeper&lt;/code&gt;&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-shell&quot; data-lang=&quot;shell&quot;&gt;&lt;span class=&quot;nb&quot;&gt;cd&lt;/span&gt; /application/tools/
wget http://apache.fayea.com/zookeeper/zookeeper-3.4.6/zookeeper-3.4.6.tar.gz
tar xf zookeeper-3.4.6.tar.gz
mv zookeeper-3.4.6 /application/
ln -s /application/zookeeper-3.4.6/ /application/zookeeper
mv /application/zookeeper/conf/zoo_sample.cfg /application/zookeeper/conf/zoo.cfg&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;h3 id=&quot;zk-1&quot;&gt;配置zk&lt;/h3&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-shell&quot; data-lang=&quot;shell&quot;&gt;grep &lt;span class=&quot;s1&quot;&gt;'^[a-z]'&lt;/span&gt; zoo.cfg
&lt;span class=&quot;nv&quot;&gt;tickTime&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;2000
&lt;span class=&quot;nv&quot;&gt;initLimit&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;10
&lt;span class=&quot;nv&quot;&gt;syncLimit&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;5
&lt;span class=&quot;nv&quot;&gt;dataDir&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;/tmp/zookeeper
&lt;span class=&quot;nv&quot;&gt;clientPort&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;2181
server.1&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;192.168.1.101:3181:4181
server.2&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;192.168.1.102:3181:4181
server.3&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;192.168.1.103:3181:4181&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-shell&quot; data-lang=&quot;shell&quot;&gt;mkdir -p /tmp/zookeeper/
&lt;span class=&quot;nb&quot;&gt;echo &lt;/span&gt;1 &amp;gt; /tmp/zookeeper/myid		//master01执行
&lt;span class=&quot;nb&quot;&gt;echo &lt;/span&gt;2 &amp;gt; /tmp/zookeeper/myid		//master02执行
&lt;span class=&quot;nb&quot;&gt;echo &lt;/span&gt;3 &amp;gt; /tmp/zookeeper/myid		//master03执行&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;h3 id=&quot;zk-2&quot;&gt;启动zk&lt;/h3&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-shell&quot; data-lang=&quot;shell&quot;&gt;/application/zookeeper/bin/zkServer.sh start /application/zookeeper/conf/zoo.cfg&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;h3 id=&quot;zk-3&quot;&gt;验证zk&lt;/h3&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-shell&quot; data-lang=&quot;shell&quot;&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@mesos-master01 ~]# /application/zookeeper/bin/zkServer.sh status /application/zookeeper/conf/zoo.cfg
JMX enabled by default
Using config: /application/zookeeper/conf/zoo.cfg
Mode: follower&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-shell&quot; data-lang=&quot;shell&quot;&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@mesos-master02 ~]# /application/zookeeper/bin/zkServer.sh status /application/zookeeper/conf/zoo.cfg
JMX enabled by default
Using config: /application/zookeeper/conf/zoo.cfg
Mode: leader&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-shell&quot; data-lang=&quot;shell&quot;&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@mesos-master03 ~]# /application/zookeeper/bin/zkServer.sh status /application/zookeeper/conf/zoo.cfg
JMX enabled by default
Using config: /application/zookeeper/conf/zoo.cfg
Mode: follower&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;zk部署完成&lt;/p&gt;

&lt;hr /&gt;

&lt;h2 id=&quot;mesos&quot;&gt;部署mesos&lt;/h2&gt;

&lt;h3 id=&quot;mesos-1&quot;&gt;安装mesos&lt;/h3&gt;

&lt;p&gt;rpm包安装&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;https://open.mesosphere.com/downloads/mesos/&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;所有节点都部署mesos&lt;/code&gt;&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-shell&quot; data-lang=&quot;shell&quot;&gt;wget http://repos.mesosphere.com/el/7/x86_64/RPMS/mesos-1.1.0-2.0.107.centos701406.x86_64.rpm
yum localinstall mesos-1.1.0-2.0.107.centos701406.x86_64.rpm -y&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;Yum安装&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-shell&quot; data-lang=&quot;shell&quot;&gt;rpm -ivh http://repos.mesosphere.com/el/7/noarch/RPMS/mesosphere-el-repo-7-1.noarch.rpm
yum -y install mesos&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;h3 id=&quot;mesos-2&quot;&gt;配置mesos&lt;/h3&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;所有节点加入如下配置&lt;/code&gt;&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-shell&quot; data-lang=&quot;shell&quot;&gt;&lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;zk://192.168.1.101:2181,192.168.1.102:2181,192.168.1.103:2181/mesos&quot;&lt;/span&gt; &amp;gt; /etc/mesos/zk &lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;master节点加入如下配置&lt;/code&gt;&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-shell&quot; data-lang=&quot;shell&quot;&gt;&lt;span class=&quot;nb&quot;&gt;echo &lt;/span&gt;2 &amp;gt;/etc/mesos-master/quorum&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;h3 id=&quot;mesos-master&quot;&gt;启动mesos-master&lt;/h3&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-shell&quot; data-lang=&quot;shell&quot;&gt;systemctl &lt;span class=&quot;nb&quot;&gt;enable &lt;/span&gt;mesos-master
systemctl start mesos-master&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;h3 id=&quot;mesos-slave&quot;&gt;启动mesos-slave&lt;/h3&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-shell&quot; data-lang=&quot;shell&quot;&gt;systemctl &lt;span class=&quot;nb&quot;&gt;enable &lt;/span&gt;mesos-slave
systemctl start mesos-slave&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;h3 id=&quot;mesos-3&quot;&gt;验证mesos&lt;/h3&gt;

&lt;p&gt;http://192.168.1.101:5050&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/pic/docker-mesos/1.png&quot; alt=&quot;1&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/pic/docker-mesos/2.png&quot; alt=&quot;2&quot; /&gt;&lt;/p&gt;

&lt;p&gt;MASTER=$(mesos-resolve `cat /etc/mesos/zk`)&lt;/p&gt;

&lt;p&gt;mesos-execute –master=$MASTER –name=”cluster-test” –command=”sleep 180”&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/pic/docker-mesos/3.png&quot; alt=&quot;3&quot; /&gt;&lt;/p&gt;

&lt;h3 id=&quot;section-2&quot;&gt;常见异常&lt;/h3&gt;

&lt;p&gt;&lt;img src=&quot;/pic/docker-mesos/7.png&quot; alt=&quot;3&quot; /&gt;&lt;/p&gt;

&lt;p&gt;遇到上面的错误你一定是通过VMware或VirtualBox实验，&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;如果是在自己笔记本上通过虚拟机做实验，需要修改自己笔记本的hosts文件进行主机名解析；生产场景有DNS可忽略&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;添加自己笔记本电脑的hosts文件解析&lt;/code&gt;&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-shell&quot; data-lang=&quot;shell&quot;&gt;192.168.1.101  mesos-master01
192.168.1.102  mesos-master02
192.168.1.103  mesos-master03
192.168.1.104  mesos-slave01
192.168.1.105  mesos-slave02&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;hr /&gt;

&lt;h2 id=&quot;marathon&quot;&gt;部署marathon&lt;/h2&gt;

&lt;h3 id=&quot;marathon-1&quot;&gt;安装marathon&lt;/h3&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;第一台master上部署marathon&lt;/code&gt;&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-shell&quot; data-lang=&quot;shell&quot;&gt;rpm -ivh http://repos.mesosphere.com/el/7/noarch/RPMS/mesosphere-el-repo-7-1.noarch.rpm
yum -y install marathon&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;修改所有slave节点配置并重启slave&lt;/code&gt;&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-shell&quot; data-lang=&quot;shell&quot;&gt;&lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'docker,mesos'&lt;/span&gt; | tee /etc/mesos-slave/containerizers
systemctl start marathon&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;h3 id=&quot;marathon-2&quot;&gt;验证marathon&lt;/h3&gt;

&lt;p&gt;&lt;img src=&quot;/pic/docker-mesos/4.png&quot; alt=&quot;4&quot; /&gt;&lt;/p&gt;

&lt;p&gt;http://192.168.1.101:8080&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/pic/docker-mesos/5.png&quot; alt=&quot;5&quot; /&gt;&lt;/p&gt;

&lt;hr /&gt;

&lt;h2 id=&quot;marathonmesosdocker&quot;&gt;marathon调用mesos部署docker容器&lt;/h2&gt;

&lt;p&gt;vim /root/nginx.json&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-shell&quot; data-lang=&quot;shell&quot;&gt;&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;s2&quot;&gt;&quot;id&quot;&lt;/span&gt;: &lt;span class=&quot;s2&quot;&gt;&quot;nginx&quot;&lt;/span&gt;,
    &lt;span class=&quot;s2&quot;&gt;&quot;cpus&quot;&lt;/span&gt;: 0.2,
    &lt;span class=&quot;s2&quot;&gt;&quot;mem&quot;&lt;/span&gt;: 32,
    &lt;span class=&quot;s2&quot;&gt;&quot;instances&quot;&lt;/span&gt;: 1,
    &lt;span class=&quot;s2&quot;&gt;&quot;constraints&quot;&lt;/span&gt;: &lt;span class=&quot;o&quot;&gt;[]&lt;/span&gt;,
    &lt;span class=&quot;s2&quot;&gt;&quot;container&quot;&lt;/span&gt;: &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;s2&quot;&gt;&quot;type&quot;&lt;/span&gt;: &lt;span class=&quot;s2&quot;&gt;&quot;DOCKER&quot;&lt;/span&gt;,
        &lt;span class=&quot;s2&quot;&gt;&quot;docker&quot;&lt;/span&gt;: &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;s2&quot;&gt;&quot;image&quot;&lt;/span&gt;: &lt;span class=&quot;s2&quot;&gt;&quot;nginx&quot;&lt;/span&gt;,
            &lt;span class=&quot;s2&quot;&gt;&quot;network&quot;&lt;/span&gt;: &lt;span class=&quot;s2&quot;&gt;&quot;BRIDGE&quot;&lt;/span&gt;,
            &lt;span class=&quot;s2&quot;&gt;&quot;portMappings&quot;&lt;/span&gt;: &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;
                &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
                    &lt;span class=&quot;s2&quot;&gt;&quot;containerPort&quot;&lt;/span&gt;: 80,
                    &lt;span class=&quot;s2&quot;&gt;&quot;hostPort&quot;&lt;/span&gt;: 0,
                    &lt;span class=&quot;s2&quot;&gt;&quot;servicePort&quot;&lt;/span&gt;: 0,
                    &lt;span class=&quot;s2&quot;&gt;&quot;protocol&quot;&lt;/span&gt;: &lt;span class=&quot;s2&quot;&gt;&quot;tcp&quot;&lt;/span&gt;
                &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
            &lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;
        &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-shell&quot; data-lang=&quot;shell&quot;&gt;curl -X POST http://192.168.1.101:8080/v2/apps -d @/root/nginx.json -H &lt;span class=&quot;s2&quot;&gt;&quot;Content-type: application/json&quot;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;&lt;img src=&quot;/pic/docker-mesos/6.png&quot; alt=&quot;6&quot; /&gt;&lt;/p&gt;

&lt;hr /&gt;

&lt;p&gt;end&lt;/p&gt;

</description>
        <pubDate>Mon, 16 Jan 2017 00:00:00 +0800</pubDate>
        <link>/docker/Docker-Mesos.html</link>
        <guid isPermaLink="true">/docker/Docker-Mesos.html</guid>
        
        
        <category>Docker</category>
        
      </item>
    
      <item>
        <title>Docker Swarm Shipyard</title>
        <description>&lt;ul id=&quot;markdown-toc&quot;&gt;
  &lt;li&gt;&lt;a href=&quot;#reference&quot; id=&quot;markdown-toc-reference&quot;&gt;Reference&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#introduction&quot; id=&quot;markdown-toc-introduction&quot;&gt;Introduction&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#shipyard-deployment&quot; id=&quot;markdown-toc-shipyard-deployment&quot;&gt;Shipyard Deployment&lt;/a&gt;    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#automated-deployment&quot; id=&quot;markdown-toc-automated-deployment&quot;&gt;Automated Deployment&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#manual-deployment&quot; id=&quot;markdown-toc-manual-deployment&quot;&gt;Manual Deployment&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#compile-shipyard&quot; id=&quot;markdown-toc-compile-shipyard&quot;&gt;Compile Shipyard&lt;/a&gt;    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#go&quot; id=&quot;markdown-toc-go&quot;&gt;go&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#godep&quot; id=&quot;markdown-toc-godep&quot;&gt;godep&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#nvm&quot; id=&quot;markdown-toc-nvm&quot;&gt;nvm&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#nodejs--npm&quot; id=&quot;markdown-toc-nodejs--npm&quot;&gt;nodejs &amp;amp;&amp;amp; npm&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#bower&quot; id=&quot;markdown-toc-bower&quot;&gt;bower&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#git-clone&quot; id=&quot;markdown-toc-git-clone&quot;&gt;git clone&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#modify-indexhtml&quot; id=&quot;markdown-toc-modify-indexhtml&quot;&gt;modify index.html&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;reference&quot;&gt;Reference&lt;/h2&gt;

&lt;blockquote&gt;
  &lt;p&gt;https://www.shipyard-project.com/docs/&lt;/p&gt;
&lt;/blockquote&gt;

&lt;blockquote&gt;
  &lt;p&gt;https://github.com/shipyard/shipyard&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h2 id=&quot;introduction&quot;&gt;Introduction&lt;/h2&gt;

&lt;p&gt;Shipard是docker集群的可视化解决方案，shipyard利用内置的swarm组建管理集群，并提供图形化管理界面。可管理容器，镜像，节点，私有仓库等。还提供了用户认证和访问控制。&lt;/p&gt;

&lt;p&gt;Shipyard完全100%利用的&lt;code class=&quot;highlighter-rouge&quot;&gt;Docker Remote API&lt;/code&gt;实现的&lt;/p&gt;

&lt;hr /&gt;

&lt;h2 id=&quot;shipyard-deployment&quot;&gt;Shipyard Deployment&lt;/h2&gt;

&lt;h3 id=&quot;automated-deployment&quot;&gt;Automated Deployment&lt;/h3&gt;

&lt;blockquote&gt;
  &lt;p&gt;curl -sSL https://shipyard-project.com/deploy | bash -s&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h3 id=&quot;manual-deployment&quot;&gt;Manual Deployment&lt;/h3&gt;

&lt;p&gt;Datastore&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-shell&quot; data-lang=&quot;shell&quot;&gt;docker run &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
    -ti &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
    -d &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
    --restart&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;always &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
    --name shipyard-rethinkdb &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
    rethinkdb&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;Discovery&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-shell&quot; data-lang=&quot;shell&quot;&gt;docker run &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
    -ti &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
    -d &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
    -p 4001:4001 &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
    -p 7001:7001 &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
    --restart&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;always &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
    --name shipyard-discovery &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
    microbox/etcd -name discovery&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;Proxy&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-shell&quot; data-lang=&quot;shell&quot;&gt;docker run &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
    -ti &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
    -d &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
    -p 2375:2375 &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
    --hostname&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$HOSTNAME&lt;/span&gt; &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
    --restart&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;always &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
    --name shipyard-proxy &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
    -v /var/run/docker.sock:/var/run/docker.sock &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
    -e &lt;span class=&quot;nv&quot;&gt;PORT&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;2375 &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
    shipyard/docker-proxy:latest&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;Swarm Manager&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-shell&quot; data-lang=&quot;shell&quot;&gt;docker run &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
    -ti &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
    -d &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
    --restart&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;always &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
    --name shipyard-swarm-manager &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
    swarm:latest &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
    manage --host tcp://0.0.0.0:3375 etcd://&amp;lt;IP-OF-HOST&amp;gt;:4001&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;Swarm Agent&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-shell&quot; data-lang=&quot;shell&quot;&gt;docker run &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
    -ti &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
    -d &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
    --restart&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;always &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
    --name shipyard-swarm-agent &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
    swarm:latest &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
    join --addr &amp;lt;ip-of-host&amp;gt;:2375 etcd://&amp;lt;ip-of-host&amp;gt;:4001&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;Controller&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-shell&quot; data-lang=&quot;shell&quot;&gt;docker run &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
    -ti &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
    -d &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
    --restart&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;always &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
    --name shipyard-controller &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
    --link shipyard-rethinkdb:rethinkdb &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
    --link shipyard-swarm-manager:swarm &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
    -p 8080:8080 &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
    shipyard/shipyard:latest &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
    server &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
    -d tcp://swarm:3375&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;hr /&gt;

&lt;h2 id=&quot;compile-shipyard&quot;&gt;Compile Shipyard&lt;/h2&gt;

&lt;h3 id=&quot;go&quot;&gt;go&lt;/h3&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-shell&quot; data-lang=&quot;shell&quot;&gt;wget https://storage.googleapis.com/golang/go1.7.4.linux-amd64.tar.gz
tar -C /usr/local/ -xf go1.7.4.linux-amd64.tar.gz
&lt;span class=&quot;nb&quot;&gt;export &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;PATH&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$PATH&lt;/span&gt;:/usr/local/go/bin
go version&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;h3 id=&quot;godep&quot;&gt;godep&lt;/h3&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-shell&quot; data-lang=&quot;shell&quot;&gt;&lt;span class=&quot;nb&quot;&gt;export &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;GOPATH&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;/usr/
go get github.com/tools/godep&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;h3 id=&quot;nvm&quot;&gt;nvm&lt;/h3&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-shell&quot; data-lang=&quot;shell&quot;&gt;curl -o- https://raw.githubusercontent.com/creationix/nvm/v0.31.1/install.sh | bash
&lt;span class=&quot;nb&quot;&gt;source&lt;/span&gt; ~/.bashrc
nvm --version&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;h3 id=&quot;nodejs--npm&quot;&gt;nodejs &amp;amp;&amp;amp; npm&lt;/h3&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-shell&quot; data-lang=&quot;shell&quot;&gt;yum install nodejs
node -v
npm -v&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;h3 id=&quot;bower&quot;&gt;bower&lt;/h3&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-shell&quot; data-lang=&quot;shell&quot;&gt;npm install -g bower --registry&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;http://registry.npm.taobao.org
bower -v&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;h3 id=&quot;git-clone&quot;&gt;git clone&lt;/h3&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-shell&quot; data-lang=&quot;shell&quot;&gt;git clone https://github.com/shipyard/shipyard.git
mkdir -p /usr/local/go/src/github.com/shipyard/
mv shipyard /usr/local/go/src/github.com/shipyard/&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;h3 id=&quot;modify-indexhtml&quot;&gt;modify index.html&lt;/h3&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-shell&quot; data-lang=&quot;shell&quot;&gt;vim shipyard/controller/static/app/login/login.html

 4 &amp;lt;h1 &lt;span class=&quot;nv&quot;&gt;style&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;margin-top: 100px; margin-bottom: 50px; font-family: 'Poiret One', sans-serif; font-size: 72px; color: #ffffff;&quot;&lt;/span&gt;&amp;gt;Mimte-Docker&amp;lt;/h1&amp;gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-shell&quot; data-lang=&quot;shell&quot;&gt;&lt;span class=&quot;nb&quot;&gt;cd&lt;/span&gt; /usr/local/go/src/github.com/shipyard/shipyard
make build
make media&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-shell&quot; data-lang=&quot;shell&quot;&gt;&lt;span class=&quot;nb&quot;&gt;cd&lt;/span&gt; /usr/local/go/src/github.com/shipyard/shipyard/controller
docker build -t shipyard/shipyard:v1 ./
Sending build context to Docker daemon 38.34 MB
Step 1 : FROM alpine:latest
 ---&amp;gt; 0766572b4bac
Step 2 : RUN apk add --update git ca-certificates &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt;     rm -rf /var/cache/apk/&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;
 ---&amp;gt; Running &lt;span class=&quot;k&quot;&gt;in &lt;/span&gt;87b47f8d5d9b
fetch http://dl-cdn.alpinelinux.org/alpine/v3.4/main/x86_64/APKINDEX.tar.gz
fetch http://dl-cdn.alpinelinux.org/alpine/v3.4/community/x86_64/APKINDEX.tar.gz
&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;1/6&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; Installing ca-certificates &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;20160104-r4&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;2/6&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; Installing libssh2 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;1.7.0-r0&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;3/6&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; Installing libcurl &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;7.51.0-r0&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;4/6&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; Installing expat &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;2.1.1-r2&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;5/6&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; Installing pcre &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;8.38-r1&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;6/6&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; Installing git &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;2.8.3-r0&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
Executing busybox-1.24.2-r12.trigger
Executing ca-certificates-20160104-r4.trigger
OK: 22 MiB &lt;span class=&quot;k&quot;&gt;in &lt;/span&gt;17 packages
 ---&amp;gt; b4b0f356c8ac
Removing intermediate container 87b47f8d5d9b
Step 3 : ADD static /static
 ---&amp;gt; 311fc8862edb
Removing intermediate container aba0b170b13a
Step 4 : ADD controller /bin/controller
 ---&amp;gt; cd104f6babef
Removing intermediate container dfbaf72eaa7d
Step 5 : EXPOSE 8080
 ---&amp;gt; Running &lt;span class=&quot;k&quot;&gt;in &lt;/span&gt;da52ef41d74f
 ---&amp;gt; dbab862fb18b
Removing intermediate container da52ef41d74f
Step 6 : ENTRYPOINT /bin/controller
 ---&amp;gt; Running &lt;span class=&quot;k&quot;&gt;in &lt;/span&gt;b2e3af6bec3d
 ---&amp;gt; 86937d8db64a
Removing intermediate container b2e3af6bec3d
Successfully built 86937d8db64a&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-shell&quot; data-lang=&quot;shell&quot;&gt;docker ps
CONTAINER ID        IMAGE                          COMMAND                  CREATED              STATUS              PORTS                                            NAMES
4be692396011        shipyard/shipyard:v1           &lt;span class=&quot;s2&quot;&gt;&quot;/bin/controller serv&quot;&lt;/span&gt;   4 seconds ago        Up 2 seconds        0.0.0.0:8080-&amp;gt;8080/tcp                           shipyard-controller
a3fdabe80a3f        swarm:latest                   &lt;span class=&quot;s2&quot;&gt;&quot;/swarm join --addr 1&quot;&lt;/span&gt;   39 seconds ago       Up 38 seconds       2375/tcp                                         shipyard-swarm-agent
f42ec4a5c3d7        swarm:latest                   &lt;span class=&quot;s2&quot;&gt;&quot;/swarm manage --host&quot;&lt;/span&gt;   42 seconds ago       Up 40 seconds       2375/tcp                                         shipyard-swarm-manager
89743f1b4db8        shipyard/docker-proxy:latest   &lt;span class=&quot;s2&quot;&gt;&quot;/usr/local/bin/run&quot;&lt;/span&gt;     About a minute ago   Up About a minute   0.0.0.0:2375-&amp;gt;2375/tcp                           shipyard-proxy
ee353d533403        microbox/etcd                  &lt;span class=&quot;s2&quot;&gt;&quot;/bin/etcd -name disc&quot;&lt;/span&gt;   3 minutes ago        Up 3 minutes        0.0.0.0:4001-&amp;gt;4001/tcp, 0.0.0.0:7001-&amp;gt;7001/tcp   shipyard-discovery
66e947f0cf31        rethinkdb                      &lt;span class=&quot;s2&quot;&gt;&quot;rethinkdb --bind all&quot;&lt;/span&gt;   4 minutes ago        Up 4 minutes        8080/tcp, 28015/tcp, 29015/tcp                   shipyard-rethinkdb&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;等待程序启动&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-shell&quot; data-lang=&quot;shell&quot;&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@node0 controller]# docker logs 4be692396011
INFO[0000] shipyard version 3.1.0                       
INFO[0034] checking database                            
INFO[0357] created admin user: username: admin password: shipyard 
INFO[0357] controller listening on :8080          &lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;http://192.168.1.130:8080/&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/pic/docker-shipyard/QQ截图20170105170016.png&quot; alt=&quot;1&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/pic/docker-shipyard/123.png&quot; alt=&quot;1&quot; /&gt;&lt;/p&gt;

&lt;hr /&gt;

&lt;p&gt;end&lt;/p&gt;

</description>
        <pubDate>Wed, 04 Jan 2017 00:00:00 +0800</pubDate>
        <link>/docker/Docker-Swarm-Shipyard.html</link>
        <guid isPermaLink="true">/docker/Docker-Swarm-Shipyard.html</guid>
        
        
        <category>Docker</category>
        
      </item>
    
      <item>
        <title>LNMP环境安装Zabbix3</title>
        <description>&lt;ul id=&quot;markdown-toc&quot;&gt;
  &lt;li&gt;&lt;a href=&quot;#environment&quot; id=&quot;markdown-toc-environment&quot;&gt;Environment&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#downloads-packages&quot; id=&quot;markdown-toc-downloads-packages&quot;&gt;Downloads Packages&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#install-dependent&quot; id=&quot;markdown-toc-install-dependent&quot;&gt;Install Dependent&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#install-nginx&quot; id=&quot;markdown-toc-install-nginx&quot;&gt;Install Nginx&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#install-php&quot; id=&quot;markdown-toc-install-php&quot;&gt;Install PHP&lt;/a&gt;    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#modify-config&quot; id=&quot;markdown-toc-modify-config&quot;&gt;Modify config&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#check-config&quot; id=&quot;markdown-toc-check-config&quot;&gt;Check config&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#install-mysql&quot; id=&quot;markdown-toc-install-mysql&quot;&gt;Install Mysql&lt;/a&gt;    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#modify-config-1&quot; id=&quot;markdown-toc-modify-config-1&quot;&gt;Modify config&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#install-zabbix&quot; id=&quot;markdown-toc-install-zabbix&quot;&gt;Install Zabbix&lt;/a&gt;    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#initialization&quot; id=&quot;markdown-toc-initialization&quot;&gt;Initialization&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#config-zabbixserver&quot; id=&quot;markdown-toc-config-zabbixserver&quot;&gt;Config zabbix_server&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#config-zabbixagentd&quot; id=&quot;markdown-toc-config-zabbixagentd&quot;&gt;Config zabbix_agentd&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#config-nginx&quot; id=&quot;markdown-toc-config-nginx&quot;&gt;config Nginx&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#start-service&quot; id=&quot;markdown-toc-start-service&quot;&gt;Start service&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#pic&quot; id=&quot;markdown-toc-pic&quot;&gt;Pic&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;environment&quot;&gt;Environment&lt;/h2&gt;

&lt;ul&gt;
  &lt;li&gt;CentOS Linux release 7.2.1511 (Core)&lt;/li&gt;
  &lt;li&gt;nginx:1.9.15&lt;/li&gt;
  &lt;li&gt;Mysql:5.5.49&lt;/li&gt;
  &lt;li&gt;PHP:5.5.35&lt;/li&gt;
  &lt;li&gt;zabbix:3.2.3&lt;/li&gt;
&lt;/ul&gt;

&lt;hr /&gt;

&lt;h2 id=&quot;downloads-packages&quot;&gt;Downloads Packages&lt;/h2&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-shell&quot; data-lang=&quot;shell&quot;&gt;mkdir /application/tools
&lt;span class=&quot;nb&quot;&gt;cd&lt;/span&gt; /application/tools/
wget http://nginx.org/download/nginx-1.9.15.tar.gz
wget http://cn2.php.net/get/php-5.5.35.tar.gz/from/this/mirror &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; mv mirror php-5.5.35.tar.gz
wget http://dev.mysql.com/get/Downloads/MySQL-5.5/mysql-5.5.49.tar.gz
wget http://jaist.dl.sourceforge.net/project/zabbix/ZABBIX%20Latest%20Stable/3.2.3/zabbix-3.2.3.tar.gz&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;hr /&gt;

&lt;h2 id=&quot;install-dependent&quot;&gt;Install Dependent&lt;/h2&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-shell&quot; data-lang=&quot;shell&quot;&gt;yum -y install gcc gcc-c++ autoconf automake zlib zlib-devel openssl openssl-devel pcre&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt; make gd-devel libjpeg-devel libpng-devel libxml2-devel bzip2-devel libcurl-devel freetype-devel&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;hr /&gt;

&lt;h2 id=&quot;install-nginx&quot;&gt;Install Nginx&lt;/h2&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-shell&quot; data-lang=&quot;shell&quot;&gt;useradd nginx -s /sbin/nologin -M
&lt;span class=&quot;nb&quot;&gt;cd&lt;/span&gt; /application/tools/
tar xf nginx-1.9.15.tar.gz
&lt;span class=&quot;nb&quot;&gt;cd &lt;/span&gt;nginx-1.9.15
./configure --prefix&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;/application/nginx-1.9.15 --user&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;nginx --group&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;nginx --with-http_ssl_module --with-http_stub_status_module
make &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; make install
ln -s /application/nginx-1.9.15/ /application/nginx&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;hr /&gt;

&lt;h2 id=&quot;install-php&quot;&gt;Install PHP&lt;/h2&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-shell&quot; data-lang=&quot;shell&quot;&gt;&lt;span class=&quot;nb&quot;&gt;cd&lt;/span&gt; /application/tools/
tar xf php-5.5.35.tar.gz 
&lt;span class=&quot;nb&quot;&gt;cd &lt;/span&gt;php-5.5.35
./configure --prefix&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;/application/php-5.5.35 &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
--with-config-file-path&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;/application/php-5.5.35/etc &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
--with-bz2 &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
--with-curl &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
--enable-ftp &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
--enable-sockets &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
--disable-ipv6 &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
--with-gd &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
--with-jpeg-dir&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;/usr/local &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
--with-png-dir&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;/usr/local &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
--with-freetype-dir&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;/usr/local &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
--enable-gd-native-ttf &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
--with-iconv-dir&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;/usr/local &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
--enable-mbstring &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
--enable-calendar &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
--with-gettext &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
--with-libxml-dir&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;/usr/local &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
--with-zlib &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
--with-pdo-mysql&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;mysqlnd &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
--with-mysqli&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;mysqlnd &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
--with-mysql&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;mysqlnd &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
--enable-dom &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
--enable-xml &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
--enable-fpm &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
--with-libdir&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;lib64 &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
--enable-bcmath
make &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; make install
ln -s /application/php-5.5.35/ /application/php&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;h3 id=&quot;modify-config&quot;&gt;Modify config&lt;/h3&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-shell&quot; data-lang=&quot;shell&quot;&gt;&lt;span class=&quot;nb&quot;&gt;cd&lt;/span&gt; /application/tools/php-5.5.35
cp php.ini-production /application/php/etc/php.ini
&lt;span class=&quot;nb&quot;&gt;cd&lt;/span&gt; /application/php/etc/
cp php-fpm.conf.default php-fpm.conf
sed -i &lt;span class=&quot;s1&quot;&gt;'s#max_execution_time =.*#max_execution_time = 300#g'&lt;/span&gt; php.ini
sed -i &lt;span class=&quot;s1&quot;&gt;'s#memory_limit = .*#memory_limit = 128M#g'&lt;/span&gt; php.ini
sed -i &lt;span class=&quot;s1&quot;&gt;'s#post_max_size = .*#post_max_size = 16M#g'&lt;/span&gt; php.ini            
sed -i &lt;span class=&quot;s1&quot;&gt;'s#upload_max_filesize = .*#upload_max_filesize = 2M#g'&lt;/span&gt; php.ini             
sed -i &lt;span class=&quot;s1&quot;&gt;'s#max_input_time = .*#max_input_time = 300#g'&lt;/span&gt; php.ini 
sed -i &lt;span class=&quot;s1&quot;&gt;'s#date.timezone = .*#date.timezone = PRC#g'&lt;/span&gt; php.ini    &lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;h3 id=&quot;check-config&quot;&gt;Check config&lt;/h3&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-shell&quot; data-lang=&quot;shell&quot;&gt;grep &lt;span class=&quot;s2&quot;&gt;&quot;max_execution_time = &quot;&lt;/span&gt; php.ini
grep &lt;span class=&quot;s2&quot;&gt;&quot;memory_limit = &quot;&lt;/span&gt; php.ini 
grep &lt;span class=&quot;s2&quot;&gt;&quot;post_max_size =&quot;&lt;/span&gt; php.ini
grep &lt;span class=&quot;s2&quot;&gt;&quot;upload_max_filesize =&quot;&lt;/span&gt; php.ini 
grep &lt;span class=&quot;s2&quot;&gt;&quot;max_input_time =&quot;&lt;/span&gt; php.ini 
grep &lt;span class=&quot;s2&quot;&gt;&quot;date.timezone =&quot;&lt;/span&gt; php.ini&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;hr /&gt;

&lt;h2 id=&quot;install-mysql&quot;&gt;Install Mysql&lt;/h2&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-shell&quot; data-lang=&quot;shell&quot;&gt;&lt;span class=&quot;nb&quot;&gt;cd&lt;/span&gt; /application/tools/
tar xf mysql-5.5.49.tar.gz 
useradd mysql -s /sbin/nologin -M
mkdir /data/mysql -p
chown -R mysql.mysql /data/mysql/
yum install -y cmake gcc&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt; ncurses-devel
&lt;span class=&quot;nb&quot;&gt;cd &lt;/span&gt;mysql-5.5.49
cmake -DCMAKE_INSTALL_PREFIX&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;/application/mysql5.5.49 -DDEFAULT_CHARSET&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;utf8 -DENABLED_LOCAL_INFILE&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;1 -DMYSQL_DATADIR&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;/data/mysql -DWITH_EXTRA_CHARSETS&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;all -DWITH_READLINE&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;1 -DWITH_INNOBASE_STORAGE_ENGINE&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;1 -DMYSQL_TCP_PORT&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;3306 -DDEFAULT_COLLATION&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;utf8_general_ci
make &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; make install
ln -s /application/mysql5.5.49/ /application/mysql
&lt;span class=&quot;se&quot;&gt;\c&lt;/span&gt;p /application/mysql/bin/&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt; /usr/bin/&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;h3 id=&quot;modify-config-1&quot;&gt;Modify config&lt;/h3&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-shell&quot; data-lang=&quot;shell&quot;&gt;mkdir -p /data/mysql
&lt;span class=&quot;nb&quot;&gt;cd&lt;/span&gt; /application/mysql/support-files/
rm -f /etc/my.cnf
cp my-medium.cnf /data/mysql/my.cnf
cp mysql.server /etc/init.d/mysqld
chmod 755 /etc/init.d/mysqld &lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;hr /&gt;

&lt;h2 id=&quot;install-zabbix&quot;&gt;Install Zabbix&lt;/h2&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-shell&quot; data-lang=&quot;shell&quot;&gt;&lt;span class=&quot;nb&quot;&gt;cd&lt;/span&gt; /home/mtime/tools/
tar xf zabbix-3.2.3.tar.gz
&lt;span class=&quot;nb&quot;&gt;cd &lt;/span&gt;zabbix-3.2.3
yum install -y net-snmp-devel mysql-devel
useradd zabbix -s /sbin/nologin -M
./configure --prefix&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;/application/zabbix-3.0.3/ --enable-server --enable-agent --with-mysql --with-net-snmp --with-libcurl --with-libxml2
make install
ln -s /application/zabbix-3.0.3/ /application/zabbix&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;h3 id=&quot;initialization&quot;&gt;Initialization&lt;/h3&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-shell&quot; data-lang=&quot;shell&quot;&gt;mysql -e &lt;span class=&quot;s2&quot;&gt;&quot;create database zabbix default charset utf8;&quot;&lt;/span&gt;
mysql -e &lt;span class=&quot;s2&quot;&gt;&quot;grant all on zabbix.* to zabbix@localhost identified by 'zabbix';&quot;&lt;/span&gt;
mysql -uzabbix -pzabbix zabbix &amp;lt;/application/tools/zabbix-3.2.3/database/mysql/schema.sql
mysql -uzabbix -pzabbix zabbix &amp;lt;/application/tools/zabbix-3.2.3/database/mysql/images.sql
mysql -uzabbix -pzabbix zabbix &amp;lt;/application/tools/zabbix-3.2.3/database/mysql/data.sql&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;h3 id=&quot;config-zabbixserver&quot;&gt;Config zabbix_server&lt;/h3&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-shell&quot; data-lang=&quot;shell&quot;&gt;cat &amp;gt; /application/zabbix/etc/zabbix_server.conf &lt;span class=&quot;sh&quot;&gt;&amp;lt;&amp;lt;EOF
ListenPort=10051
LogFile=/tmp/zabbix_server.log
PidFile=/tmp/zabbix_server.pid
DBHost=localhost
DBName=zabbix
DBUser=zabbix
DBPassword=zabbix
DBSocket=/tmp/mysql.sock
DBPort=3306
Timeout=4
LogSlowQueries=3000
&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;EOF&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;h3 id=&quot;config-zabbixagentd&quot;&gt;Config zabbix_agentd&lt;/h3&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-shell&quot; data-lang=&quot;shell&quot;&gt;cat &amp;gt; /application/zabbix/etc/zabbix_agentd.conf &lt;span class=&quot;sh&quot;&gt;&amp;lt;&amp;lt;EOF
PidFile=/tmp/zabbix_agentd.pid
LogFile=/tmp/zabbix_agentd.log
LogFileSize=0
EnableRemoteCommands=1
Server=127.0.0.1,192.168.3.134
ServerActive=127.0.0.1,192.168.3.134:10051
Hostname=192.168.3.134
BufferSend=10
Timeout=30
AllowRoot=1
UnsafeUserParameters=1
&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;EOF&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;hr /&gt;

&lt;h3 id=&quot;config-nginx&quot;&gt;config Nginx&lt;/h3&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-shell&quot; data-lang=&quot;shell&quot;&gt;&lt;span class=&quot;nb&quot;&gt;cd&lt;/span&gt; /application/nginx
mkdir html/zabbix
cat &amp;gt;conf/nginx.conf&lt;span class=&quot;sh&quot;&gt;&amp;lt;&amp;lt;EOF
user  nginx;
worker_processes  1;

#error_log  logs/error.log warning;
#error_log  logs/error.log  notice;
#error_log  logs/error.log  info;

pid        logs/nginx.pid;


events {
    worker_connections  1024;
}


http {
    include       mime.types;
    default_type  application/octet-stream;

    log_format  main  '$remote_addr - $remote_user [$time_local] &quot;$request&quot; '
                      '$status $body_bytes_sent &quot;$http_referer&quot; '
                      '&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;';

    access_log  logs/access.log  main;

    sendfile        on;
    #tcp_nopush     on;

    #keepalive_timeout  0;
    keepalive_timeout  65;

    #gzip  on;
    include extra/*.conf;

}
EOF
&lt;/span&gt;mkdir conf/extra
cat &amp;gt;conf/extra/zabbix.conf &lt;span class=&quot;sh&quot;&gt;&amp;lt;&amp;lt;EOF
server {
listen 80;
server_name localhost;
access_log /var/log/zabbix/nginx_zabbix.log main;
root html/zabbix;

location / {
           index index.html index.php index.html;
        }

location ~ .*\.(php|php5)?$
            {
             fastcgi_pass  127.0.0.1:9000;
             fastcgi_index index.php;
             include fastcgi.conf;
           }
}
EOF
&lt;/span&gt;mkdir -p /var/log/zabbix
&lt;span class=&quot;se&quot;&gt;\c&lt;/span&gt;p -a /application/tools/zabbix-3.2.3/frontends/php/&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt; /application/nginx/html/zabbix/
/application/nginx/sbin/nginx -t&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;hr /&gt;

&lt;h2 id=&quot;start-service&quot;&gt;Start service&lt;/h2&gt;

&lt;blockquote&gt;
  &lt;p&gt;/application/nginx/sbin/nginx&lt;/p&gt;
&lt;/blockquote&gt;

&lt;blockquote&gt;
  &lt;p&gt;/application/php/sbin/php-fpm&lt;/p&gt;
&lt;/blockquote&gt;

&lt;blockquote&gt;
  &lt;p&gt;/etc/init.d/mysqld start&lt;/p&gt;
&lt;/blockquote&gt;

&lt;blockquote&gt;
  &lt;p&gt;/application/zabbix/sbin/zabbix_server&lt;/p&gt;
&lt;/blockquote&gt;

&lt;blockquote&gt;
  &lt;p&gt;/application/zabbix/sbin/zabbix_agentd&lt;/p&gt;
&lt;/blockquote&gt;

&lt;hr /&gt;

&lt;h2 id=&quot;pic&quot;&gt;Pic&lt;/h2&gt;

&lt;p&gt;&lt;img src=&quot;/pic/zabbix-install/1.png&quot; alt=&quot;1&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/pic/zabbix-install/QQ截图20170103220119.png&quot; alt=&quot;2&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/pic/zabbix-install/QQ截图20170103220130.png&quot; alt=&quot;3&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/pic/zabbix-install/QQ截图20170103220140.png&quot; alt=&quot;4&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/pic/zabbix-install/QQ截图20170103220148.png&quot; alt=&quot;5&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/pic/zabbix-install/QQ截图20170103220158.png&quot; alt=&quot;6&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/pic/zabbix-install/QQ截图20170103220339.png&quot; alt=&quot;7&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/pic/zabbix-install/QQ截图20170103220350.png&quot; alt=&quot;8&quot; /&gt;&lt;/p&gt;

&lt;hr /&gt;

&lt;p&gt;end&lt;/p&gt;

</description>
        <pubDate>Tue, 03 Jan 2017 00:00:00 +0800</pubDate>
        <link>/system/Zabbix-install.html</link>
        <guid isPermaLink="true">/system/Zabbix-install.html</guid>
        
        
        <category>System</category>
        
      </item>
    
      <item>
        <title>Docker Swarm基础</title>
        <description>&lt;ul id=&quot;markdown-toc&quot;&gt;
  &lt;li&gt;&lt;a href=&quot;#reference&quot; id=&quot;markdown-toc-reference&quot;&gt;Reference&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#swarm-mode-overview&quot; id=&quot;markdown-toc-swarm-mode-overview&quot;&gt;Swarm mode overview&lt;/a&gt;    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#feature-highlights&quot; id=&quot;markdown-toc-feature-highlights&quot;&gt;Feature highlights&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#swarm-mode-key-concepts&quot; id=&quot;markdown-toc-swarm-mode-key-concepts&quot;&gt;Swarm mode key concepts&lt;/a&gt;    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#swarm&quot; id=&quot;markdown-toc-swarm&quot;&gt;Swarm&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#node&quot; id=&quot;markdown-toc-node&quot;&gt;Node&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#services-and-tasks&quot; id=&quot;markdown-toc-services-and-tasks&quot;&gt;Services and tasks&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#load-balancing&quot; id=&quot;markdown-toc-load-balancing&quot;&gt;Load balancing&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#getting-started-with-swarm-mode&quot; id=&quot;markdown-toc-getting-started-with-swarm-mode&quot;&gt;Getting started with swarm mode&lt;/a&gt;    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#environment&quot; id=&quot;markdown-toc-environment&quot;&gt;environment&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#create-a-swarm&quot; id=&quot;markdown-toc-create-a-swarm&quot;&gt;Create a swarm&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#join-nodes-to-a-swarm&quot; id=&quot;markdown-toc-join-nodes-to-a-swarm&quot;&gt;Join nodes to a swarm&lt;/a&gt;    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#join-as-a-worker-node&quot; id=&quot;markdown-toc-join-as-a-worker-node&quot;&gt;Join as a worker node&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#join-as-a-manager-node&quot; id=&quot;markdown-toc-join-as-a-manager-node&quot;&gt;Join as a manager node&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#manage-nodes-in-a-swarm&quot; id=&quot;markdown-toc-manage-nodes-in-a-swarm&quot;&gt;Manage nodes in a swarm&lt;/a&gt;    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#list-nodes&quot; id=&quot;markdown-toc-list-nodes&quot;&gt;List nodes&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#inspect-an-individual-node&quot; id=&quot;markdown-toc-inspect-an-individual-node&quot;&gt;Inspect an individual node&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#change-node-availability&quot; id=&quot;markdown-toc-change-node-availability&quot;&gt;Change node availability&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#add-or-remove-label-metadata&quot; id=&quot;markdown-toc-add-or-remove-label-metadata&quot;&gt;Add or remove label metadata&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#promote-or-demote-a-node&quot; id=&quot;markdown-toc-promote-or-demote-a-node&quot;&gt;Promote or demote a node&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#leave-the-swarm&quot; id=&quot;markdown-toc-leave-the-swarm&quot;&gt;Leave the swarm&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#deploy-a-service-to-the-swarm&quot; id=&quot;markdown-toc-deploy-a-service-to-the-swarm&quot;&gt;Deploy a service to the swarm&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#inspect-a-service-on-the-swarm&quot; id=&quot;markdown-toc-inspect-a-service-on-the-swarm&quot;&gt;Inspect a service on the swarm&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#scale-the-service-in-the-swarm&quot; id=&quot;markdown-toc-scale-the-service-in-the-swarm&quot;&gt;Scale the service in the swarm&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#delete-the-service-running-on-the-swarm&quot; id=&quot;markdown-toc-delete-the-service-running-on-the-swarm&quot;&gt;Delete the service running on the swarm&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#apply-rolling-updates-to-a-service&quot; id=&quot;markdown-toc-apply-rolling-updates-to-a-service&quot;&gt;Apply rolling updates to a service&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#drain-a-node-on-the-swarm&quot; id=&quot;markdown-toc-drain-a-node-on-the-swarm&quot;&gt;Drain a node on the swarm&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#use-swarm-mode-routing-mesh&quot; id=&quot;markdown-toc-use-swarm-mode-routing-mesh&quot;&gt;Use swarm mode routing mesh&lt;/a&gt;    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#publish-a-port-for-a-service&quot; id=&quot;markdown-toc-publish-a-port-for-a-service&quot;&gt;Publish a port for a service&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#configure-an-external-load-balancer&quot; id=&quot;markdown-toc-configure-an-external-load-balancer&quot;&gt;Configure an external load balancer&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;reference&quot;&gt;Reference&lt;/h2&gt;

&lt;blockquote&gt;
  &lt;p&gt;https://docs.docker.com/engine/swarm/&lt;/p&gt;
&lt;/blockquote&gt;

&lt;hr /&gt;

&lt;h2 id=&quot;swarm-mode-overview&quot;&gt;Swarm mode overview&lt;/h2&gt;

&lt;p&gt;Docker 1.12 内置了集群管理工具swarm，可使用docker的CLI去创建swarm集群；管理swarm集群；部署应用服务。&lt;/p&gt;

&lt;h3 id=&quot;feature-highlights&quot;&gt;Feature highlights&lt;/h3&gt;

&lt;blockquote&gt;
  &lt;p&gt;引擎内置集群管理工具：使用docker的CLI即可创建管理集群；部署应用；无需额外的编排软件管理集群。&lt;/p&gt;
&lt;/blockquote&gt;

&lt;blockquote&gt;
  &lt;p&gt;分散式设计：不是在部署时处理节点角色之间的差异，而是在运行时进行专业化分工。 你可以使用Docker Engine部署两种类型的节点，manager和worker。 这意味着您可以从单个磁盘映像构建整个群集。&lt;/p&gt;
&lt;/blockquote&gt;

&lt;blockquote&gt;
  &lt;p&gt;声明性服务模型：Docker Engine使用声明性方法来定义应用程序堆栈中各种服务的所需状态。 例如，你可以描述由具有消息队列服务和数据库后端的Web前端服务组成的应用程序。&lt;/p&gt;
&lt;/blockquote&gt;

&lt;blockquote&gt;
  &lt;p&gt;Scaling：你可以声明每个服务运行的副本数量，当你想要扩容或收缩时，swarm管理器通过自动添加或删除任务来适应所需的目标状态。&lt;/p&gt;
&lt;/blockquote&gt;

&lt;blockquote&gt;
  &lt;p&gt;期望状态协调：manager节点实时监视群集状态，并协调你声明的期望状态的实际状态之间的任何差异。 例如，如果你设置一个服务运行10个副本，如果其中两个副本所在计算机崩溃，manager则自动在可用的worker节点创建两个新的任务，以达到你希望的目标状态（10个副本）。&lt;/p&gt;
&lt;/blockquote&gt;

&lt;blockquote&gt;
  &lt;p&gt;多主机网络：你可以为你的服务创建overlay网络，manager自动分配地址给容器在初始化或更新应用容器的时候。&lt;/p&gt;
&lt;/blockquote&gt;

&lt;blockquote&gt;
  &lt;p&gt;服务发现：manager自动为每个服务分配一个唯一的DNS名称，并对运行的容器负载均衡，你可以通过嵌入在swarm中的DNS服务器查询每个容器的域名信息。&lt;/p&gt;
&lt;/blockquote&gt;

&lt;blockquote&gt;
  &lt;p&gt;负载均衡：你可以暴露一个服务端口给外部的负载均衡器，在swarm内部。你可以指定如何在节点之间分发任务。
安全：swarm节点之间之间采用TLS认证通信，你可以选择使用自签名或CA颁发的证书&lt;/p&gt;
&lt;/blockquote&gt;

&lt;blockquote&gt;
  &lt;p&gt;滚动更新：你可以滚动更新你的应用，手动控制更新时的延时时间，如果出现问题，你可以回滚应用到之前的版本。&lt;/p&gt;
&lt;/blockquote&gt;

&lt;hr /&gt;

&lt;h2 id=&quot;swarm-mode-key-concepts&quot;&gt;Swarm mode key concepts&lt;/h2&gt;

&lt;h3 id=&quot;swarm&quot;&gt;Swarm&lt;/h3&gt;

&lt;p&gt;When you run Docker Engine outside of swarm mode, you execute container commands. When you run the Engine in swarm mode, you orchestrate services.&lt;/p&gt;

&lt;h3 id=&quot;node&quot;&gt;Node&lt;/h3&gt;

&lt;p&gt;一个node就是一个docker实例；&lt;/p&gt;

&lt;p&gt;当你部署服务时，你在manager node定义服务（一个服务可能由多个task共同组成），manager节点将tasks调度到worker节点执行。&lt;/p&gt;

&lt;p&gt;manager节点还负责维护集群管理功能使集群达到期望状态，manager节点中间会挑选一个leader出来负责编排任务。&lt;/p&gt;

&lt;p&gt;woker节点负责接收并执行manager分配的任务，默认情况下，manager节点也是worker节点，但是你可以设置让manager节点仅仅作为manager&lt;/p&gt;

&lt;h3 id=&quot;services-and-tasks&quot;&gt;Services and tasks&lt;/h3&gt;

&lt;p&gt;service就是被定义在worker上执行的task；&lt;/p&gt;

&lt;p&gt;当你创建service时，你指定所需的image和需在容器中执行的command&lt;/p&gt;

&lt;p&gt;在replicated services 模式，manager会根据你设置的副本数量自动分配task&lt;/p&gt;

&lt;p&gt;task就是一个容器，也是swarm调度的原子单位，manager节点根据你设置的副本数量分配任务到worker节点。当一个任务分配到node上，他就只能是runing或fail的状态。&lt;/p&gt;

&lt;h3 id=&quot;load-balancing&quot;&gt;Load balancing&lt;/h3&gt;

&lt;p&gt;manager使用ingress load balancing对外暴露服务，manager会自动分配PublishedPort 或者你也可以手动指定未被使用的端口号，如果是你不手动指定，swarm会自动在30000-32767中间分配一个端口号&lt;/p&gt;

&lt;p&gt;你可以访问任意节点的PublishedPort，即使该节点上并没有任务相应的task在运行&lt;/p&gt;

&lt;p&gt;Swarm有一个内部的DNS组件会自动为每个任务分配一条DNS记录，manager根据DNS域名负载该服务的所有请求。&lt;/p&gt;

&lt;hr /&gt;

&lt;h2 id=&quot;getting-started-with-swarm-mode&quot;&gt;Getting started with swarm mode&lt;/h2&gt;

&lt;h3 id=&quot;environment&quot;&gt;environment&lt;/h3&gt;

&lt;p&gt;host：&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;node0 manager1 192.168.1.130&lt;/li&gt;
  &lt;li&gt;node1	manager2 192.168.1.131&lt;/li&gt;
  &lt;li&gt;node2	manager3 192.168.1.132&lt;/li&gt;
  &lt;li&gt;node4	worker1	192.168.1.133&lt;/li&gt;
  &lt;li&gt;node5	worker2	192.168.1.134&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;docker-version：&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-shell&quot; data-lang=&quot;shell&quot;&gt;Client:
 Version:      1.12.3
 API version:  1.24
 Go version:   go1.6.3
 Git commit:   6b644ec
 Built:        
 OS/Arch:      linux/amd64

Server:
 Version:      1.12.3
 API version:  1.24
 Go version:   go1.6.3
 Git commit:   6b644ec
 Built:        
 OS/Arch:      linux/amd64&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;port：&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;TCP port 2377 for cluster management communications&lt;/li&gt;
  &lt;li&gt;TCP and UDP port 7946 for communication among nodes&lt;/li&gt;
  &lt;li&gt;TCP and UDP port 4789 for overlay network traffic&lt;/li&gt;
&lt;/ul&gt;

&lt;hr /&gt;

&lt;h2 id=&quot;create-a-swarm&quot;&gt;Create a swarm&lt;/h2&gt;

&lt;blockquote&gt;
  &lt;p&gt;docker swarm init –advertise-addr&lt;/p&gt;
&lt;/blockquote&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-shell&quot; data-lang=&quot;shell&quot;&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@node0 ~]# docker swarm init --advertise-addr 192.168.1.130
Swarm initialized: current node &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;36duyub88vg54x41e0dur9850&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; is now a manager.

To add a worker to this swarm, run the following &lt;span class=&quot;nb&quot;&gt;command&lt;/span&gt;:

    docker swarm join &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
    --token SWMTKN-1-1n11n79rldx65uq8krc7h41irve0j4x6lmrlea33u2wriw8vym-8wfukcb9amac6wkcgm340aj6f &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
    192.168.1.130:2377

To add a manager to this swarm, run &lt;span class=&quot;s1&quot;&gt;'docker swarm join-token manager'&lt;/span&gt; and follow the instructions.&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;blockquote&gt;
  &lt;p&gt;docker info&lt;/p&gt;
&lt;/blockquote&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-shell&quot; data-lang=&quot;shell&quot;&gt;Containers: 0
 Running: 0
 Paused: 0
 Stopped: 0
Images: 35
Server Version: 1.12.3
...snip...
Swarm: active
 NodeID: 36duyub88vg54x41e0dur9850
 Is Manager: &lt;span class=&quot;nb&quot;&gt;true
 &lt;/span&gt;ClusterID: 4uxe2ejgkqky5x77g57p4cp3s
 Managers: 1
 Nodes: 1
 ...snip...&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;blockquote&gt;
  &lt;p&gt;docker node ls&lt;/p&gt;
&lt;/blockquote&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-shell&quot; data-lang=&quot;shell&quot;&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@node0 ~]# docker node ls
ID                           HOSTNAME  STATUS  AVAILABILITY  MANAGER STATUS
36duyub88vg54x41e0dur9850 &lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;  node0     Ready   Active        Leader&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;ul&gt;
  &lt;li&gt;表示你当前连接的主机；swarm自动用主机名命名node&lt;/li&gt;
&lt;/ul&gt;

&lt;hr /&gt;

&lt;h2 id=&quot;join-nodes-to-a-swarm&quot;&gt;Join nodes to a swarm&lt;/h2&gt;

&lt;p&gt;docker加入到集群是依赖&lt;code class=&quot;highlighter-rouge&quot;&gt;join-token&lt;/code&gt;的，node使用不同的token可以以不同的身份加入到集群中；如果你后来变更了token，也不影响已经加入到集群的node。&lt;/p&gt;

&lt;h3 id=&quot;join-as-a-worker-node&quot;&gt;Join as a worker node&lt;/h3&gt;

&lt;blockquote&gt;
  &lt;p&gt;docker swarm join-token worker&lt;/p&gt;
&lt;/blockquote&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-shell&quot; data-lang=&quot;shell&quot;&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@node0 ~]# docker swarm join-token worker
To add a worker to this swarm, run the following &lt;span class=&quot;nb&quot;&gt;command&lt;/span&gt;:

    docker swarm join &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
    --token SWMTKN-1-1n11n79rldx65uq8krc7h41irve0j4x6lmrlea33u2wriw8vym-8wfukcb9amac6wkcgm340aj6f &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
    192.168.1.130:2377&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;h3 id=&quot;join-as-a-manager-node&quot;&gt;Join as a manager node&lt;/h3&gt;

&lt;blockquote&gt;
  &lt;p&gt;docker swarm join-token manager&lt;/p&gt;
&lt;/blockquote&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-shell&quot; data-lang=&quot;shell&quot;&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@node0 ~]# docker swarm join-token manager
To add a manager to this swarm, run the following &lt;span class=&quot;nb&quot;&gt;command&lt;/span&gt;:

    docker swarm join &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
    --token SWMTKN-1-1n11n79rldx65uq8krc7h41irve0j4x6lmrlea33u2wriw8vym-bdik5uby0lq4s955ij8gnrtkb &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
    192.168.1.130:2377&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;hr /&gt;

&lt;ul&gt;
  &lt;li&gt;switches the Docker Engine on the current node into swarm mode.&lt;/li&gt;
  &lt;li&gt;requests a TLS certificate from the manager.&lt;/li&gt;
  &lt;li&gt;names the node with the machine hostname&lt;/li&gt;
  &lt;li&gt;joins the current node to the swarm at the manager listen address based upon the swarm token.&lt;/li&gt;
  &lt;li&gt;sets the current node to Active availability, meaning it can receive tasks from the scheduler.&lt;/li&gt;
  &lt;li&gt;extends the ingress overlay network to the current node.&lt;/li&gt;
&lt;/ul&gt;

&lt;hr /&gt;

&lt;h2 id=&quot;manage-nodes-in-a-swarm&quot;&gt;Manage nodes in a swarm&lt;/h2&gt;

&lt;h3 id=&quot;list-nodes&quot;&gt;List nodes&lt;/h3&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-shell&quot; data-lang=&quot;shell&quot;&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@node0 ~]# docker node ls
ID                           HOSTNAME  STATUS  AVAILABILITY  MANAGER STATUS
36duyub88vg54x41e0dur9850 &lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;  node0     Ready   Active        Leader
4bgh5mz90cc2cni8vn7ur9gb4    node2     Ready   Active        
9sh9731bp74enjx9nht6irbon    node3     Ready   Active        
czavy0nt0bro4fj1tl15fby62    node4     Ready   Active        
dazpqp2i92e6ityg064r75ahq    node1     Ready   Active    &lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;AVAILABILITY:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Active 可以分配任务到该节点&lt;/li&gt;
  &lt;li&gt;Pause 不会分配新的任务到该节点，已有的任务继续运行&lt;/li&gt;
  &lt;li&gt;Drain 不会分配新的任务到该节点，已有的任务调度到其他node上运行&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;MANAGER STATUS：&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;没有值表示是worker节点，不参与选举。&lt;/li&gt;
  &lt;li&gt;Leader 表示是主管理节点&lt;/li&gt;
  &lt;li&gt;Reachable 表示是管理节点，当Leader挂掉后会参与选举。&lt;/li&gt;
  &lt;li&gt;Unavailable 表示该node是管理节点，但是与其他的manager失去了联系。这时候应该将其降权，并提升一名worker作为新manager&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;inspect-an-individual-node&quot;&gt;Inspect an individual node&lt;/h3&gt;

&lt;blockquote&gt;
  &lt;p&gt;docker node inspect –pretty&lt;/p&gt;
&lt;/blockquote&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-shell&quot; data-lang=&quot;shell&quot;&gt;docker node inspect node0 --pretty
ID:                     36duyub88vg54x41e0dur9850
Hostname:               node0
Joined at:              2017-01-01 07:18:11.827960041 +0000 utc
Status:
 State:                 Ready
 Availability:          Active
Manager Status:
 Address:               192.168.1.130:2377
 Raft Status:           Reachable
 Leader:                Yes
Platform:
 Operating System:      linux
 Architecture:          x86_64
Resources:
 CPUs:                  1
 Memory:                977.9 MiB
Plugins:
  Network:              bridge, host, null, overlay
  Volume:               &lt;span class=&quot;nb&quot;&gt;local
&lt;/span&gt;Engine Version:         1.12.3&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;h3 id=&quot;change-node-availability&quot;&gt;Change node availability&lt;/h3&gt;

&lt;blockquote&gt;
  &lt;p&gt;docker node update&lt;/p&gt;
&lt;/blockquote&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-shell&quot; data-lang=&quot;shell&quot;&gt;docker node update --availability drain node0
node0&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;h3 id=&quot;add-or-remove-label-metadata&quot;&gt;Add or remove label metadata&lt;/h3&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-shell&quot; data-lang=&quot;shell&quot;&gt;docker node update --label-add foo --label-add &lt;span class=&quot;nv&quot;&gt;server&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;java node0
node0&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;h3 id=&quot;promote-or-demote-a-node&quot;&gt;Promote or demote a node&lt;/h3&gt;

&lt;blockquote&gt;
  &lt;p&gt;docker node promote&lt;/p&gt;
&lt;/blockquote&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-shell&quot; data-lang=&quot;shell&quot;&gt;&lt;span class=&quot;c&quot;&gt;# docker node promote node1 node2&lt;/span&gt;
Node node1 promoted to a manager &lt;span class=&quot;k&quot;&gt;in &lt;/span&gt;the swarm.
Node node2 promoted to a manager &lt;span class=&quot;k&quot;&gt;in &lt;/span&gt;the swarm.
&lt;span class=&quot;c&quot;&gt;# docker node ls&lt;/span&gt;
ID                           HOSTNAME  STATUS  AVAILABILITY  MANAGER STATUS
36duyub88vg54x41e0dur9850 &lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;  node0     Ready   Drain         Leader
4bgh5mz90cc2cni8vn7ur9gb4    node2     Ready   Active        Reachable
9sh9731bp74enjx9nht6irbon    node3     Ready   Active        
czavy0nt0bro4fj1tl15fby62    node4     Ready   Active        
dazpqp2i92e6ityg064r75ahq    node1     Ready   Active        Reachable&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;blockquote&gt;
  &lt;p&gt;docker node demote&lt;/p&gt;
&lt;/blockquote&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-shell&quot; data-lang=&quot;shell&quot;&gt;&lt;span class=&quot;c&quot;&gt;# docker node demote node1 node2&lt;/span&gt;
Manager node1 demoted &lt;span class=&quot;k&quot;&gt;in &lt;/span&gt;the swarm.
Manager node2 demoted &lt;span class=&quot;k&quot;&gt;in &lt;/span&gt;the swarm.
&lt;span class=&quot;c&quot;&gt;# docker node ls&lt;/span&gt;
ID                           HOSTNAME  STATUS  AVAILABILITY  MANAGER STATUS
36duyub88vg54x41e0dur9850 &lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;  node0     Ready   Drain         Leader
4bgh5mz90cc2cni8vn7ur9gb4    node2     Ready   Active        
9sh9731bp74enjx9nht6irbon    node3     Ready   Active        
czavy0nt0bro4fj1tl15fby62    node4     Ready   Active        
dazpqp2i92e6ityg064r75ahq    node1     Ready   Active  &lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;h3 id=&quot;leave-the-swarm&quot;&gt;Leave the swarm&lt;/h3&gt;

&lt;blockquote&gt;
  &lt;p&gt;docker swarm leave&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;worker离开集群&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-shell&quot; data-lang=&quot;shell&quot;&gt;docker swarm leave
Node left the swarm.&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;manager离开集群&lt;/p&gt;

&lt;p&gt;先降权成为worker，在以worker身份离开集群&lt;/p&gt;

&lt;p&gt;当node离开了集群之后，可以删除node节点&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;docker node rm&lt;/p&gt;
&lt;/blockquote&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-shell&quot; data-lang=&quot;shell&quot;&gt;docker node rm node1&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;hr /&gt;

&lt;h2 id=&quot;deploy-a-service-to-the-swarm&quot;&gt;Deploy a service to the swarm&lt;/h2&gt;

&lt;blockquote&gt;
  &lt;p&gt;docker service create&lt;/p&gt;
&lt;/blockquote&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-shell&quot; data-lang=&quot;shell&quot;&gt;docker service create --replicas 1 --name helloworld alpine ping docker.com&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;blockquote&gt;
  &lt;p&gt;docker service ls&lt;/p&gt;
&lt;/blockquote&gt;

&lt;hr /&gt;

&lt;h2 id=&quot;inspect-a-service-on-the-swarm&quot;&gt;Inspect a service on the swarm&lt;/h2&gt;

&lt;blockquote&gt;
  &lt;p&gt;docker service inspect –pretty&lt;/p&gt;
&lt;/blockquote&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-shell&quot; data-lang=&quot;shell&quot;&gt;docker service inspect --pretty helloworld&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;blockquote&gt;
  &lt;p&gt;docker service ps&lt;/p&gt;
&lt;/blockquote&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-shell&quot; data-lang=&quot;shell&quot;&gt;docker service ps helloworld&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;hr /&gt;

&lt;h2 id=&quot;scale-the-service-in-the-swarm&quot;&gt;Scale the service in the swarm&lt;/h2&gt;

&lt;blockquote&gt;
  &lt;p&gt;docker service scale&lt;/p&gt;
&lt;/blockquote&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-shell&quot; data-lang=&quot;shell&quot;&gt;docker service scale &lt;span class=&quot;nv&quot;&gt;helloworld&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;5&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;blockquote&gt;
  &lt;p&gt;docker service ps&lt;/p&gt;
&lt;/blockquote&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-shell&quot; data-lang=&quot;shell&quot;&gt;docker service ps helloworld&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;hr /&gt;

&lt;h2 id=&quot;delete-the-service-running-on-the-swarm&quot;&gt;Delete the service running on the swarm&lt;/h2&gt;

&lt;blockquote&gt;
  &lt;p&gt;docker service rm&lt;/p&gt;
&lt;/blockquote&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-shell&quot; data-lang=&quot;shell&quot;&gt;docker service rm helloworld&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;hr /&gt;

&lt;h2 id=&quot;apply-rolling-updates-to-a-service&quot;&gt;Apply rolling updates to a service&lt;/h2&gt;

&lt;p&gt;部署 Redis 3.0.6 并设置update服务时的延时为10s&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-shell&quot; data-lang=&quot;shell&quot;&gt;docker service create &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
  --replicas 3 &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
  --name redis &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
  --update-delay 10s &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
  redis:3.0.6&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;--update-delay&lt;/code&gt;标签用来配置update服务时的延时间隔；可选格式：3h 5m 10m30s 10s&lt;/p&gt;

&lt;p&gt;默认情况下一次升级所有服务，你可以使用&lt;code class=&quot;highlighter-rouge&quot;&gt;--update-parallelism&lt;/code&gt;标签设置一次更新任务的数量&lt;/p&gt;

&lt;p&gt;默认情况下，更新任务中如果有失败的情况，会停止继续更新，当然，你可以通过&lt;code class=&quot;highlighter-rouge&quot;&gt;--update-failure-action&lt;/code&gt;标签去控制更新失败后的行为&lt;/p&gt;

&lt;p&gt;Inspect the redis service:&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-shell&quot; data-lang=&quot;shell&quot;&gt;docker service inspect --pretty redis&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;updates service：&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-shell&quot; data-lang=&quot;shell&quot;&gt;docker service update –image redis:3.0.7 redis&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;调度更新过程如下：&lt;/p&gt;

&lt;p&gt;停止第一个任务&lt;/p&gt;

&lt;p&gt;升级刚才停止的任务&lt;/p&gt;

&lt;p&gt;启动新的容器替换刚才停止任务&lt;/p&gt;

&lt;p&gt;如果更新状态是RUNNING，等待延时间隔，续集更新下一个任务&lt;/p&gt;

&lt;p&gt;如果跟新状态是FAILED，停止更新&lt;/p&gt;

&lt;p&gt;Run docker service inspect –pretty redis to see the new image in the desired state:&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-shell&quot; data-lang=&quot;shell&quot;&gt;docker service inspect --pretty redis&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;To restart a paused update run docker service update . For example:&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-shell&quot; data-lang=&quot;shell&quot;&gt;docker service update redis&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;Run docker service ps to watch the rolling update:&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-shell&quot; data-lang=&quot;shell&quot;&gt;docker service ps redis&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;hr /&gt;

&lt;h2 id=&quot;drain-a-node-on-the-swarm&quot;&gt;Drain a node on the swarm&lt;/h2&gt;

&lt;p&gt;默认情况下，swarm manager会向所有状态为&lt;code class=&quot;highlighter-rouge&quot;&gt;ACTIVE&lt;/code&gt; 的节点分配任务，包括manager自身。&lt;/p&gt;

&lt;p&gt;当你需要使某台设备下架维护时，你可以将这台设备设置为&lt;code class=&quot;highlighter-rouge&quot;&gt;DRAIN&lt;/code&gt;状态，那么这台设备上的任务会被停止掉，自动在状态为 &lt;code class=&quot;highlighter-rouge&quot;&gt;ACTIVE&lt;/code&gt;的节点上启动该任务。&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;docker node update –availability drain&lt;/p&gt;
&lt;/blockquote&gt;

&lt;blockquote&gt;
  &lt;p&gt;docker node update –availability active&lt;/p&gt;
&lt;/blockquote&gt;

&lt;hr /&gt;

&lt;h2 id=&quot;use-swarm-mode-routing-mesh&quot;&gt;Use swarm mode routing mesh&lt;/h2&gt;

&lt;p&gt;swarm使对外暴露服务端口变得简单，所有的节点加入到了ngress routing mesh，routing mesh可以使每个节点都能接收外部的请求，即使某个节点上没有相关任务在运行，routing mesh也能正确的将请求路由到可用的节点。&lt;/p&gt;

&lt;p&gt;为了使用 ingress network 你需要占用以下端口:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Port 7946 TCP/UDP for container network discovery.&lt;/li&gt;
  &lt;li&gt;Port 4789 UDP for the container ingress network.&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;publish-a-port-for-a-service&quot;&gt;Publish a port for a service&lt;/h3&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-shell&quot; data-lang=&quot;shell&quot;&gt;docker service create &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
  --name &amp;lt;SERVICE-NAME&amp;gt; &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
  --publish &amp;lt;PUBLISHED-PORT&amp;gt;:&amp;lt;TARGET-PORT&amp;gt; &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
  &amp;lt;IMAGE&amp;gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;&amp;lt;TARGET-PORT&amp;gt;&lt;/code&gt;表示容器监听的端口，&lt;code class=&quot;highlighter-rouge&quot;&gt;&amp;lt;PUBLISHED-PORT&amp;gt;&lt;/code&gt; swarm服务监听的端口&lt;/p&gt;

&lt;p&gt;例如：想对外提供8080的访问&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-shell&quot; data-lang=&quot;shell&quot;&gt;docker service create &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
  --name my-web &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
  --publish 8080:80 &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
  --replicas 2 &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
  nginx&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;当你访问集群任意节点的8080端口，swarm自动负载路由请求到可用节点上。&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/pic/Docker-Swarm-Basic/ingress-routing-mesh.png&quot; alt=&quot;1&quot; /&gt;&lt;/p&gt;

&lt;p&gt;对于已经存在的服务，你可以使用update去更新对外端口&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-shell&quot; data-lang=&quot;shell&quot;&gt;docker service update &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
  --publish-add &amp;lt;PUBLISHED-PORT&amp;gt;:&amp;lt;TARGET-PORT&amp;gt; &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
  &amp;lt;SERVICE&amp;gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;查看服务对外暴露的端口&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-shell&quot; data-lang=&quot;shell&quot;&gt;docker service inspect --format&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&quot;&lt;/span&gt; my-web&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;暴露TCP端口&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;docker service create –name dns-cache -p 53:53 dns-cache&lt;/p&gt;
&lt;/blockquote&gt;

&lt;blockquote&gt;
  &lt;p&gt;docker service create –name dns-cache -p 53:53/tcp dns-cache&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;暴露UDP端口&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;docker service create –name dns-cache -p 53:53/udp dns-cache&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;暴露TCP/UDP端口&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;docker service create –name dns-cache -p 53:53/tcp -p 53:53/udp dns-cache&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h3 id=&quot;configure-an-external-load-balancer&quot;&gt;Configure an external load balancer&lt;/h3&gt;

&lt;p&gt;你可以配置一个外部的负载均衡器去路由请求到swarm节点，例如 HAProxy负载请求到nginx服务的8080端口&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/pic/Docker-Swarm-Basic/ingress-lb.png&quot; alt=&quot;1&quot; /&gt;&lt;/p&gt;

&lt;hr /&gt;

&lt;p&gt;end&lt;/p&gt;

</description>
        <pubDate>Sun, 01 Jan 2017 00:00:00 +0800</pubDate>
        <link>/docker/Docker-Swarm-Basic.html</link>
        <guid isPermaLink="true">/docker/Docker-Swarm-Basic.html</guid>
        
        
        <category>Docker</category>
        
      </item>
    
  </channel>
</rss>
